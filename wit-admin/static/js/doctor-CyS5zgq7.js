var ge=Object.defineProperty;var $=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var I=(h,c,d)=>c in h?ge(h,c,{enumerable:!0,configurable:!0,writable:!0,value:d}):h[c]=d,Y=(h,c)=>{for(var d in c||(c={}))_e.call(c,d)&&I(h,d,c[d]);if($)for(var d of $(c))Ce.call(c,d)&&I(h,d,c[d]);return h};var z=(h,c,d)=>new Promise((L,w)=>{var A=y=>{try{g(d.next(y))}catch(U){w(U)}},S=y=>{try{g(d.throw(y))}catch(U){w(U)}},g=y=>y.done?L(y.value):Promise.resolve(y.value).then(A,S);g((d=d.apply(h,c)).next())});import{a as be,l as O,c as Q,w as j,m as P,_ as Te}from"./drugSetDiag-Bfk2BVIf.js";import{d as we,P as Se,r as v,b as qe,h as ke,bC as Ve,bD as G,av as Ue,m as b,o,c as r,y as m,p as s,a6 as De,s as f,F as E,A as x,q as T,z as H,B as V,t as J,C as K,x as X,v as Z,af as Ee,ag as xe,_ as Le}from"./index-BNylXLUF.js";import{_ as Ae}from"./index.vue_vue_type_style_index_0_lang-CQ0LplO3.js";import{g as Be,a as Me}from"./drugQuotaManagement-BuPftiIs.js";import"./ifComponent.vue_vue_type_style_index_0_lang-CZbArpmd.js";import"./index-7iMDeE21.js";import"./index.vue_vue_type_script_setup_true_lang-DuUJu87k.js";import"./dict-C-0c6999.js";const Re={key:0},We={key:1},Ye={key:0},ze={key:1},Ne={key:0},Fe={key:1},$e={key:0},Ie={key:1},Oe={key:0},Qe={key:1},je={key:0},Pe={key:1},Ge=we({__name:"doctor",setup(h){const c=Se("$baseMessage"),d=v({}),L=v(null),w=v(null),A=v(null),S=v(!1),g=v(!1),y=v([]),U=v("0"),p=new Map,C=v([]),n=v({type:"1",drugCode:"",name:"",docSetType:"2",total:0,pageNum:1,pageSize:10}),B=qe({searchListButtons:[{label:"查 询",isShowLoading:!0,attrs:{type:"primary"},events:{click:ee}},{label:"重 置",isShowLoading:!1,attrs:{type:"primary"},events:{click:ie}}],searchList:[{type:"input",field:"name",isOutBorder:!1,attrs:{placeholder:"请输入医生名称...",width:220}},{type:"select",field:"docSetType",valueField:"value",labelField:"label",isOutBorder:!1,options:be,attrs:{placeholder:"请选择",width:200,collapseTags:!0},events:{}}],rightSearchListButtons:[{label:"批量设置医生",attrs:{type:"primary",disabled:!0},events:{click:oe}}]});function ee(){L.value.search(!0)}const M=v([]),te=v([{width:"40",type:"checkbox"},{title:"工号",field:"code",minWidth:85,align:"left"},{title:"医生名称",field:"name",minWidth:85,align:"left"},{title:"限额",field:"quotaCount",minWidth:130,align:"left",render:!0},{title:"单位",field:"quotaUnit",minWidth:85,align:"left",render:!0},{title:"周期",field:"quotaCycle",minWidth:85,align:"left",render:!0},{title:"有效期",field:"validityType",minWidth:225,align:"left",render:!0},{title:"生效时间",field:"effectiveTime",minWidth:130,align:"left",render:!0},{title:"警示比例(%)",field:"quotaScale",minWidth:100,align:"left",render:!0},{title:"上周用量",field:"lastDosageValue",minWidth:85,align:"left"},{title:"上周使用率",field:"lastUtilizationRate",minWidth:85,align:"left"},{title:"本周用量",field:"thisDosageValue",minWidth:85,align:"left"},{title:"本周余额",field:"thisWeekRemaining",minWidth:85,align:"left"},{field:"btns",title:"操作",align:"center",width:"85",fixed:"right",render:!0}]);ke(()=>{d.value=Ve("DrugQuotaRow"),n.value.drugCode=d.value.drugCode,q()});function q(t=!0){return z(this,null,function*(){t&&ue();let l={type:n.value.type,name:n.value.name,drugCode:n.value.drugCode,docSetType:n.value.docSetType=="2"?"":n.value.docSetType,pageNum:n.value.pageNum,pageSize:n.value.pageSize};S.value=!0;const{data:u}=yield Be(l);S.value=!1,M.value=(u.list||[]).map(a=>(a.isEdit=!1,a.quotaCount=!a.quotaCount&&a.quotaCount!=0?null:a.quotaCount,a.quotaScale=!a.quotaScale&&a.quotaScale!=0?null:a.quotaScale,a.validityStartTime=a.validityStartTime?G(a.validityStartTime).format("YYYY-MM-DD"):a.validityStartTime,a.validityEndTime=a.validityEndTime?G(a.validityEndTime).format("YYYY-MM-DD"):a.validityEndTime,a.validityTime=[a.validityStartTime,a.validityEndTime],a)),g.value&&N({checked:g.value}),Ue(()=>{const a=M.value.filter(k=>{if(p.has(k.code))return k});w.value.tableMethods("setCheckboxRow",a,!0)}),n.value.total=u.total||0,y.value=u.listUnit||[]})}const ae=t=>{n.value.pageNum=1,n.value.pageSize=t,q(!1)},le=t=>{n.value.pageNum=t,q(!1)};function ie(){let t={type:"1",drugCode:d.value.drugCode,name:"",docSetType:"2"};n.value=Y(Y({},n.value),t)}function oe(){A.value.showDiag(n.value.type,d.value.drugCode,g.value)}function ne(t,l){let u={id:"",quotaType:"",quotaCount:"",quotaUnit:"",quotaCycle:"",validityType:"",validityStartTime:"",validityEndTime:"",effectiveTime:"",quotaScale:"",drugCode:"",code:"",type:""};for(let a in u)t[a]&&(u[a]=t[a]);return u.type=l,u.drugCode=n.value.drugCode,u.validityStartTime=t.validityTime[0],u.validityEndTime=t.validityTime[1],new Promise((a,k)=>Me(u).then(D=>{c(D.msg,"success","hey"),q(),a(D.resultCode)}))}function ue(){p.clear(),C.value=Array.from(p.values()),B.rightSearchListButtons[0].attrs.disabled=C.value.length===0,g.value=!1}const N=({checked:t})=>{g.value=t;const l=w.value.tableMethods("getCheckboxRecords");t?l.forEach(u=>{p.has(u.code)||p.set(u.code,u)}):p.clear(),C.value=Array.from(p.values()),B.rightSearchListButtons[0].attrs.disabled=C.value.length===0},de=({checked:t,row:l})=>{t?p.has(l.code)||p.set(l.code,l):p.delete(l.code),C.value=Array.from(p.values()),B.rightSearchListButtons[0].attrs.disabled=C.value.length===0};function re(t){let l=t.quotaCount||"";return t.quotaType=="0"?l="不限":t.quotaType||(l="未设置"),l}function se(t){let l=t.quotaUnit||"";return t.quotaUnit||(l="未设置"),l}function ce(t){let l="";return Q.map(u=>{t.quotaCycle==u.value&&(l=u.label)}),l}function fe(t){let l="未设置";return t.validityType=="0"?l="不限制":t.validityType=="1"?l=t.validityStartTime+" 至 "+t.validityEndTime:t.validityType||(l="未设置"),l}function ve(t){let l="未设置";return j.concat(P).map(a=>{t.effectiveTime==a.value&&(l=a.label)}),l}return(t,l)=>{const u=Ae,a=b("el-radio"),k=b("el-radio-group"),D=b("el-input-number"),R=b("el-option"),W=b("el-select"),me=b("el-date-picker"),F=b("el-button"),ye=Ee,pe=xe,he=Te;return o(),r("div",null,[m(u,{ref_key:"witSearchRef",ref:L,modelValue:s(n),"onUpdate:modelValue":l[0]||(l[0]=e=>De(n)?n.value=e:null),"is-cache":!1,showResult:!1,"search-data":s(B),"search-name":"matching-doctor-search",searching:s(S),border:!1,padding:!1,onSearch:q},null,8,["modelValue","search-data","searching"]),m(ye,{ref_key:"tableRef",ref:w,"table-name":"rule-doctor-table",loading:s(S),"table-data":s(M),columns:s(te),isShowTableSet:!1,onCheckboxAll:N,onCheckboxChange:de},{quotaCount:f(e=>[e.row.isEdit?(o(),r("div",Re,[m(k,{modelValue:e.row.quotaType,"onUpdate:modelValue":i=>e.row.quotaType=i},{default:f(()=>[(o(!0),r(E,null,x(s(O),(i,_)=>(o(),T(a,{key:_,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.row.quotaType=="1"?(o(),T(D,{key:0,modelValue:e.row.quotaCount,"onUpdate:modelValue":i=>e.row.quotaCount=i,style:{width:"120px"},min:0,class:"tipsInput"},null,8,["modelValue","onUpdate:modelValue"])):H("",!0)])):(o(),r("div",We,V(re(e.row)),1))]),quotaUnit:f(e=>[e.row.isEdit?(o(),r("div",Ye,[m(W,{modelValue:e.row.quotaUnit,"onUpdate:modelValue":i=>e.row.quotaUnit=i},{default:f(()=>[(o(!0),r(E,null,x(s(y),(i,_)=>(o(),T(R,{key:_,value:i,label:i},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(o(),r("div",ze,V(se(e.row)),1))]),quotaCycle:f(e=>[e.row.isEdit?(o(),r("div",Ne,[m(W,{modelValue:e.row.quotaCycle,"onUpdate:modelValue":i=>e.row.quotaCycle=i},{default:f(()=>[(o(!0),r(E,null,x(s(Q),(i,_)=>(o(),T(R,{key:_,value:i.value,label:i.label},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(o(),r("div",Fe,V(ce(e.row)),1))]),validityType:f(e=>[e.row.isEdit?(o(),r("div",$e,[m(k,{modelValue:e.row.validityType,"onUpdate:modelValue":i=>e.row.validityType=i},{default:f(()=>[(o(!0),r(E,null,x(s(O),(i,_)=>(o(),T(a,{key:_,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.row.validityType=="1"?(o(),T(me,{key:0,modelValue:e.row.validityTime,"onUpdate:modelValue":i=>e.row.validityTime=i,type:"daterange",placeholder:"请选择日期","start-placeholder":"开始时间","end-placeholder":"结束时间",style:{width:"220px"},"value-format":"YYYY-MM-DD",class:"tipsInput"},null,8,["modelValue","onUpdate:modelValue"])):H("",!0)])):(o(),r("div",Ie,V(fe(e.row)),1))]),effectiveTime:f(e=>[e.row.isEdit?(o(),r("div",Oe,[m(W,{modelValue:e.row.effectiveTime,"onUpdate:modelValue":i=>e.row.effectiveTime=i},{default:f(()=>[(o(!0),r(E,null,x(e.row.quotaCycle=="0"?s(j):s(P),(i,_)=>(o(),T(R,{key:_,value:i.value,label:i.label},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(o(),r("div",Qe,V(ve(e.row)),1))]),quotaScale:f(e=>[e.row.isEdit?(o(),r("div",je,[m(D,{modelValue:e.row.quotaScale,"onUpdate:modelValue":i=>e.row.quotaScale=i,style:{width:"85px"},min:0,max:100},null,8,["modelValue","onUpdate:modelValue"])])):(o(),r("div",Pe,V(e.row.quotaScale?e.row.quotaScale+"%":0),1))]),btns:f(e=>[J(m(F,{text:"",type:"primary",onClick:K(()=>{e.row.isEdit=!0},["stop"])},{default:f(()=>[X(" 修改 ")]),_:2},1032,["onClick"]),[[Z,!e.row.isEdit]]),J(m(F,{text:"",type:"primary",onClick:K(()=>z(this,null,function*(){(yield ne(e.row,1))==1&&(e.row.isEdit=!1)}),["stop"])},{default:f(()=>[X(" 保存 ")]),_:2},1032,["onClick"]),[[Z,e.row.isEdit]])]),_:1},8,["loading","table-data","columns"]),m(pe,{"current-page":s(n).pageNum,"page-size":s(n).pageSize,total:s(n).total,"prev-text":"上一页","next-text":"下一页",onCurrentChange:le,onSizeChange:ae},null,8,["current-page","page-size","total"]),m(he,{ref_key:"DrugSetDiagRef",ref:A,name:"医生",listUnit:s(y),quotaCycle:s(U),listDataVo:s(C),onFetchData:q},null,8,["listUnit","quotaCycle","listDataVo"])])}}}),it=Le(Ge,[["__scopeId","data-v-3d37e635"]]);export{it as default};
