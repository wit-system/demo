var x=(M,L,k)=>new Promise((q,N)=>{var b=c=>{try{h(k.next(c))}catch(V){N(V)}},y=c=>{try{h(k.throw(c))}catch(V){N(V)}},h=c=>c.done?q(c.value):Promise.resolve(c.value).then(b,y);h((k=k.apply(M,L)).next())});import{d as de,aj as ie,P as pe,r as i,b as j,a0 as ce,m as p,T as me,o as n,c as v,y as t,s,x as A,p as a,t as ge,q as g,n as f,F as w,A as C,aW as fe,C as _e,B as $,z as ve,a6 as be,av as ye,ak as he,ba as Ve,H as we,ag as Ce,ah as ke}from"./index-CmC8Jr0A.js";import{c as Te,a as xe}from"./indication-Cjl8NcsF.js";import{p as Ne}from"./prescriptionIssueSettings-DTI3RBwL.js";const Se={class:"edit-cf-edit-container"},Le={class:"radio-bg"},qe={class:"radio-bg"},Re={class:"common-attention",style:{"font-size":"14px"}},Ue={class:"radio-bg"},ze={class:"radio-bg"},De={style:{display:"flex","justify-content":"space-between"}},Fe={style:{"margin-right":"8px"}},Oe={class:"radio-bg"},Me=de({__name:"editCustomRulesDiag",props:{ruleForm:{type:Object,default:()=>{}}},emits:["query"],setup(M,{expose:L,emit:k}){const q=ie(),N=pe("$baseMessage"),b=i(!1),y=i(!1),h=i(""),c=k,V=i(null),K=i([{label:"政策类",value:"1"},{label:"管理类",value:"2"},{label:"医疗类",value:"3"}]),P=i([{label:"是",value:"1"},{label:"否",value:"0"}]),Q=i([{label:"是按问题等级处理",value:"1"},{label:"弹窗提示医生",value:"2"}]),R=i([]),r=j({keyword:"",pageNum:1,pageSize:20,total:0}),H=i([]),E=i([{label:"是",value:"1"},{label:"否",value:"0"}]),T=i(),U=i(!1),o=j({id:"",ruleType:"1",customRuleName:"",questionType:"",isAccordRule:"1",hintTypes:["1"],drugCodes:[],severity:"0",whetherOverstepSynopsis:"0",reference:"",tipContent:"",warnSign:"",active:"0",analysisType:"0"}),I=j(JSON.parse(JSON.stringify(o))),W={name:[{required:!0,message:"自定义规则名称",trigger:"blur"}],questionType:[{required:!0,message:"请选择问题类型"}],hintTypes:[{required:!0,message:"请选择提示类型"}]},G=(u,l)=>{b.value=!0,T.value=l,ye(()=>{l=="add"?(h.value="新增自定义规则",delete o.id):(h.value=l=="check"?"查看自定义规则":"编辑自定义规则",o.id=u.id,le())})},z=()=>{Object.assign(o,I),V.value.resetFields(),b.value=!1},X=()=>{V.value.validate(u=>x(this,null,function*(){if(u)try{y.value=!0;const l=yield Te([o]);y.value=!1,N(l.msg,"success","hey"),c("query"),z()}catch(l){y.value=!1}}))},Y=u=>{r.pageNum=1,r.pageSize=u,S(r.keyword)},Z=u=>{r.pageNum=u,S(r.keyword)},S=u=>{r.keyword=u,U.value=!0,he(()=>x(this,null,function*(){let{data:l}=yield Ve({keyword:r.keyword,pageNum:r.pageNum,pageSize:r.pageSize}),m=l.records.map(_=>({drugCode:_.id,drugName:_.drugName,manufacture:_.manufacture}));R.value=m,r.total=l.total,U.value=!1}))},ee=()=>x(this,null,function*(){let{data:u}=yield Ne({parentCode:[]}),l=[];u.map(m=>{l=[...l,...m.dimensionsList]}),H.value=l}),le=()=>x(this,null,function*(){let{data:u}=yield xe(o.id);R.value=u.drugCodes,Object.assign(o,u,{drugCodes:u.drugCodes.map(l=>({id:l.drugCode,drugName:l.drugName,drugCode:l.drugCode}))}),console.log(o.drugCodes)});return L({showDiag:G}),ce(()=>{ee()}),(u,l)=>{const m=p("el-radio"),_=p("el-radio-group"),d=p("el-form-item"),D=p("el-input"),F=p("el-option"),O=p("el-select"),ae=we,oe=p("el-checkbox"),te=p("el-checkbox-group"),se=Ce,ne=p("el-form"),J=p("el-button"),ue=ke,re=me("loading");return n(),v("div",Se,[t(ue,{modelValue:a(b),"onUpdate:modelValue":l[12]||(l[12]=e=>be(b)?b.value=e:null),title:a(h),width:"826px","append-to-body":"",onClose:z,class:"no-form-line-margin"},{footer:s(()=>[t(J,{onClick:z},{default:s(()=>[A("取 消")]),_:1}),t(J,{disabled:a(y)||a(T)==="check",type:"primary",onClick:X},{default:s(()=>[A("确 定")]),_:1},8,["disabled"])]),default:s(()=>[ge((n(),g(ne,{ref_key:"formRef",ref:V,model:a(o),"label-width":"120px",rules:W,disabled:a(T)==="check"},{default:s(()=>[t(d,{label:"规则类型"},{default:s(()=>[f("div",Le,[t(_,{modelValue:a(o).ruleType,"onUpdate:modelValue":l[0]||(l[0]=e=>a(o).ruleType=e)},{default:s(()=>[(n(!0),v(w,null,C(a(K),(e,B)=>(n(),g(m,{key:e.value,value:e.value,label:e.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),_:1}),t(d,{label:"自定义规则名称",prop:"name"},{default:s(()=>[t(D,{modelValue:a(o).name,"onUpdate:modelValue":l[1]||(l[1]=e=>a(o).name=e),placeholder:"请输入自定义规则名称"},null,8,["modelValue"])]),_:1}),t(d,{label:"问题类型",prop:"questionType"},{default:s(()=>[t(O,{modelValue:a(o).questionType,"onUpdate:modelValue":l[2]||(l[2]=e=>a(o).questionType=e),placeholder:"请选择问题类型"},{default:s(()=>[(n(!0),v(w,null,C(a(H),e=>(n(),g(F,{key:e.questionCode,label:e.questionName,value:e.questionCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"分析类型",prop:"analysisType"},{default:s(()=>[f("div",qe,[t(_,{modelValue:a(o).analysisType,"onUpdate:modelValue":l[3]||(l[3]=e=>a(o).analysisType=e)},{default:s(()=>[t(m,{value:"0",label:"按药品分析"}),t(m,{value:"1",label:"按整张处方分析"})]),_:1},8,["modelValue"]),f("span",Re,[t(ae,{icon:"icon-xintishi"}),A(" 提示信息：按药品分析时药品可选 ")])])]),_:1}),t(d,{label:"是否符合组合规则"},{default:s(()=>[f("div",Ue,[t(_,{modelValue:a(o).isAccordRule,"onUpdate:modelValue":l[4]||(l[4]=e=>a(o).isAccordRule=e)},{default:s(()=>[(n(!0),v(w,null,C(a(P),(e,B)=>(n(),g(m,{key:e.value,value:e.value,label:e.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),_:1}),t(d,{label:"问题等级"},{default:s(()=>[t(O,{modelValue:a(o).severity,"onUpdate:modelValue":l[5]||(l[5]=e=>a(o).severity=e),placeholder:"请选择"},{default:s(()=>[(n(!0),v(w,null,C(a(q).wordbook.problem_level_rule,e=>(n(),g(F,{key:e.dictLabel,label:e.dictLabel,value:e.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"提示类型",prop:"hintTypes"},{default:s(()=>[f("div",ze,[t(te,{modelValue:a(o).hintTypes,"onUpdate:modelValue":l[6]||(l[6]=e=>a(o).hintTypes=e)},{default:s(()=>[(n(!0),v(w,null,C(a(Q),(e,B)=>(n(),g(oe,{key:e.value,value:e.value,label:e.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),_:1}),a(o).analysisType=="0"?(n(),g(d,{key:0,label:"药品名称"},{default:s(()=>[t(O,{modelValue:a(o).drugCodes,"onUpdate:modelValue":l[7]||(l[7]=e=>a(o).drugCodes=e),multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,filterable:"",remote:"",placeholder:a(T)==="check"?"":"请选择药品名称","remote-method":S,loading:a(U),onKeydown:l[8]||(l[8]=fe(_e(()=>{},["prevent"]),["space","native"])),"value-key":"drugCode","popper-class":"select-pagination-popper","reserve-keyword":"","remote-show-suffix":"",clearable:"",onClear:S},{footer:s(()=>[t(se,{small:"","pager-count":5,"current-page":a(r).pageNum,"page-size":a(r).pageSize,total:a(r).total,onCurrentChange:Z,onSizeChange:Y,teleported:!1},null,8,["current-page","page-size","total"])]),default:s(()=>[(n(!0),v(w,null,C(a(R),e=>(n(),g(F,{key:e.drugCode,value:e,label:e.drugName},{default:s(()=>[f("div",De,[f("span",Fe,"("+$(e.drugCode)+")"+$(e.drugName),1),f("span",null,$(e.manufacture),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1})):ve("",!0),t(d,{label:"是否超说明书用药"},{default:s(()=>[f("div",Oe,[t(_,{modelValue:a(o).whetherOverstepSynopsis,"onUpdate:modelValue":l[9]||(l[9]=e=>a(o).whetherOverstepSynopsis=e)},{default:s(()=>[(n(!0),v(w,null,C(a(E),(e,B)=>(n(),g(m,{value:e.value,label:e.label},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])])]),_:1}),t(d,{label:"参考文献"},{default:s(()=>[t(D,{modelValue:a(o).reference,"onUpdate:modelValue":l[10]||(l[10]=e=>a(o).reference=e),maxlength:"200",placeholder:a(T)==="check"?"":"请输入","show-word-limit":"",type:"textarea",style:{width:"100%"},rows:3},null,8,["modelValue","placeholder"])]),_:1}),t(d,{label:"提示内容"},{default:s(()=>[t(D,{modelValue:a(o).tipContent,"onUpdate:modelValue":l[11]||(l[11]=e=>a(o).tipContent=e),maxlength:"500",placeholder:a(T)==="check"?"":"请输入","show-word-limit":"",type:"textarea",style:{width:"100%"},rows:4},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model","disabled"])),[[re,a(y)]])]),_:1},8,["modelValue","title"])])}}});export{Me as _};
