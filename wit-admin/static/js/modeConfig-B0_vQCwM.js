var ne=Object.defineProperty,re=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var R=(r,d,i)=>d in r?ne(r,d,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[d]=i,j=(r,d)=>{for(var i in d||(d={}))ie.call(d,i)&&R(r,i,d[i]);if(O)for(var i of O(d))pe.call(d,i)&&R(r,i,d[i]);return r},B=(r,d)=>re(r,de(d));import ue from"./modeEdit-7nyMgsWx.js";import{d as ce,f as fe,P as U,r as c,l as he,a0 as me,m as b,o as m,c as _,n as p,y as f,p as n,a6 as _e,x,s as h,F as k,A as P,q as ve,B as C,z as N,H as ge,af as ye,ag as be,I as Ie,J as xe,_ as Ce}from"./index-CmC8Jr0A.js";import{g as F}from"./departmentGroup-DjwBAtP-.js";import{g as Le,m as Me,c as Ae,e as Se}from"./reviewerSettings-TPq4MTBQ.js";const A=r=>(Ie("data-v-ffa483de"),r=r(),xe(),r),Te={class:"param-setting-mode-config-page flex-column"},we=A(()=>p("div",{class:"title"},"处方分配模式配置",-1)),ke={class:"filter-box"},Ne={class:"flex up-center"},Ee={class:"filter-item"},He={class:"common-attention"},$e={class:"mt8 flex up-center"},ze=A(()=>p("div",{class:"label"},"处方分配模式",-1)),Ve={class:"radio-box flex-all"},Oe={class:"mt8 filter-item flex up-center"},Re=A(()=>p("div",{class:"label"},"选择医院",-1)),je={class:"flex-all padding-around"},Be=A(()=>p("span",{class:"table-header-text"},"科室名称【科室类型】",-1)),Ue={key:0,class:"table-header-text"},Pe={key:1,class:"table-header-text"},Fe={key:2,class:"table-header-text"},We={key:0},qe={key:1},De=ce({__name:"modeConfig",setup(r){const d=fe();let{userInfo:i}=d;const E=U("$baseMessage"),W=U("$baseConfirm"),l=c({hosHospCode:"",trialMode:"",pageNum:1,pageSize:20}),S=c(),u=c();Le().then(({data:a})=>{S.value=a.id,l.value.trialMode=a.trialMode,u.value=a.trialModeAllocate});const H=a=>{Me({id:S.value,trialMode:l.value.trialMode,trialModeAllocate:u.value}).then(({msg:e,data:o})=>{S.value=o,E(e,"success","hey")}).catch(()=>{a==="trialMode"?l.value.trialMode=l.value.trialMode==="1"?"0":"1":u.value=u.value==="1"?"0":"1"})},q=[{label:"科室",value:"1"},{label:"科室+药房",value:"2"},{label:"科室+药房+药品类型",value:"3"},{label:"科室+药品类型",value:"4"},{label:"药房+药品类型",value:"5"},{label:"药房",value:"6"},{label:"药品类型",value:"7"}],$=c(0),T=c(!1),L=c([]),w=[{field:"userName",title:"药师姓名",width:"100"},{field:"userId",title:"工号",width:"100"},{field:"hospitalInfoList",title:"所审医院",minWidth:"120",render:!0},{field:"deptInfoList",title:"科室名称",minWidth:"120",isRenderHeader:!0,render:!0},{field:"pharmacyInfoList",title:"药房名称",minWidth:"120",isRenderHeader:!0,render:!0},{field:"btns",title:"操作",align:"center",width:"120",fixed:"right",render:!0}];let M=c([]);he(()=>l.value.trialMode,a=>{a=="1"?M.value=w.filter(e=>["pharmacyInfoList"].indexOf(e.field)===-1):a=="5"||a=="6"||a=="7"?M.value=w.filter(e=>e.field!=="deptInfoList"):M.value=w.filter(e=>e.field!=="")},{immediate:!0});const v=()=>{T.value=!0,Ae(l.value).then(({data:a})=>{T.value=!1,L.value=a.records||[],$.value=a.total,L.value.length>0&&L.value.forEach(e=>{e.hospitalArr=[],e.deptArr=[],e.pharmacyArr=[],e.drugTypeArr=[],e.hospitalInfoList&&e.hospitalInfoList.length>0&&(e.hospitalArr=e.hospitalInfoList.map(o=>o.hosHospName),e.hospitalInfoList.forEach(o=>{e.hospitalStr=e.hospitalArr.join("、"),o.deptInfoList&&o.deptInfoList.length>0&&o.deptInfoList.forEach(t=>{t.typeArr=[],t.deptTypeList&&t.deptTypeList.length>0&&t.deptTypeList.forEach(g=>{t.typeArr.push(g==="1"?"门诊":"住院")}),e.deptArr.push(t.deptName+(t.typeArr.length>0?"【"+t.typeArr.join("、")+"】":""))}),e.deptInfoStr=e.deptArr.join("、"),o.pharmacyArr=[],o.pharmacyTypeArr=[],o.pharmacyInfoList&&o.pharmacyInfoList.length>0&&o.pharmacyInfoList.forEach(t=>{t.typeArr=[],t.drugTypeList&&t.drugTypeList.length>0&&t.drugTypeList.forEach(g=>{o.pharmacyTypeArr.push(g==="1"?"西药":g==="2"?"中成药":g==="3"?"中药":"--")}),o.pharmacyArr.push(t.pharmacyName)}),e.pharmacyArr.push({name:o.pharmacyArr,type:o.pharmacyTypeArr}),o.drugTypeList&&o.drugTypeList.length>0&&o.drugTypeList.forEach(t=>{e.drugTypeArr.push(t==="1"?"西药":t==="2"?"中成药":t==="3"?"中药":"--")}),e.drugTypeStr=[...new Set(e.drugTypeArr)].join("、")}))})})},D=a=>{v()},I=c(!1),y=c([]),J=a=>{I.value=!0,F({pageNum:1,pageSize:20,deptType:"2",deptName:a}).then(({data:e})=>{I.value=!1,y.value=e.records||[]})};me(()=>{I.value=!0,F({pageNum:1,pageSize:20,deptType:"2",deptName:v}).then(({data:a})=>{I.value=!1,y.value=a.records||[],!l.value.hosHospCode&&y.value.length>0&&(y.value.find(e=>e.deptCode===i.user.hospitalInfo.deptCode)?l.value.hosHospCode=i.user.hospitalInfo.deptCode:l.value.hosHospCode=y.value[0].deptCode,v())})});const Q=a=>{let e=[];return a.forEach(o=>{if(["2","6"].indexOf(l.value.trialMode)>-1)for(let t=0;t<o.name.length;t++)e.push(o.name[t]);if(["3","5"].indexOf(l.value.trialMode)>-1)for(let t=0;t<o.name.length;t++)e.push(o.name[t]+(o.type[t]?"【"+o.type[t]+"】":""))}),e.join("、")||"--"},z=c(),G=a=>{z.value.showEdit(B(j({},a),{mode:l.value.trialMode}))},K=a=>{W("是否重置当前药师的审方模式配置","是否重置",()=>{Se({userId:a.userId}).then(({msg:e})=>{E(e,"success","hey"),v()})})},X=a=>{l.value.pageSize=a,v()},Y=a=>{l.value.pageNum=a,v()};return(a,e)=>{const o=b("el-checkbox"),t=ge,g=b("el-radio"),Z=b("el-radio-group"),ee=b("el-option"),te=b("el-select"),V=b("el-button"),ae=ye,oe=be,le=ue;return m(),_(k,null,[p("div",Te,[we,p("div",ke,[p("div",Ne,[p("div",Ee,[f(o,{modelValue:n(u),"onUpdate:modelValue":e[0]||(e[0]=s=>_e(u)?u.value=s:null),"true-value":"1","false-value":"0",label:"启用审方药师的处方分配模式",onChange:e[1]||(e[1]=s=>H("trialModeAllocate"))},null,8,["modelValue"])]),p("span",He,[f(t,{icon:"icon-xintishi"}),x(" 提示：若勾选，则根据选择的模式为审方药师分配处方；若取消勾选，则采用审方配置-处方分配机制 ")])]),p("div",$e,[ze,p("div",Ve,[f(Z,{modelValue:n(l).trialMode,"onUpdate:modelValue":e[2]||(e[2]=s=>n(l).trialMode=s),disabled:n(u)!=="1",class:"row-radio",onChange:e[3]||(e[3]=s=>H("trialMode"))},{default:h(()=>[(m(),_(k,null,P(q,s=>f(g,{key:s.value,value:s.value,label:s.label},null,8,["value","label"])),64))]),_:1},8,["modelValue","disabled"])])]),p("div",Oe,[Re,f(te,{modelValue:n(l).hosHospCode,"onUpdate:modelValue":e[4]||(e[4]=s=>n(l).hosHospCode=s),disabled:n(u)!=="1",filterable:"",remote:"","reserve-keyword":"",placeholder:"请选择/输入","remote-show-suffix":"","remote-method":J,loading:n(I),style:{width:"240px"},onChange:D},{default:h(()=>[(m(!0),_(k,null,P(n(y),s=>(m(),ve(ee,{key:s.deptId,label:s.deptName,value:s.deptCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled","loading"])])]),p("div",je,[f(ae,{ref:"tableRef","table-name":"param-setting-mode-config-table",loading:n(T),"table-data":n(L),columns:n(M),isShowTableSet:!1},{hospitalInfoList:h(s=>[x(C(s.row.hospitalStr||"--"),1)]),deptInfoListHeader:h(()=>[Be]),deptInfoList:h(s=>[x(C(s.row.deptInfoStr||"--"),1)]),pharmacyInfoListHeader:h(()=>[n(l).trialMode==0?(m(),_("span",Ue,"药房名称【药品类型】")):N("",!0),["2","3","5","6"].indexOf(n(l).trialMode)>-1?(m(),_("span",Pe,"药房名称")):N("",!0),["3","4","5","7"].indexOf(n(l).trialMode)>-1?(m(),_("span",Fe,C(n(l).trialMode==="4"||n(l).trialMode==="7"?"药品类型":"【药品类型】"),1)):N("",!0)]),pharmacyInfoList:h(s=>[["4","7"].indexOf(n(l).trialMode)>-1?(m(),_("span",We,C(s.row.drugTypeStr||"--"),1)):(m(),_("span",qe,C(Q(s.row.pharmacyArr)),1))]),btns:h(s=>[f(V,{text:"",type:"primary",disabled:n(u)!=="1",onClick:se=>G(s.row)},{default:h(()=>[x("编辑")]),_:2},1032,["disabled","onClick"]),f(V,{text:"",type:"primary",disabled:n(u)!=="1",onClick:se=>K(s.row)},{default:h(()=>[x("重置")]),_:2},1032,["disabled","onClick"])]),_:1},8,["loading","table-data","columns"])]),f(oe,{"current-page":n(l).pageNum,"page-size":n(l).pageSize,total:n($),"prev-text":"上一页","next-text":"下一页",onCurrentChange:Y,onSizeChange:X},null,8,["current-page","page-size","total"])]),f(le,{ref_key:"modeEditRef",ref:z,onQuery:v},null,512)],64)}}}),Ye=Ce(De,[["__scopeId","data-v-ffa483de"]]);export{Ye as default};
