var T=(e,D,h)=>new Promise((z,N)=>{var b=c=>{try{_(h.next(c))}catch(p){N(p)}},S=c=>{try{_(h.throw(c))}catch(p){N(p)}},_=c=>c.done?z(c.value):Promise.resolve(c.value).then(b,S);_((h=h.apply(e,D)).next())});import{an as g,d as ae,r as i,b as oe,m as f,o as le,q as ne,s as u,y as r,x as E,p as l,n as m,B as F,a6 as se,av as j,af as re,ag as ie,H as ue,ah as de,I as ce,J as pe,_ as ge}from"./index-9sA7DK8G.js";function Ee(e){return g({url:`/system/alternative-group/page?pageNum=${e.pageNum}&pageSize=${e.pageSize}`,method:"post",data:e})}function Le(e){return g({url:"/system/alternative-drug/list",method:"post",data:e})}function Re(e){return g({url:"/system/alternative-group/del-batch",method:"post",data:e})}function We(e){return g({url:"/system/alternative-drug/del-batch",method:"post",data:e})}function $e(e){return g({url:"/system/alternative-drug/put-batch",method:"post",data:e})}function Be(e){return g({url:"/system/alternative-group/insert",method:"post",data:e})}function Te(e){return g({url:"/system/alternative-group/put",method:"post",data:e})}function me(e){return g({url:`/system/alternative-group/drug-page?pageNum=${e.pageNum}&pageSize=${e.pageSize}`,method:"post",data:e})}function fe(e){return g({url:`/system/alternative-drug/drug-page?pageNum=${e.pageNum}&pageSize=${e.pageSize}`,method:"post",data:e})}function Fe(e){return g({url:`/system/alternative-drug/batch?groupId=${e.groupId}`,method:"post",data:e.data})}const L=e=>(ce("data-v-9cb7f78e"),e=e(),pe(),e),he={class:"headerTitle title"},_e=L(()=>m("span",{class:"headerFontBase headerName"},"待选药品总数：",-1)),ve={class:"headerFontBase headerNumber"},be={class:"app-content"},Ce={class:"headerTitle title"},ye=L(()=>m("span",{class:"headerFontBase headerName"},"已选药品：",-1)),Ne={class:"headerFontBase headerNumber"},Se={class:"app-content"},xe=L(()=>m("span",null,"删除",-1)),ke=ae({name:"DrugSelectionSelector",__name:"drugSelection",props:{modelValue:[Array]},emits:["update:modelValue"],setup(e,{expose:D,emit:h}){const z=e,N=h,b=i(1),S=i(""),_={1:{name:"药品选择",query:t=>me(t),field:["drugCode","drugName"]},2:{name:"选择可替代药品",query:t=>fe(t),field:["drugCode","drugName"]}},c=i(""),p=i(!1),R=i(null),d=oe({keyword:"",pageNum:1,pageSize:50}),x=i(!1),O=i(!1),v=i([]),k=i(0),n=i([]),q=i(0),V=i(null),A=()=>"boldFont",P=[{width:"40",type:"checkbox"},{field:"drugCode",title:"药品编码",minWidth:"100"},{field:"productName",title:"商品名",minWidth:"100"},{field:"generalName",title:"通用名",minWidth:"100"},{field:"spec",title:"规格",minWidth:"100"},{field:"dosageForm",title:"剂型",minWidth:"100"},{field:"manufacture",title:"厂家",minWidth:"100"}],G=[{field:"drugCode",title:"药品编码",minWidth:"100"},{field:"productName",title:"商品名",minWidth:"100"},{field:"generalName",title:"通用名",minWidth:"100"},{field:"spec",title:"规格",minWidth:"100"},{field:"dosageForm",title:"剂型",minWidth:"100"},{field:"manufacture",title:"厂家",minWidth:"100"},{field:"btns",title:"操作",width:"90",fixed:"right",render:!0}];D({showEdit:t=>{p.value=!0,c.value=_[t.selectorType].name,b.value=t.selectorType,S.value=t.groupId,Object.assign(d,{keyword:"",pageNum:1}),j(()=>{n.value=JSON.parse(JSON.stringify(z.modelValue)),C(!0)})}});function M(t){d.pageNum=t,C()}function J(t){d.pageNum=1,d.pageSize=t,C()}function C(t=!1){return T(this,null,function*(){x.value=!0,b.value==1&&(d.groupId=S.value);const{data:o}=yield _[b.value].query(d);x.value=!1,v.value=(o.records||o).map(s=>{let a=!1;return n.value.forEach((w,W)=>{s.drugCode==w.drugCode&&(a=!0)}),Object.assign({},s,{isSelected:a})}),k.value=o.total||0,j(()=>{const s=v.value.filter(a=>{if(a.isSelected)return a});V.value.tableMethods("setCheckboxRow",s,!0)})})}const H=({checked:t})=>{t?v.value.forEach(o=>{let s=!1;n.value.forEach((a,w)=>{o.drugCode==a.drugCode&&(s=!0)}),s||n.value.push(o)}):v.value.forEach(o=>{n.value.forEach((s,a)=>{o.drugCode==s.drugCode&&n.value.splice(a,1)})})},U=({checked:t,row:o})=>{t?n.value.push(o):n.value.forEach((s,a)=>{o.drugCode==s.drugCode&&n.value.splice(a,1)})};function K(t){n.value.forEach((o,s)=>{t.drugCode==o.drugCode&&(n.value.splice(s,1),v.value.forEach(a=>{t.drugCode==a.drugCode&&V.value.tableMethods("toggleCheckboxRow",a)}))})}const I=()=>{p.value=!1,R.value.resetFields(),n.value=[]},Q=()=>{N("update:modelValue",n.value),p.value=!1,I()};return(t,o)=>{const s=f("el-input"),a=f("el-button"),w=f("el-form-item"),W=f("el-divider"),X=f("el-form"),$=re,Y=ie,B=f("el-col"),Z=ue,ee=f("el-row"),te=de;return le(),ne(te,{class:"drugSelectionDialog",modelValue:l(p),"onUpdate:modelValue":o[1]||(o[1]=y=>se(p)?p.value=y:null),"append-to-body":"",title:l(c),width:"1200px",onClose:I},{footer:u(()=>[r(a,{onClick:I},{default:u(()=>[E("取 消")]),_:1}),r(a,{type:"primary",onClick:Q},{default:u(()=>[E("保 存")]),_:1})]),default:u(()=>[r(X,{ref_key:"formRef",ref:R,"label-width":"65px",model:l(d),"label-position":"left"},{default:u(()=>[r(w,{label:"药品名称"},{default:u(()=>[r(s,{modelValue:l(d).keyword,"onUpdate:modelValue":o[0]||(o[0]=y=>l(d).keyword=y),modelModifiers:{trim:!0},clearable:"",onClear:C,style:{width:"300px","margin-right":"8px"}},null,8,["modelValue"]),r(a,{type:"primary",loading:l(x),onClick:C},{default:u(()=>[E("搜 索")]),_:1},8,["loading"])]),_:1}),r(W)]),_:1},8,["model"]),r(ee,{gutter:8},{default:u(()=>[r(B,{span:12},{default:u(()=>[m("div",he,[_e,m("span",ve,F(l(k)),1)]),m("div",be,[r($,{ref_key:"tableRef",ref:V,height:"495","table-name":"matchingTools-drugSelectionLeft",loading:l(x),tableData:l(v),columns:P,total:l(k),"checkbox-config":{trigger:"row"},onCheckboxAll:H,onCheckboxChange:U,"header-cell-class-name":A},null,8,["loading","tableData","total"]),r(Y,{"current-page":l(d).pageNum,"page-size":l(d).pageSize,total:l(k),"pager-count":5,layout:"sizes, prev, pager, next, jumper",onCurrentChange:M,onSizeChange:J},null,8,["current-page","page-size","total"])])]),_:1}),r(B,{span:12},{default:u(()=>[m("div",Ce,[ye,m("span",Ne,F(l(n).length),1)]),m("div",Se,[r($,{height:"495","table-name":"matchingTools-drugSelectionRight",loading:l(O),tableData:l(n),columns:G,total:l(q)},{btns:u(y=>[r(a,{text:"",type:"primary",onClick:ze=>K(y.row)},{default:u(()=>[r(Z,{icon:"icon-a-zujian2131",style:{"font-size":"16px"}}),xe]),_:2},1032,["onClick"])]),_:1},8,["loading","tableData","total"])])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}}),we=ge(ke,[["__scopeId","data-v-9cb7f78e"]]),je=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));export{we as _,Be as a,Te as b,Le as c,Re as d,We as e,$e as f,Ee as g,Fe as h,je as i};
