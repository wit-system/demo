var ve=Object.defineProperty,Ie=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var ee=(y,g,p)=>g in y?ve(y,g,{enumerable:!0,configurable:!0,writable:!0,value:p}):y[g]=p,L=(y,g)=>{for(var p in g||(g={}))ke.call(g,p)&&ee(y,p,g[p]);if(Z)for(var p of Z(g))xe.call(g,p)&&ee(y,p,g[p]);return y},N=(y,g)=>Ie(y,Ce(g));var q=(y,g,p)=>new Promise(($,v)=>{var I=c=>{try{C(p.next(c))}catch(D){v(D)}},P=c=>{try{C(p.throw(c))}catch(D){v(D)}},C=c=>c.done?$(c.value):Promise.resolve(c.value).then(I,P);C((p=p.apply(y,g)).next())});import De from"./index-BMVrJx2m.js";import{d as Ue,P as we,aj as Te,r as h,b as le,m as _,o as s,c as V,y as l,s as d,x as S,p as o,F as A,A as B,q as f,n as te,B as R,z as x,a6 as Le,bk as Ne,bl as Ae,av as Be,bm as Ee,bn as Fe,bo as qe,ae,H as Se,af as Re,ah as $e,_ as Pe}from"./index-BN8uVNSO.js";import je from"./index-BbATPsKa.js";import"./index.vue_vue_type_style_index_0_lang-CYTYEVrP.js";import"./ifComponent.vue_vue_type_style_index_0_lang-TMjKtAQ8.js";import"./index-DxSYlWYB.js";import"./index.vue_vue_type_script_setup_true_lang-BkXq5IQh.js";import"./dict-Ck584AJf.js";import"./style-doqH4jKF.js";import"./fileUpload-CpIuWZku.js";const We={class:"edit-cf-edit-container"},Oe={class:"flex"},Me={class:"flex"},ze={key:1},Ge={key:0},Je={key:1},He={key:0},Ye=Ue({name:"EditDrugDetail",__name:"editDrugDetail",props:{ylflTreeData:{type:Array,default:()=>[]}},emits:["close-diag"],setup(y,{expose:g,emit:p}){const $=we("$baseMessage"),v=Te(),I=h(!1),P=p,C=h("新增药品"),c=h([]),D=h(null),E={ingredientId:"",ingredient:"",ingredientType:"",compatibilityType:""};let a=le({id:"",classifyCode:"",drugsId:"",ypflIds:[],drugClassFlag:"1",generalId:"",drugName:"",productName:"",dosageForm:"",minSpec:"",dosageId:"",dddValue:"",medicareCode:"",approvalNo:"",sort:void 0,manufacture:"",ingredientDtoList:[N(L({},E),{isAdd:!0})],drugBaseExtension:{halfLife:"",periodUom:"",otc:"",gmp:"",atcCode:"",transactionId:"",medicinalProperties:""}});const de={classifyCode:[{required:!0,message:"请选择",trigger:"change"}],ypflIds:[{required:!0,message:"请选择",trigger:"change"}],id:[{required:!0,message:"请输入",trigger:"blur"}],generalName:[{required:!0,message:"请输入",trigger:"blur"}],drugName:[{required:!0,message:"请输入",trigger:"blur"}],dosageId:[{required:!0,message:"请输入",trigger:"blur"}],drugClassFlag:[{required:!0,message:"请选择",trigger:"change"}],minSpec:[{required:!0,message:"请输入",trigger:"blur"}],dosageForm:[{required:!0,message:"请选择",trigger:"change"}],approvalNo:[{required:!0,message:"请输入",trigger:"blur"}],manufacture:[{required:!0,message:"请输入",trigger:"blur"}],ingredientDtoList:[{required:!0,validator:(n,t,u)=>{if(a.ingredientDtoList.length<1)return u(new Error("请填写成份信息"));u()},trigger:"change"}]},oe=h([{field:"seq",title:"序号",width:"55",render:!0},{field:"ingredient",title:"成份名称",minWidth:"120",render:!0},{field:"ingredientType",title:"成份类型",minWidth:"120",render:!0},{field:"compatibilityType",title:"中成药配伍类型",minWidth:"120",render:!0},{field:"btns",title:"操作",align:"center",width:"140",fixed:"right",render:!0}]),ne=h([{field:"seq",title:"序号",width:"55",render:!0},{field:"ingredient",title:"成份名称",minWidth:"120",render:!0},{field:"ingredientType",title:"成份类型",minWidth:"120",render:!0},{field:"btns",title:"操作",align:"center",width:"140",fixed:"right",render:!0}]),M=h(null),z=h(""),ie=(n,t)=>q(this,null,function*(){z.value=t,t=="edit"||t=="copy"?(t=="edit"?C.value="编辑药品":t=="copy"&&(C.value="复制药品"),Ne(n.id).then(({data:u})=>{for(let r in a)r!=="dosageId"&&r!=="ingredientDtoList"&&(a[r]=u[r]);Object.assign(a,{dosageId:n.dosageId,ypflIds:n.dosageId?[n.drugsId,n.generalId,n.dosageId]:[n.drugsId,n.generalId],dosageUom:n.dosageUom,dosage:n.dosage}),j(n.generalId)}),Ae({syDrugId:n.id,drugsId:"",generalId:n.generalId}).then(({data:u})=>{a.ingredientDtoList=(u||[]).concat(N(L({},E),{isAdd:!0}))})):(C.value="新增药品",Q(),a.ypflIds=n.ypflIds),a.classifyCode=n.classifyCode,yield G(),I.value=!0,Be(()=>{const u=M.value.getCheckedNodes();u.length>0&&(a.ypflIds=u[0].pathValues,a.drugsId=u[0].pathValues[0],a.generalId=u[0].pathValues[1],a.dosageId=u[0].pathValues[2],j(u[0].pathValues[2]))})}),re=n=>{a.classifyCode=n[n.length-1],a.ypflIds=[],G()},se=(n,t)=>{if(n&&n.length!=3){a.ypflIds=[],$("请选择有剂量的选项","warning","hey");return}n&&(a.drugsId=n[0]?n[0]:"",a.generalId=n[1]?n[1]:"",a.dosageId=n[2]?n[2]:"",n[2]&&j(n[2]))};function j(n){Ee({id:n}).then(({data:t})=>{t&&(a.dosage=t.dosage||"",a.dosageUom=t.dosageUom||"")})}const ue=()=>{a.ingredientDtoList=[N(L({},E),{isAdd:!0})]},G=(n,t)=>q(this,null,function*(){const u=yield Fe({classifyCode:a.classifyCode||"",keyword:""});if(u.resultCode!=1){c.value=[];return}c.value=u.data,c.value&&c.value.length&&J(c.value)}),pe=()=>{D.value.validate(n=>q(this,null,function*(){if(n){const t=JSON.parse(JSON.stringify(a));if(t.ingredientDtoList.pop(),t.ingredientDtoList.forEach(r=>{r.generalId=a.generalId}),z.value=="copy"&&delete t.id,(yield qe(t)).resultCode!=1){ae.error("操作失败！！");return}ae.success("操作成功！！"),I.value=!1,D.value.resetFields(),Q(),P("close-diag")}}))},J=n=>{for(let t=0;t<n.length;t++)n[t].children&&Array.isArray(n[t].children)&&n[t].children[0]!=null?J(n[t].children):n[t].children&&delete n[t].children},H=h(),me=h();function Y(n){me.value=n,H.value.open("",a.drugClassFlag)}function ge(n){n.forEach(t=>{a.ingredientDtoList.splice(a.ingredientDtoList.length-1,0,N(L({},E),{ingredientId:t.id,ingredient:t.ingredient,isAdd:!1,ingredientType:t.ingredientType,compatibilityType:t.compatibilityType}))})}function K(n){a.ingredientDtoList.splice(n.scope.rowIndex,1)}const Q=()=>{a=le({id:"",classifyCode:"",drugsId:"",ypflIds:[],drugClassFlag:"1",generalId:"",drugName:"",productName:"",dosageForm:"",minSpec:"",dosageId:"",dddValue:"",medicareCode:"",approvalNo:"",sort:void 0,manufacture:"",ingredientDtoList:[N(L({},E),{isAdd:!0})],drugBaseExtension:{halfLife:"",periodUom:"",otc:"",gmp:"",atcCode:"",transactionId:"",medicinalProperties:""}})};return g({showEdit:ie}),(n,t)=>{const u=_("el-cascader"),r=_("el-form-item"),W=_("el-radio"),fe=_("el-radio-group"),b=_("el-input"),m=_("el-col"),U=_("el-option"),w=_("el-select"),k=_("el-row"),F=_("el-input-number"),O=Se,ce=_("el-icon"),_e=_("el-tooltip"),T=_("el-button"),X=Re,ye=je,be=_("el-form"),Ve=$e,he=De;return s(),V("div",We,[l(Ve,{modelValue:o(I),"onUpdate:modelValue":t[22]||(t[22]=e=>Le(I)?I.value=e:null),"append-to-body":"",fullscreen:!0,class:"light-full-screen",title:o(C),width:"900"},{footer:d(()=>[l(T,{onClick:t[21]||(t[21]=e=>I.value=!1)},{default:d(()=>[S("取 消")]),_:1}),l(T,{type:"primary",onClick:pe},{default:d(()=>[S("确 定")]),_:1})]),default:d(()=>[l(be,{ref_key:"formRef",ref:D,"label-width":"100px",model:o(a),rules:de},{default:d(()=>[l(r,{label:"药理分类:",prop:"classifyCode"},{default:d(()=>[l(u,{placeholder:"请输入药理分类",options:y.ylflTreeData,filterable:"",modelValue:o(a).classifyCode,"onUpdate:modelValue":t[0]||(t[0]=e=>o(a).classifyCode=e),style:{width:"100%"},props:{value:"classifyCode",label:"classifyName",checkStrictly:!0},onChange:re},null,8,["options","modelValue"])]),_:1}),l(r,{label:"药物分类:",prop:"ypflIds"},{default:d(()=>[l(u,{ref_key:"ypCascaderRef",ref:M,placeholder:"请输入药物分类",options:o(c),filterable:"",modelValue:o(a).ypflIds,"onUpdate:modelValue":t[1]||(t[1]=e=>o(a).ypflIds=e),style:{width:"100%"},props:{value:"id",label:"label"},onChange:se},null,8,["options","modelValue"])]),_:1}),l(r,{label:"药品类型:",prop:"drugClassFlag"},{default:d(()=>[l(fe,{modelValue:o(a).drugClassFlag,"onUpdate:modelValue":t[2]||(t[2]=e=>o(a).drugClassFlag=e),onChange:ue},{default:d(()=>[l(W,{value:"1",label:"西药"}),l(W,{value:"2",label:"中成药"}),l(W,{value:"3",label:"中药"})]),_:1},8,["modelValue"])]),_:1}),l(k,{class:"form-item-group"},{default:d(()=>[l(m,{span:8},{default:d(()=>[l(r,{label:"药品名:",prop:"drugName"},{default:d(()=>[l(b,{placeholder:"请输入",modelValue:o(a).drugName,"onUpdate:modelValue":t[3]||(t[3]=e=>o(a).drugName=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:d(()=>[l(r,{label:"商品名:",prop:"productName"},{default:d(()=>[l(b,{placeholder:"请输入",modelValue:o(a).productName,"onUpdate:modelValue":t[4]||(t[4]=e=>o(a).productName=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:d(()=>[l(r,{label:"剂型:",prop:"dosageForm"},{default:d(()=>[l(w,{modelValue:o(a).dosageForm,"onUpdate:modelValue":t[5]||(t[5]=e=>o(a).dosageForm=e)},{default:d(()=>[(s(!0),V(A,null,B(o(v).wordbook.drug_dosage_flag,(e,i)=>(s(),f(U,{key:i,label:e.dictLabel,value:e.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(k,{class:"form-item-group"},{default:d(()=>[l(m,{span:8},{default:d(()=>[l(r,{label:"规格:",prop:"minSpec"},{default:d(()=>[l(b,{placeholder:"请输入",modelValue:o(a).minSpec,"onUpdate:modelValue":t[6]||(t[6]=e=>o(a).minSpec=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:d(()=>[l(r,{label:"基本剂量:",prop:"dosage"},{default:d(()=>[te("div",Oe,[l(F,{class:"number-input",modelValue:o(a).dosage,"onUpdate:modelValue":t[7]||(t[7]=e=>o(a).dosage=e),min:0,"controls-position":"right",disabled:""},null,8,["modelValue"]),l(b,{placeholder:"最小单位",modelValue:o(a).dosageUom,"onUpdate:modelValue":t[8]||(t[8]=e=>o(a).dosageUom=e),disabled:"",style:{width:"94px"}},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),l(k,{class:"form-item-group"},{default:d(()=>[l(m,{span:8},{default:d(()=>[l(r,{label:"DDD值:",prop:"dddValue"},{default:d(()=>[l(F,{class:"number-input",modelValue:o(a).dddValue,"onUpdate:modelValue":t[9]||(t[9]=e=>o(a).dddValue=e),min:0,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:d(()=>[l(r,{label:"半衰期:",prop:"halfLife"},{default:d(()=>[te("div",Me,[l(F,{class:"number-input",modelValue:o(a).drugBaseExtension.halfLife,"onUpdate:modelValue":t[10]||(t[10]=e=>o(a).drugBaseExtension.halfLife=e),min:0,"controls-position":"right"},null,8,["modelValue"]),l(b,{placeholder:"最小单位",modelValue:o(a).drugBaseExtension.periodUom,"onUpdate:modelValue":t[11]||(t[11]=e=>o(a).drugBaseExtension.periodUom=e)},null,8,["modelValue"])])]),_:1})]),_:1}),l(m,{span:8},{default:d(()=>[l(r,{label:"OTC:",prop:"otc","label-width":"180px"},{default:d(()=>[l(w,{modelValue:o(a).drugBaseExtension.otc,"onUpdate:modelValue":t[12]||(t[12]=e=>o(a).drugBaseExtension.otc=e)},{default:d(()=>[(s(!0),V(A,null,B(o(v).wordbook.drug_dosage_flag,(e,i)=>(s(),f(U,{key:i,label:e.dictLabel,value:e.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(k,{class:"form-item-group"},{default:d(()=>[l(m,{span:8},{default:d(()=>[l(r,{label:"GMP:",prop:"gmp"},{default:d(()=>[l(b,{placeholder:"请输入",modelValue:o(a).drugBaseExtension.gmp,"onUpdate:modelValue":t[13]||(t[13]=e=>o(a).drugBaseExtension.gmp=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:d(()=>[l(r,{label:"ATC编码:",prop:"atcCode"},{default:d(()=>[l(b,{placeholder:"请输入",modelValue:o(a).drugBaseExtension.atcCode,"onUpdate:modelValue":t[14]||(t[14]=e=>o(a).drugBaseExtension.atcCode=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:d(()=>[l(r,{label:"国家医保药品编码:",prop:"medicareCode","label-width":"180px"},{default:d(()=>[l(b,{placeholder:"请输入",modelValue:o(a).medicareCode,"onUpdate:modelValue":t[15]||(t[15]=e=>o(a).medicareCode=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(k,{class:"form-item-group"},{default:d(()=>[l(m,{span:8},{default:d(()=>[l(r,{label:"批准文号:",prop:"approvalNo"},{default:d(()=>[l(b,{placeholder:"请输入",modelValue:o(a).approvalNo,"onUpdate:modelValue":t[16]||(t[16]=e=>o(a).approvalNo=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:d(()=>[l(r,{label:"药交ID:",prop:"transactionId"},{default:d(()=>[l(b,{placeholder:"请输入",modelValue:o(a).drugBaseExtension.transactionId,"onUpdate:modelValue":t[17]||(t[17]=e=>o(a).drugBaseExtension.transactionId=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:8},{default:d(()=>[l(r,{label:"显示顺序:","label-width":"180px"},{default:d(()=>[l(F,{modelValue:o(a).sort,"onUpdate:modelValue":t[18]||(t[18]=e=>o(a).sort=e),"controls-position":"right",min:1,style:{width:"100px"}},null,8,["modelValue"]),l(_e,{content:"若未填写显示顺序，则默认为上级分类中的末位排序",placement:"top-start"},{default:d(()=>[l(ce,{class:"color-warning",style:{"margin-left":"8px","font-size":"18px"}},{default:d(()=>[l(O,{icon:"icon-xintishi"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(k,{class:"form-item-group"},{default:d(()=>[l(m,{span:24},{default:d(()=>[l(r,{label:"生产厂家:",prop:"manufacture"},{default:d(()=>[l(b,{placeholder:"请输入",modelValue:o(a).manufacture,"onUpdate:modelValue":t[19]||(t[19]=e=>o(a).manufacture=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(k,{class:"form-item-group"},{default:d(()=>[l(m,{span:24},{default:d(()=>[l(r,{label:"成份名:",prop:"ingredientDtoList"},{default:d(()=>[o(a).drugClassFlag!=="2"?(s(),f(X,{key:0,ref:"tableRef","table-name":"drug-detail-edit-table","table-data":o(a).ingredientDtoList,columns:o(ne),height:(o(a).ingredientDtoList.length+1)*36},{seq:d(e=>[e.row.isAdd?(s(),f(T,{key:0,text:"",onClick:i=>Y(e.scope.rowIndex)},{default:d(()=>[l(O,{icon:"icon-tianjia"})]),_:2},1032,["onClick"])):(s(),V("span",ze,R(e.scope.rowIndex+1),1))]),ingredient:d(e=>[e.row.isAdd?x("",!0):(s(),V("span",Ge,R(e.row.ingredient),1))]),ingredientType:d(e=>[e.row.isAdd?x("",!0):(s(),f(w,{key:0,modelValue:e.row.ingredientType,"onUpdate:modelValue":i=>e.row.ingredientType=i,placeholder:"请选择"},{default:d(()=>[(s(!0),V(A,null,B(o(v).wordbook.ingredient_type,i=>(s(),f(U,{key:i.id,label:i.dictLabel,value:i.dictValue},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),compatibilityType:d(e=>[e.row.isAdd?x("",!0):(s(),f(w,{key:0,modelValue:e.row.compatibilityType,"onUpdate:modelValue":i=>e.row.compatibilityType=i,placeholder:"请选择"},{default:d(()=>[(s(!0),V(A,null,B(o(v).wordbook.compatibility_type,i=>(s(),f(U,{key:i.id,label:i.dictLabel,value:i.dictValue},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),btns:d(e=>[e.row.isAdd?x("",!0):(s(),f(T,{key:0,text:"",type:"primary",onClick:i=>K(e)},{default:d(()=>[S("删除")]),_:2},1032,["onClick"]))]),_:1},8,["table-data","columns","height"])):(s(),f(X,{key:1,ref:"tableRef","table-name":"drug-detail-edit-table-other","table-data":o(a).ingredientDtoList,columns:o(oe),height:(o(a).ingredientDtoList.length+1)*36,"auto-resize":!0},{seq:d(e=>[e.row.isAdd?(s(),f(T,{key:0,text:"",onClick:i=>Y(e.scope.rowIndex)},{default:d(()=>[l(O,{icon:"icon-tianjia"})]),_:2},1032,["onClick"])):(s(),V("span",Je,R(e.scope.rowIndex+1),1))]),ingredient:d(e=>[e.row.isAdd?x("",!0):(s(),V("span",He,R(e.row.ingredient),1))]),ingredientType:d(e=>[e.row.isAdd?x("",!0):(s(),f(w,{key:0,modelValue:e.row.ingredientType,"onUpdate:modelValue":i=>e.row.ingredientType=i,placeholder:"请选择"},{default:d(()=>[(s(!0),V(A,null,B(o(v).wordbook.ingredient_type,i=>(s(),f(U,{key:i.id,label:i.dictLabel,value:i.dictValue},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),compatibilityType:d(e=>[e.row.isAdd?x("",!0):(s(),f(w,{key:0,modelValue:e.row.compatibilityType,"onUpdate:modelValue":i=>e.row.compatibilityType=i,placeholder:"请选择"},{default:d(()=>[(s(!0),V(A,null,B(o(v).wordbook.compatibility_type,i=>(s(),f(U,{key:i.id,label:i.dictLabel,value:i.dictValue},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),btns:d(e=>[e.row.isAdd?x("",!0):(s(),f(T,{key:0,text:"",type:"primary",onClick:i=>K(e)},{default:d(()=>[S("删除")]),_:2},1032,["onClick"]))]),_:1},8,["table-data","columns","height"]))]),_:1})]),_:1})]),_:1}),l(k,{class:"form-item-group"},{default:d(()=>[l(m,{span:24},{default:d(()=>[l(r,{label:"药性:",prop:"medicinalProperties"},{default:d(()=>[l(ye,{modelValue:o(a).drugBaseExtension.medicinalProperties,"onUpdate:modelValue":t[20]||(t[20]=e=>o(a).drugBaseExtension.medicinalProperties=e),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(he,{ref_key:"selectIngredientRef",ref:H,onGetData:ge},null,512)])}}}),rl=Pe(Ye,[["__scopeId","data-v-0fc57b8a"]]);export{rl as default};
