var j=(B,N,v)=>new Promise((k,p)=>{var w=d=>{try{b(v.next(d))}catch(c){p(c)}},C=d=>{try{b(v.throw(d))}catch(c){p(c)}},b=d=>d.done?k(d.value):Promise.resolve(d.value).then(w,C);b((v=v.apply(B,N)).next())});import{d as le,aj as te,P as L,r as m,b as T,a0 as ae,m as f,T as oe,o as u,c as y,y as n,s,x as E,p as a,t as ne,q as g,n as J,F as V,A as h,a6 as se,av as re,ah as ie,_ as ue}from"./index-1fQ0gozz.js";import{j as de,k as ce}from"./indication-BrfvaLV3.js";const pe={class:"edit-cf-edit-container"},me={class:"radio-bg"},fe={class:"radio-bg"},ge=le({__name:"editRepeatedMedicationDiag",props:{ruleForm:{type:Object,default:()=>{}}},emits:["query"],setup(B,{expose:N,emit:v}){const k=te(),p=B,w=L("cfData"),C=L("currentPharmacologyDrugNodeData"),b=L("$baseMessage"),d=m(!1),c=m(!1),x=m(""),U=m([]),M=v,F=m(null),R=m([{label:"同成份",value:"1"},{label:"同药理作用",value:"2"}]),P=m([{label:"是",value:"1"},{label:"否",value:"0"}]),O=m(),l=T({id:"",type:"1",drugsB:"",principalComponents:[],interactionAction:[],severity:"0",whetherOverstepSynopsis:"0",reference:"",tipContent:"",warnSign:"",active:"0"}),$=T(JSON.parse(JSON.stringify(l))),K={drugsB:[{required:!0,message:"请选择药物B"}],principalComponents:[{required:!0,message:"请选择主成份名称"}]},z=(r,t)=>{d.value=!0,O.value=t,re(()=>{if(t=="add")x.value="新增重复用药",delete l.id,l.interactionAction=[];else{x.value="编辑重复用药";let o=JSON.parse(JSON.stringify(r));o.type==="2"?o.principalComponents=[]:o.principalComponents=o.interactionAction.split(","),G(o,p.ruleForm.id)==="drugsA"?(o.drugsB=r.drugsB,o.drugsBName=r.drugsBName):(o.drugsB=r.drugsA,o.drugsBName=r.drugsAName),Object.assign(l,o),typeof l.interactionAction=="string"&&(l.interactionAction=l.interactionAction?l.interactionAction.split(","):[])}})},G=(r,t)=>Object.keys(r).find(o=>r[o]===t),D=()=>{Object.assign(l,$),F.value.resetFields(),d.value=!1},H=()=>{if(l.drugsB===p.ruleForm.id){b("选择的药物B不能与药物A相同","warning","hey");return}F.value.validate(r=>j(this,null,function*(){if(r)try{c.value=!0;let t=Object.assign({},l,{interactionAction:l.type==="1"?l.principalComponents.join(","):C.value.classifyCode,drugsA:p.ruleForm.id,drugsAName:p.ruleForm.label,drugsBName:w.value.find(_=>_.id===l.drugsB).label});const o=yield de([t]);c.value=!1,b(o.msg,"success","hey"),M("query"),D()}catch(t){c.value=!1}}))},Q=()=>j(this,null,function*(){let{data:r}=yield ce({drugsId:p.ruleForm.id}),t=r.filter(o=>o.ingredientType==="1");U.value=W(t,"ingredientId")});function W(r,t=""){const o=[],_=[];return t?r.forEach(i=>{_.includes(i[t])||(_.push(i[t]),o.push(i))}):r.forEach(i=>o.includes(i)?"":o.push(i)),o}return N({showDiag:z}),ae(()=>{Q()}),(r,t)=>{const o=f("el-radio"),_=f("el-radio-group"),i=f("el-form-item"),A=f("el-input"),I=f("el-option"),S=f("el-select"),X=f("el-form"),q=f("el-button"),Y=ie,Z=oe("loading");return u(),y("div",pe,[n(Y,{modelValue:a(d),"onUpdate:modelValue":t[7]||(t[7]=e=>se(d)?d.value=e:null),title:a(x),width:"826px",modal:!1,"append-to-body":"",onClose:D,class:"no-form-line-margin pointerEvents"},{footer:s(()=>[n(q,{onClick:D},{default:s(()=>[E("取 消")]),_:1}),n(q,{disabled:a(c)||a(O)==="check",type:"primary",onClick:H},{default:s(()=>[E("确 定")]),_:1},8,["disabled"])]),default:s(()=>[ne((u(),g(X,{ref_key:"formRef",ref:F,model:a(l),"label-width":"120px",rules:K,disabled:a(O)==="check"},{default:s(()=>[n(i,{label:"类型"},{default:s(()=>[J("div",me,[n(_,{modelValue:a(l).type,"onUpdate:modelValue":t[0]||(t[0]=e=>a(l).type=e)},{default:s(()=>[(u(!0),y(V,null,h(a(R),(e,ee)=>(u(),g(o,{value:e.value,label:e.label},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])])]),_:1}),n(i,{label:"药物A"},{default:s(()=>[n(A,{value:B.ruleForm.label,disabled:""},null,8,["value"])]),_:1}),n(i,{label:"药物B",prop:"drugsB"},{default:s(()=>[n(S,{modelValue:a(l).drugsB,"onUpdate:modelValue":t[1]||(t[1]=e=>a(l).drugsB=e),placeholder:"请选择药物B"},{default:s(()=>[(u(!0),y(V,null,h(a(w),e=>(u(),g(I,{label:e.label,value:e.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(l).type==="1"?(u(),g(i,{key:0,label:"主成份名称",prop:"principalComponents"},{default:s(()=>[n(S,{modelValue:a(l).principalComponents,"onUpdate:modelValue":t[2]||(t[2]=e=>a(l).principalComponents=e),placeholder:"请选择主成份名称",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":4},{default:s(()=>[(u(!0),y(V,null,h(a(U),e=>(u(),g(I,{label:e.ingredient,value:e.ingredientId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):(u(),g(i,{key:1,label:"药理作用"},{default:s(()=>[n(A,{value:a(C).classifyName,disabled:""},null,8,["value"])]),_:1})),n(i,{label:"问题等级"},{default:s(()=>[n(S,{modelValue:a(l).severity,"onUpdate:modelValue":t[3]||(t[3]=e=>a(l).severity=e),placeholder:"请选择"},{default:s(()=>[(u(!0),y(V,null,h(a(k).wordbook.problem_level_rule,e=>(u(),g(I,{key:e.dictLabel,label:e.dictLabel,value:e.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(i,{label:"是否超说明书用药"},{default:s(()=>[J("div",fe,[n(_,{modelValue:a(l).whetherOverstepSynopsis,"onUpdate:modelValue":t[4]||(t[4]=e=>a(l).whetherOverstepSynopsis=e)},{default:s(()=>[(u(!0),y(V,null,h(a(P),(e,ee)=>(u(),g(o,{value:e.value,label:e.label},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])])]),_:1}),n(i,{label:"参考文献"},{default:s(()=>[n(A,{modelValue:a(l).reference,"onUpdate:modelValue":t[5]||(t[5]=e=>a(l).reference=e),placeholder:"请输入",type:"textarea",style:{width:"100%"},rows:3,maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),n(i,{label:"提示内容"},{default:s(()=>[n(A,{modelValue:a(l).tipContent,"onUpdate:modelValue":t[6]||(t[6]=e=>a(l).tipContent=e),placeholder:"请输入",type:"textarea",style:{width:"100%"},rows:4,maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","disabled"])),[[Z,a(c)]])]),_:1},8,["modelValue","title"])])}}}),ye=ue(ge,[["__scopeId","data-v-3391215d"]]);export{ye as default};
