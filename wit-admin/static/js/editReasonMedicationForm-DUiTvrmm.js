var N=(C,J,A)=>new Promise((z,v)=>{var M=g=>{try{q(A.next(g))}catch(E){v(E)}},V=g=>{try{q(A.throw(g))}catch(E){v(E)}},q=g=>g.done?z(g.value):Promise.resolve(g.value).then(M,V);q((A=A.apply(C,J)).next())});import{d as we,P as Y,r as R,b as Z,m,T as ke,o as u,q as y,s as i,y as t,x as h,p as a,n as r,t as xe,c as f,F as w,A as U,a7 as Ve,z as x,B as I,ap as Oe,a6 as Te,H as Ce,ah as Ae,I as qe,J as Ee,_ as De}from"./index-9sA7DK8G.js";import Ue from"./previewFormDioag-D3NARRB3.js";import{h as Fe,g as Se,i as Be}from"./medicationReason-Mpi8QITe.js";const $=C=>(qe("data-v-7a1be1cb"),C=C(),Ee(),C),Ne={class:"radio-bg",style:{display:"flex","align-items":"center"}},Re={class:"common-attention"},Ie={class:"form-content"},$e={class:"form-content-left"},Je={style:{width:"100%","text-align":"center"}},ze=$(()=>r("span",null,"添加选项",-1)),Me={class:"form-content-left-height"},Pe={style:{padding:"12px 8px 14px"}},Qe={key:0,class:"label-required"},Ge={class:"label-text"},He={style:{padding:"0px 8px 12px"}},Ke={class:"common-attention"},We={class:"upload-tip"},Xe={style:{"text-align":"center"}},Ye=$(()=>r("div",{style:{display:"inline"}},"上传图片",-1)),Ze={class:"form-item-cell-footer"},je=["onClick"],et={class:"form-content-right"},tt={class:"radio-bg"},lt={style:{width:"100%"}},ot={style:{display:"flex",width:"100%"}},nt=$(()=>r("span",null,"添加一级",-1)),it=["onClick"],st={class:"second_level_line"},at=["onClick"],dt={class:"second_level_add",style:{"margin-bottom":"12px"}},ut=$(()=>r("span",null,"添加二级",-1)),rt={key:1,class:"common-attention tip-icon"},ct={class:"common-attention"},pt={class:"radio-bg"},_t={style:{"padding-top":"20px","text-align":"center"}},mt=we({__name:"editReasonMedicationForm",emits:["query"],setup(C,{expose:J,emit:A}){const z=A,v=Y("$baseMessage"),M=Y("$baseConfirm"),V=R(!1),q=R(!1),g=R(""),E=R(null),j={rmGeneralId:[{required:!0,message:"请选择溶媒",trigger:"change"}]},n=Z({name:"",dosageId:"",detailList:[],isRequired:"1",id:"",status:"0"}),ee=JSON.parse(JSON.stringify(n)),d=Z({questionType:"1",title:"",optionOneLevel:"",optionOneLevelList:[{value:"",type:"radio",child:[]}],optionTwoLevel:"",hintLanguage:"",writeLimit:null,isMustAnswer:"0",optionTwoQuestionType:""}),F={questionType:"1",title:"",optionOneLevel:"",optionOneLevelList:[{value:"",type:"radio",child:[]}],optionTwoLevel:"",hintLanguage:"",writeLimit:null,isMustAnswer:"0",optionTwoQuestionType:""},te=[{text:"编辑",icon:"Edit",type:"1"},{text:"复制",icon:"CopyDocument",type:"2"},{text:"上移",icon:"Top",type:"3"},{text:"下移",icon:"Bottom",type:"4"},{text:"删除",icon:"Delete",type:"5"}];function le(o,e,s){return N(this,null,function*(){if(n.dosageId=s,e=="add")g.value="新增用药理由表单";else{g.value="编辑用药理由表单";let{data:_}=yield Fe({id:o.id});Object.assign(n,o,_),n.detailList.forEach(c=>{let L=c.optionOneLevel?c.optionOneLevel.split(";"):[],b=c.optionTwoLevel?c.optionTwoLevel.split(";"):[],S=c.optionTwoQuestionType?c.optionTwoQuestionType.split(";"):[];c.optionOneLevelList=L.map((k,O)=>{let P=b[O]?b[O].split(":").map(Q=>({value:Q})):[];return console.log(b[O],S[O],"arr1[n]"),{value:k,child:P,type:S[O]}})})}V.value=!0})}function oe(){let o=[];if((n.detailList||[]).map(e=>{e.isAdd&&o.push(e)}),o.length){v("请先保存右侧数据","warning","hey");return}n.detailList.push(Object.assign({},F,{isAdd:!0})),Object.assign(d,F,{isAdd:!0})}function ne(){d.optionOneLevelList.push({value:"",type:"radio",child:[]})}function ie(o){if(!o.value){v("请先补充一级选项","error","hey");return}o.child.push({value:""})}function K(){V.value=!1,Object.assign(n,ee)}function se(){n.detailList.forEach((o,e)=>{o.isAdd&&(o.isEdit?(n.detailList[e].isAdd=!1,n.detailList[e].isEdit=!1):n.detailList.splice(e,1))}),Object.assign(d,F,{isAdd:!1})}function ae(){if(!d.title){v("请填写标题","error","hey");return}n.detailList.forEach(o=>{o.isAdd&&Object.assign(o,d,{isAdd:!1,isEdit:!1})}),Object.assign(d,F,{isAdd:!1,optionOneLevelList:[{value:"",type:"radio",child:[]}]}),F.optionOneLevelList=[{value:"",type:"radio",child:[]}],d.optionOneLevelList=[]}function de(o){d.optionOneLevelList.splice(o,1)}function ue(o,e){d.optionOneLevelList[o].child.splice(e,1)}function re(){return N(this,null,function*(){if(!n.name){v("请先填写表单名称","warning","hey");return}let o=JSON.parse(JSON.stringify(n)),e=(o.detailList||[]).filter(s=>s.isAdd==!0);if(e&&e.length){v("请先保存右侧数据","warning","hey");return}o.detailList.forEach(s=>{s.optionTwoLevel="",s.optionOneLevel=(s.optionOneLevelList||[]).map(_=>_.value).join(";"),s.optionTwoQuestionType=(s.optionOneLevelList||[]).map(_=>_.type).join(";"),(s.optionOneLevelList||[]).forEach(_=>{let c="";_.child&&_.child.length&&_.child.forEach((L,b)=>{c?c=c+":"+L.value:c=c+L.value}),s.optionTwoLevel=s.optionTwoLevel+c+";"})});try{let{msg:s}=n.id?yield Se(o):yield Be(o);v(s,"success","hey"),z("query"),K()}catch(s){}})}function ce(o,e){let _=(JSON.parse(JSON.stringify(n)).detailList||[]).filter(c=>c.isAdd==!0);if(_&&_.length){v("请先保存右侧数据","warning","hey");return}o.type=="5"?M("您确定要删除当前项吗",null,()=>N(this,null,function*(){n.detailList.splice(e,1),v("删除成功","success","hey")})):o.type=="4"?n.detailList=me(n.detailList,e):o.type=="3"?n.detailList=_e(n.detailList,e):o.type=="2"?n.detailList.push(Object.assign({},n.detailList[e],{isAdd:!1,isEdit:!1})):o.type=="1"&&(n.detailList[e].isEdit=!0,n.detailList[e].isAdd=!0,Object.assign(d,n.detailList[e],{isAdd:!0,isEdit:!0}),console.log(d,n.detailList[e],"checkForm"))}function pe(){let e=(JSON.parse(JSON.stringify(n)).detailList||[]).filter(s=>s.isAdd==!0);if(!n.detailList.length){v("请先添加选项","warning","hey");return}if(e&&e.length){v("请先保存右侧数据","warning","hey");return}E.value.showDiag(n)}function _e(o,e){if(e!=0&&o.length>1){let s=o;return s[e]=s.splice(e-1,1,s[e])[0],[...s]}else return v("无法上移","warning","hey"),o}function me(o,e){if(e!=o.length-1&&o.length>1){let s=o;return s[e]=s.splice(e+1,1,s[e])[0],[...s]}else return v("无法下移","warning","hey"),o}return J({showDiag:le}),(o,e)=>{const s=m("el-input"),_=m("el-form-item"),c=m("el-radio"),L=m("el-radio-group"),b=Ce,S=m("el-form"),k=m("el-button"),O=m("el-checkbox"),P=m("el-checkbox-group"),Q=m("Plus"),D=m("el-icon"),fe=m("el-upload"),ve=m("Edit"),ye=m("CopyDocument"),he=m("Top"),ge=m("Bottom"),G=m("Delete"),W=m("CirclePlus"),X=m("el-input-number"),Le=Ae,be=ke("loading");return u(),y(Le,{modelValue:a(V),"onUpdate:modelValue":e[9]||(e[9]=l=>Te(V)?V.value=l:null),fullscreen:"",title:a(g),onClose:K,class:"edit_reason_form_dialog"},{footer:i(()=>[t(k,{onClick:pe},{default:i(()=>[h("预 览")]),_:1}),t(k,{disabled:a(q),type:"primary",onClick:re},{default:i(()=>[h("确 定")]),_:1},8,["disabled"])]),default:i(()=>[r("div",null,[xe((u(),y(S,{ref:"formRef",model:a(n),"label-width":"72px",rules:j,class:"first-level"},{default:i(()=>[t(_,{label:"表单名称"},{default:i(()=>[t(s,{placeholder:"请输入，限50个字符",maxlength:50,modelValue:a(n).name,"onUpdate:modelValue":e[0]||(e[0]=l=>a(n).name=l)},null,8,["modelValue"])]),_:1}),t(_,{label:"是否必填"},{default:i(()=>[r("div",Ne,[t(L,{modelValue:a(n).isRequired,"onUpdate:modelValue":e[1]||(e[1]=l=>a(n).isRequired=l)},{default:i(()=>[t(c,{value:"1",label:"必填"}),t(c,{value:"0",label:"选填"})]),_:1},8,["modelValue"]),r("span",Re,[t(b,{icon:"icon-xintishi"}),h(" 提示：勾选必填，则在医生端弹出表单时，必须填写至少一项 ")])])]),_:1})]),_:1},8,["model"])),[[be,a(q)]]),r("div",Ie,[r("div",$e,[r("div",Je,[t(k,{type:"primary",size:"large",style:{width:"160px","margin-bottom":"14px"},onClick:oe},{default:i(()=>[t(b,{icon:"icon-xinzengdianpingjihua"}),ze]),_:1}),r("div",Me,[a(n).detailList&&a(n).detailList.length?(u(!0),f(w,{key:0},U(a(n).detailList,(l,T)=>(u(),f(w,null,[!l.isAdd||l.isAdd&&l.isEdit?(u(),f("div",{key:T,class:Ve({"form-item-cell":!0,"active-cell":!!l.isEdit})},[r("div",Pe,[l.isMustAnswer=="1"?(u(),f("span",Qe,"*")):x("",!0),r("span",Ge,I(l.title),1)]),r("div",He,[l.questionType=="1"?(u(),y(L,{key:0,class:"flex-column"},{default:i(()=>[(u(!0),f(w,null,U(l.optionOneLevelList,p=>(u(),f("div",{key:p.value},[t(c,{disabled:"",value:p.value,label:p.value},{default:i(()=>[h(I(p.value),1)]),_:2},1032,["value","label"])]))),128))]),_:2},1024)):l.questionType=="2"?(u(),y(P,{key:1,class:"flex-column"},{default:i(()=>[(u(!0),f(w,null,U(l.optionOneLevelList,p=>(u(),y(O,{key:p.value,label:p.value,value:p.value,disabled:""},null,8,["label","value"]))),128))]),_:2},1024)):l.questionType=="3"?(u(),y(s,{key:2,placeholder:l.hintLanguage,disabled:""},null,8,["placeholder"])):l.questionType=="4"?(u(),f(w,{key:3},[r("div",Ke,[t(b,{icon:"icon-xintishi"}),h(" "+I(l.hintLanguage),1)]),t(fe,{action:"#","list-type":"picture-card","auto-upload":!1,disabled:"",class:"upload-box"},{default:i(()=>[r("div",We,[r("div",Xe,[t(D,{size:"14px"},{default:i(()=>[t(Q)]),_:1})]),Ye])]),_:1})],64)):x("",!0)]),r("div",Ze,[(u(),f(w,null,U(te,(p,B)=>r("div",{key:B,onClick:H=>ce(p,T)},[t(D,null,{default:i(()=>[p.icon=="Edit"?(u(),y(ve,{key:0})):p.icon=="CopyDocument"?(u(),y(ye,{key:1})):p.icon=="Top"?(u(),y(he,{key:2})):p.icon=="Bottom"?(u(),y(ge,{key:3})):p.icon=="Delete"?(u(),y(G,{key:4})):x("",!0)]),_:2},1024),r("div",null,I(p.text),1)],8,je)),64))])],2)):x("",!0)],64))),256)):x("",!0)])])]),r("div",et,[a(n).detailList.length&&a(d).questionType&&a(d).isAdd?(u(),y(S,{key:0,"label-width":"92px"},{default:i(()=>[t(_,{label:"题型"},{default:i(()=>[r("div",tt,[t(L,{modelValue:a(d).questionType,"onUpdate:modelValue":e[2]||(e[2]=l=>a(d).questionType=l)},{default:i(()=>[t(c,{value:"1",label:"单选"}),t(c,{value:"2",label:"多选"}),t(c,{value:"3",label:"填空"}),t(c,{value:"4",label:"上传"})]),_:1},8,["modelValue"])])]),_:1}),t(_,{label:"标题"},{default:i(()=>[t(s,{placeholder:"请输入，限50个字符",maxlength:50,modelValue:a(d).title,"onUpdate:modelValue":e[3]||(e[3]=l=>a(d).title=l)},null,8,["modelValue"])]),_:1}),a(d).questionType=="1"||a(d).questionType=="2"?(u(),y(_,{key:0,label:"选项"},{default:i(()=>[r("div",lt,[(u(!0),f(w,null,U(a(d).optionOneLevelList,(l,T)=>(u(),f("div",{key:T},[r("div",ot,[t(s,{placeholder:"请输入，限50个字符",maxlength:50,style:{width:"100%"},modelValue:l.value,"onUpdate:modelValue":p=>l.value=p},null,8,["modelValue","onUpdate:modelValue"]),T===0?(u(),y(k,{key:0,onClick:ne,style:{"margin-left":"12px"}},{default:i(()=>[t(D,{size:"16px"},{default:i(()=>[t(W)]),_:1}),nt]),_:1})):(u(),f("span",{key:1,class:"delete-icon",onClick:p=>de(T)},[t(D,null,{default:i(()=>[t(G)]),_:1})],8,it))]),r("div",null,[(u(!0),f(w,null,U(l.child,(p,B)=>(u(),f("div",{class:"second_level",key:B,style:Oe(B===0?"":"margin-top:8px;")},[r("div",st,[t(s,{placeholder:"请输入，限50个字符",maxlength:50,modelValue:p.value,"onUpdate:modelValue":H=>p.value=H},null,8,["modelValue","onUpdate:modelValue"]),r("span",{class:"delete-icon",onClick:H=>ue(T,B)},[t(D,null,{default:i(()=>[t(G)]),_:1})],8,at)])],4))),128)),r("div",dt,[t(k,{onClick:p=>ie(l)},{default:i(()=>[t(D,{size:"16px"},{default:i(()=>[t(W)]),_:1}),ut]),_:2},1032,["onClick"]),l.child&&l.child.length?(u(),y(L,{key:0,modelValue:l.type,"onUpdate:modelValue":p=>l.type=p,style:{"margin-left":"4px"}},{default:i(()=>[t(c,{value:"radio",label:"单选"},{default:i(()=>[h("单选")]),_:1}),t(c,{value:"checkbox",label:"多选"},{default:i(()=>[h("多选")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])):x("",!0),l.value?x("",!0):(u(),f("span",rt,[t(b,{icon:"icon-xintishi"}),h(" 请先补充一级选项 ")]))])])]))),128))])]),_:1})):a(d).questionType=="3"?(u(),f(w,{key:1},[t(_,{label:"填空提示语"},{default:i(()=>[t(s,{placeholder:"请详细填写",maxlength:50,modelValue:a(d).hintLanguage,"onUpdate:modelValue":e[4]||(e[4]=l=>a(d).hintLanguage=l)},null,8,["modelValue"])]),_:1}),t(_,{label:"填空限制字数"},{default:i(()=>[t(X,{"controls-position":"right",modelValue:a(d).writeLimit,"onUpdate:modelValue":e[5]||(e[5]=l=>a(d).writeLimit=l)},null,8,["modelValue"]),h(" 字 ")]),_:1})],64)):a(d).questionType=="4"?(u(),f(w,{key:2},[t(_,{label:"上传提示语"},{default:i(()=>[t(s,{placeholder:"请详细填写",maxlength:50,modelValue:a(d).hintLanguage,"onUpdate:modelValue":e[6]||(e[6]=l=>a(d).hintLanguage=l)},null,8,["modelValue"])]),_:1}),t(_,{label:"上传份数限制"},{default:i(()=>[t(X,{"controls-position":"right",max:9,min:0,modelValue:a(d).writeLimit,"onUpdate:modelValue":e[7]||(e[7]=l=>a(d).writeLimit=l)},null,8,["modelValue"]),h(" 份 "),r("span",ct,[t(b,{icon:"icon-xintishi"}),h(" 每次最多上传9张 ")])]),_:1})],64)):x("",!0),t(_,{label:"是否必答"},{default:i(()=>[r("div",pt,[t(L,{modelValue:a(d).isMustAnswer,"onUpdate:modelValue":e[8]||(e[8]=l=>a(d).isMustAnswer=l)},{default:i(()=>[t(c,{value:"1",label:"是"}),t(c,{value:"0",label:"否"})]),_:1},8,["modelValue"])])]),_:1}),r("div",_t,[t(k,{onClick:se},{default:i(()=>[h("取 消")]),_:1}),t(k,{type:"primary",onClick:ae},{default:i(()=>[h("保 存")]),_:1})])]),_:1})):x("",!0)])])]),t(Ue,{ref_key:"previewFormDioagRef",ref:E},null,512)]),_:1},8,["modelValue","title"])}}}),gt=De(mt,[["__scopeId","data-v-7a1be1cb"]]);export{gt as default};
