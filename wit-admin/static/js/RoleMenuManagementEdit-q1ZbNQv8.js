var v=(x,g,u)=>new Promise((p,f)=>{var t=e=>{try{l(u.next(e))}catch(n){f(n)}},b=e=>{try{l(u.throw(e))}catch(n){f(n)}},l=e=>e.done?p(e.value):Promise.resolve(e.value).then(t,b);l((u=u.apply(x,g)).next())});import{d as j,P as S,r as _,b as q,h as A,m,T as F,o as C,q as R,s,y as i,x as h,p as o,t as L,B as w,n as V,a6 as O,av as P,ah as U,_ as z}from"./index-BN8uVNSO.js";import{g as G,e as H,f as J}from"./roleManagement-BieDH4-L.js";const Q={class:"wit-tree-border"},W=j({name:"RoleMenuManagementEdit",__name:"RoleMenuManagementEdit",setup(x,{expose:g}){const u=S("$baseMessage"),p=_(null),f=_(null),t=q({menuIds:[]}),b=_("菜单权限"),l=_(!1),e=_(!1),n=_([]),D=c=>{l.value=!0,e.value=!0,P(()=>v(this,null,function*(){f.value.setCheckedKeys([]),Object.assign(t,c);const{data:a}=yield G(t.roleId);a.admin?t.menuIds=y(n.value,!0):(y(n.value,!1),t.menuIds=a.menuIds),e.value=!1}))};function y(c,a){const d=[];return c.forEach(r=>{r.disabled=a,d.push(r.id),r.children&&d.push(...y(r.children,a))}),d}g({showEdit:D});const k=()=>{l.value=!1},B=()=>v(this,null,function*(){const{data:c}=yield H();n.value=c}),N=()=>{p.value.validate(c=>v(this,null,function*(){if(c)try{e.value=!0;const a=f.value.getCheckedKeys(),{msg:d}=yield J({roleId:t.roleId,menuIds:a});u(d,"success","hey"),e.value=!1,k()}catch(a){e.value=!1}}))};return A(()=>{B()}),(c,a)=>{const d=m("el-tag"),r=m("el-form-item"),E=m("el-tree"),T=m("el-form"),M=m("el-button"),K=U,$=F("loading");return C(),R(K,{modelValue:o(l),"onUpdate:modelValue":a[0]||(a[0]=I=>O(l)?l.value=I:null),title:o(b),"append-to-body":"",width:"500px",onClose:k},{footer:s(()=>[i(M,{onClick:k},{default:s(()=>[h("取 消")]),_:1}),i(M,{disabled:o(e),type:"primary",onClick:N},{default:s(()=>[h("确 定")]),_:1},8,["disabled"])]),default:s(()=>[L((C(),R(T,{ref_key:"formRef",ref:p,model:o(t),"label-width":"80px"},{default:s(()=>[i(r,{label:"角色名称"},{default:s(()=>[i(d,null,{default:s(()=>[h(w(o(t).roleName),1)]),_:1})]),_:1}),i(r,{label:"角色标识"},{default:s(()=>[i(d,null,{default:s(()=>[h(w(o(t).roleKey),1)]),_:1})]),_:1}),i(r,{label:"菜单"},{default:s(()=>[V("div",Q,[i(E,{ref_key:"treeRef",ref:f,data:o(n),"default-checked-keys":o(t).menuIds,"node-key":"id","show-checkbox":""},{default:s(({data:I})=>[V("span",null,w(I.label),1)]),_:1},8,["data","default-checked-keys"])])]),_:1})]),_:1},8,["model"])),[[$,o(e)]])]),_:1},8,["modelValue","title"])}}}),ee=z(W,[["__scopeId","data-v-ff8ef94e"]]);export{ee as default};
