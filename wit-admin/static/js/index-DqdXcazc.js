var y=(k,v,u)=>new Promise((c,d)=>{var b=a=>{try{f(u.next(a))}catch(m){d(m)}},n=a=>{try{f(u.throw(a))}catch(m){d(m)}},f=a=>a.done?c(a.value):Promise.resolve(a.value).then(b,n);f((u=u.apply(k,v)).next())});import{m as $,a as M,_ as I}from"./medicationPermissionsEdit-BN_muIC6.js";import{d as j,P as A,aj as H,r as l,b as q,h as Q,m as U,o as G,c as J,n as E,y as p,p as r,a6 as K,a7 as X,s as R,C as Y,x as Z,av as V,H as ee,af as te,ag as ae}from"./index-1fQ0gozz.js";import{_ as se}from"./index.vue_vue_type_style_index_0_lang-CmHiYd40.js";import"./ifComponent.vue_vue_type_style_index_0_lang-BOVwK668.js";import"./index-BueAkiiY.js";import"./index.vue_vue_type_script_setup_true_lang-BLW0x7SH.js";import"./dict-Cq6Rfk1f.js";const ie={class:"rule-container auto-height-container"},ne={class:"app-content padding-out"},oe={class:"app-pagination"},ge=j({__name:"index",setup(k){const v=A("$baseMessage"),u=H(),c=l(!0),d=l(!1),b=l(),n=l({keyword:"",pageSize:20,pageNum:1,antibioticsPrescPermission:"",tumorDrugsPrescPermissionOp:"",tumorDrugsPrescPermissionIp:""}),f=q({searchListButtons:[{label:"批量设置",icon:"icon-piliangcaozuo",attrs:{plain:!0,type:"primary"},events:{click:x}}],searchList:[{type:"input",field:"keyword",attrs:{width:200,placeholder:"请输入科室或用户名搜索",clearable:!0},events:{change:a,clear:a}},{type:"select",field:"antibioticsPrescPermission",label:"抗菌药物处方权级别",valueField:"dictValue",labelField:"dictLabel",isOutBorder:!0,options:u.wordbook.antibiotics_type,attrs:{width:130,clearable:!0,collapseTags:!0},events:{change:a}},{type:"select",field:"tumorDrugsPrescPermissionOp",label:"抗菌药物处方权(门诊)",valueField:"dictValue",labelField:"dictLabel",isOutBorder:!0,options:u.wordbook.antibiotics_type,attrs:{width:130,clearable:!0,collapseTags:!0},events:{change:a}},{type:"select",field:"tumorDrugsPrescPermissionIp",label:"抗菌药物处方权(住院)",valueField:"dictValue",labelField:"dictLabel",isOutBorder:!0,options:u.wordbook.antibacterial_medication_permissions,attrs:{width:130,clearable:!0,collapseTags:!0},events:{change:a}}],otherSearchList:[]});function a(){b.value.search()}const m=l(null),h=l([]),P=l(0),z=l([{width:"40",type:"checkbox"},{field:"userName",title:"工号",minWidth:"120"},{field:"nickName",title:"用户名称",minWidth:"130"},{field:"positionName",title:"职称",minWidth:"140"},{field:"phonenumber",title:"手机号码",minWidth:"140"},{field:"antibioticsPrescPermissionName",title:"抗菌药物处方权",minWidth:"140"},{field:"tumorDrugsPrescPermissionOpName",title:"抗肿瘤药物处方权(门诊)",minWidth:"140"},{field:"tumorDrugsPrescPermissionIpName",title:"抗肿瘤药物处方权(住院)",minWidth:"140"},{field:"btns",title:"操作",align:"center",width:"120",fixed:"right",render:!0}]),w=l(null);function x(e={}){if(e.userName)w.value.showEdit(e,[]);else{if(o.value.length==0){v("请先勾选用户","warning","hey");return}w.value.showEdit("",o.value)}}function B(e){n.value.pageNum=1,n.value.pageSize=e,g(!0)}function D(e){n.value.pageNum=e,g(!0)}function g(e){return y(this,null,function*(){e||N(),c.value=!0;try{const{data:t}=yield $(n.value);c.value=!1,h.value=(t.records||t).map(s=>{let i=!1;return o.value.forEach((_,S)=>{s.userName==_.userName&&(i=!0)}),Object.assign({},s,{isSelected:i})}),P.value=t.total,V(()=>{const s=h.value.filter(i=>{if(i.isSelected)return i});m.value.tableMethods("setCheckboxRow",s,!0)})}catch(t){c.value=!1,h.value=[],P.value=0}})}const o=l([]),L=({checked:e})=>{e?h.value.forEach(t=>{let s=!1;o.value.forEach((i,_)=>{t.userName==i.userName&&(s=!0)}),s||o.value.push(t)}):h.value.forEach(t=>{o.value.forEach((s,i)=>{t.userName==s.userName&&o.value.splice(i,1)})})},T=({checked:e,row:t})=>{e?o.value.push(t):o.value.forEach((s,i)=>{t.userName==s.userName&&o.value.splice(i,1)})},N=()=>{o.value=[],V(()=>{m.value.tableMethods("clearCheckboxRow")})};function F(){return y(this,null,function*(){c.value=!0,d.value=!0;let e=yield M();c.value=!1,d.value=!1,v(e.msg,"info","hey")})}return Q(()=>{g()}),(e,t)=>{const s=se,i=ee,_=U("el-button"),S=te,O=ae,W=I;return G(),J("div",ie,[E("div",ne,[p(s,{ref_key:"refSearch",ref:b,modelValue:r(n),"onUpdate:modelValue":t[0]||(t[0]=C=>K(n)?n.value=C:null),"search-data":r(f),"search-name":"matchingTools-medicationPermissions",searching:r(c),onSearch:g,isCache:!1,showResult:!1},null,8,["modelValue","search-data","searching"]),p(i,{icon:"icon-gengxin",class:X({"refresh-icon":!0,"loading-animation":r(d)}),onClick:F,style:{position:"absolute",top:"22px",right:"31px",width:"27px",padding:"4px"}},null,8,["class"]),p(S,{ref_key:"tableRef",ref:m,"table-name":"medicationPermissions-table",loading:r(c),"table-data":r(h),columns:r(z),isShowTableSet:!1,"checkbox-config":{trigger:"row"},onCheckboxAll:L,onCheckboxChange:T},{btns:R(C=>[p(_,{text:"",type:"primary",onClick:Y(le=>x(C.row),["stop"])},{default:R(()=>[Z("编辑")]),_:2},1032,["onClick"])]),_:1},8,["loading","table-data","columns"])]),E("div",oe,[p(O,{"current-page":r(n).pageNum,"page-size":r(n).pageSize,total:r(P),"prev-text":"上一页","next-text":"下一页",onCurrentChange:D,onSizeChange:B},null,8,["current-page","page-size","total"])]),p(W,{ref_key:"medicationPermissionsRef",ref:w,onQuery:g,onResetingVal:N},null,512)])}}});export{ge as default};
