var k=($,L,N)=>new Promise((U,h)=>{var C=g=>{try{v(N.next(g))}catch(I){h(I)}},B=g=>{try{v(N.throw(g))}catch(I){h(I)}},v=g=>g.done?U(g.value):Promise.resolve(g.value).then(C,B);v((N=N.apply($,L)).next())});import{d as ce,aj as fe,P as me,r as m,b as F,m as y,T as pe,o as s,c as w,y as o,s as t,x,p as l,b9 as ye,q as p,z as R,t as _e,F as E,A as S,aW as ve,C as be,ap as we,B as G,a6 as he,bt as Ce,ag as Ie,ah as Ve,_ as ke}from"./index-1fQ0gozz.js";import{N as xe,O as Ne,P as H}from"./indication-BrfvaLV3.js";const Ee={class:"edit-cf-edit-container"},Se=ce({__name:"editIncompatibilityPrescriptionDiag",emits:["query"],setup($,{expose:L,emit:N}){const U=N,h=fe(),C=me("$baseMessage"),B=m("add"),v=m(!1),g=m(!1),I=m(!1),T=m(""),D=m(),O=m([]),c=F({keyword:"",pageNum:1,pageSize:20,total:0}),Q=m([{label:"是",value:"1"},{label:"否",value:"0"}]),e=F({id:"",generalId:"",generalInfo:"",warnSign:"0",severity:"",isSuper:"0",reference:"",tipContent:"",generalInfoExtensions:[],matchType:"1",drugClassfiy:""}),X=F({"generalInfoExtensions[1].generalName":[{required:!0,message:"请选择通用名B"}],drugClassfiy:[{required:!0,message:"请选择药理分类"}]}),V=m([]),Z=m(["A","B","C","D","E"]),M=m([]),ee=()=>{V.value.length!=5&&(M.value=Array.from({length:5-(e.generalInfoExtensions.length||1)},(r,a)=>a),M.value.forEach(r=>{V.value.push({generalId:"",generalName:""})}))},ae=(r,a,u)=>k(this,null,function*(){if(se(),e.generalId=u.id,e.warnSign=h.wordbook.caution_signs[0].dictValue,e.severity=h.wordbook.problem_level_rule[0].dictValue,v.value=!0,B.value=a,a=="edit"){T.value="编辑配伍禁忌";const{data:d}=yield xe({id:r.id});Object.assign(e,d),e.generalInfoExtensions=[e.generalInfoExtensions.find(i=>i.generalId===u.id),...e.generalInfoExtensions.filter(i=>i.generalId!==u.id)],O.value=e.generalInfoExtensions,V.value=e.generalInfoExtensions}else if(a=="add"){T.value="新增配伍禁忌";const d=[{generalId:u.id,generalName:u.generalName},{generalId:"",generalName:""}];e.generalInfoExtensions.splice(0,e.generalInfoExtensions.length,...d),V.value=d}e.generalInfo=u.generalName}),le=r=>{c.pageNum=1,c.pageSize=r,P(c.keyword)},ne=r=>{c.pageNum=r,P(c.keyword)};function P(r){return k(this,null,function*(){c.keyword=r,I.value=!0;const{data:a}=yield Ne({keyword:c.keyword,pageNum:c.pageNum,pageSize:c.pageSize});O.value=a.records.map(u=>({generalId:u.id,generalName:u.generalName})),c.total=a.total,I.value=!1})}const z=()=>{g.value=!1,v.value=!1,V.value=[],Object.assign(e,{id:"",generalId:"",generalInfo:"",warnSign:"",severity:"",isSuper:"0",reference:"",tipContent:"",generalInfoExtensions:[],matchType:"1",drugClassfiy:""})},te=()=>k(this,null,function*(){if(K(e.generalInfoExtensions,"generalId")){C("选择的药物不能相同","warning","hey");return}D.value.validate(r=>k(this,null,function*(){if(r)try{const a=Object.assign({},e,{drugClassfiy:e.drugClassfiy&&e.drugClassfiy.length?e.drugClassfiy[e.drugClassfiy.length-1]:""});a.generalInfoExtensions=e.generalInfoExtensions.filter(d=>d.generalId&&d.generalId!="");const{msg:u}=yield H(a);g.value=!1,D.value.resetFields(),C(u,"success","hey"),z(),U("query")}catch(a){g.value=!1}}))}),oe=()=>{if(K(e.generalInfoExtensions,"generalId")){C("选择的药物不能相同","warning","hey");return}D.value.validate(r=>k(this,null,function*(){if(r)try{const a=Object.assign({},e,{drugClassfiy:e.drugClassfiy&&e.drugClassfiy.length?e.drugClassfiy[e.drugClassfiy.length-1]:"",checkStatus:"1"});a.generalInfoExtensions=e.generalInfoExtensions.filter(d=>d.generalId&&d.generalId!="");const{msg:u}=yield H(a);g.value=!1,D.value.resetFields(),C(u,"success","hey"),z(),U("query")}catch(a){g.value=!1}}))},J=m([]),se=()=>k(this,null,function*(){const r=yield Ce({});if(r.resultCode!=1){C("查询失败！！","error","hey");return}J.value=r.data});function K(r,a){const d=JSON.parse(JSON.stringify(r)).filter(_=>_[a]),i=[];for(let _=0;_<d.length;_++)i.push(d[_][a]);return new Set(i).size!==i.length}return L({showDiag:ae}),(r,a)=>{const u=y("el-radio"),d=y("el-radio-group"),i=y("el-form-item"),_=y("el-input"),j=y("el-option"),re=Ie,W=y("el-select"),q=y("el-col"),Y=y("el-row"),ue=y("el-cascader"),ie=y("el-form"),A=y("el-button"),de=Ve,ge=pe("loading");return s(),w("div",Ee,[o(de,{modelValue:l(v),"onUpdate:modelValue":a[8]||(a[8]=n=>he(v)?v.value=n:null),title:l(T),width:"826px",modal:!1,"append-to-body":"",onClose:z,class:"no-form-line-margin pointerEvents"},{footer:t(()=>[o(A,{onClick:z},{default:t(()=>[x("取 消")]),_:1}),o(A,{disabled:l(g),type:"primary",onClick:te},{default:t(()=>[x("确 定")]),_:1},8,["disabled"]),l(ye)("editor")?(s(),p(A,{key:0,type:"success",onClick:oe},{default:t(()=>[x("检 查")]),_:1})):R("",!0)]),default:t(()=>[_e((s(),p(ie,{ref_key:"formRef",ref:D,model:l(e),"label-width":"120px",rules:l(X)},{default:t(()=>[o(i,{label:"类型"},{default:t(()=>[o(d,{modelValue:l(e).matchType,"onUpdate:modelValue":a[0]||(a[0]=n=>l(e).matchType=n),class:"radio-bg"},{default:t(()=>[o(u,{value:"1",label:"按药品"},{default:t(()=>[x("按药品")]),_:1}),o(u,{value:"2",label:"按药理分类"},{default:t(()=>[x("按药理分类")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(e).matchType=="1"?(s(),p(Y,{key:0},{default:t(()=>[(s(!0),w(E,null,S(l(V),(n,f)=>(s(),p(q,{span:12,key:f},{default:t(()=>[f==0?(s(),p(i,{key:0,label:"通用名A"},{default:t(()=>[o(_,{modelValue:n.generalName,"onUpdate:modelValue":b=>n.generalName=b,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):(s(),p(i,{key:1,label:"通用名"+l(Z)[f],prop:f===1?"generalInfoExtensions[1].generalName":""},{default:t(()=>[o(W,{modelValue:l(e).generalInfoExtensions[f],"onUpdate:modelValue":b=>l(e).generalInfoExtensions[f]=b,filterable:"",remote:"",placeholder:"请选择通用名","remote-method":P,loading:l(I),onKeydown:a[1]||(a[1]=ve(be(()=>{},["prevent"]),["space","native"])),"popper-class":"select-pagination-popper","value-key":"generalId","reserve-keyword":"","remote-show-suffix":"",clearable:"",onClear:()=>l(e).generalInfoExtensions[f]={generalId:"",generalName:""},style:we(f===1?{width:"200px",marginRight:"8px"}:{})},{footer:t(()=>[o(re,{small:"","pager-count":5,"current-page":l(c).pageNum,"page-size":l(c).pageSize,total:l(c).total,onCurrentChange:ne,onSizeChange:le,teleported:!1},null,8,["current-page","page-size","total"])]),default:t(()=>[(s(!0),w(E,null,S(l(O),b=>(s(),p(j,{key:b.generalId,label:b.generalName,value:b},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","loading","onClear","style"]),f===1?(s(),w("div",{key:0,class:"moreDrugs",onClick:ee},"更多药物")):R("",!0)]),_:2},1032,["label","prop"]))]),_:2},1024))),128))]),_:1})):(s(),p(Y,{key:1},{default:t(()=>[o(q,{span:12},{default:t(()=>[(s(!0),w(E,null,S(l(V),(n,f)=>(s(),w("div",{key:f},[f==0?(s(),p(i,{key:0,label:"通用名A"},{default:t(()=>[o(_,{modelValue:n.generalName,"onUpdate:modelValue":b=>n.generalName=b,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):R("",!0)]))),128))]),_:1}),o(q,{span:12},{default:t(()=>[o(i,{label:"药理分类",prop:"drugClassfiy"},{default:t(()=>[o(ue,{placeholder:"请输入药理分类",options:l(J),filterable:"",modelValue:l(e).drugClassfiy,"onUpdate:modelValue":a[2]||(a[2]=n=>l(e).drugClassfiy=n),style:{width:"100%"},props:{value:"classifyCode",label:"classifyName"}},null,8,["options","modelValue"])]),_:1})]),_:1})]),_:1})),o(i,{label:"禁慎用标识"},{default:t(()=>[o(d,{modelValue:l(e).warnSign,"onUpdate:modelValue":a[3]||(a[3]=n=>l(e).warnSign=n),class:"radio-bg"},{default:t(()=>[(s(!0),w(E,null,S(l(h).wordbook.caution_signs,n=>(s(),p(u,{key:n.dictValue,value:n.dictValue},{default:t(()=>[x(G(n.dictLabel),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"问题等级"},{default:t(()=>[o(W,{modelValue:l(e).severity,"onUpdate:modelValue":a[4]||(a[4]=n=>l(e).severity=n),size:"large",placeholder:"请选择"},{default:t(()=>[(s(!0),w(E,null,S(l(h).wordbook.problem_level_rule,n=>(s(),p(j,{key:n.dictLabel,label:n.dictLabel,value:n.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"是否超说明书用药"},{default:t(()=>[o(d,{modelValue:l(e).isSuper,"onUpdate:modelValue":a[5]||(a[5]=n=>l(e).isSuper=n),class:"radio-bg"},{default:t(()=>[(s(!0),w(E,null,S(l(Q),n=>(s(),p(u,{key:n.value,value:n.value},{default:t(()=>[x(G(n.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"参考文献"},{default:t(()=>[o(_,{modelValue:l(e).reference,"onUpdate:modelValue":a[6]||(a[6]=n=>l(e).reference=n),placeholder:"请输入",type:"textarea",style:{width:"100%"},rows:3,maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(i,{label:"提示内容"},{default:t(()=>[o(_,{modelValue:l(e).tipContent,"onUpdate:modelValue":a[7]||(a[7]=n=>l(e).tipContent=n),placeholder:"请输入",type:"textarea",style:{width:"100%"},rows:4,maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[ge,l(g)]])]),_:1},8,["modelValue","title"])])}}}),Le=ke(Se,[["__scopeId","data-v-dcf93f2b"]]);export{Le as default};
