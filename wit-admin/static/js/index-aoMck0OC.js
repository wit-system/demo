var x=(g,m,y)=>new Promise((h,B)=>{var D=s=>{try{_(y.next(s))}catch(w){B(w)}},V=s=>{try{_(y.throw(s))}catch(w){B(w)}},_=s=>s.done?h(s.value):Promise.resolve(s.value).then(D,V);_((y=y.apply(g,m)).next())});import be from"./editAllergyDiag-DKbNCf7r.js";import ke from"./ruleEditing-DV3TpLnw.js";import{d as xe,r as d,aj as Se,P as Ve,b9 as N,b as Ie,a0 as Te,bs as ze,m as p,o as S,c as E,n as r,a7 as $,p as e,y as o,s as l,B as z,z as U,q as j,aY as Be,F as Fe,A as Ne,C as P,x as O,t as Z,v as ee,aa as $e,ae as W,bL as Re,H as De,af as Le,ag as Me,I as Ee,J as Ue,_ as je}from"./index-CmC8Jr0A.js";import{a as Pe,b as Oe,g as We,c as te}from"./ruleAllergy-DddaUCvF.js";import"./ruleSetItemContent-C1CWiyzb.js";import"./ruleItem-D1B3madY.js";import"./judgingConditions-DCjH_Uof.js";import"./index.vue_vue_type_style_index_0_lang-D4meg1a3.js";import"./ifComponent.vue_vue_type_style_index_0_lang-ZpisXDR_.js";import"./index-COFi4TtR.js";import"./index.vue_vue_type_script_setup_true_lang-DtyLHHVv.js";import"./dict-BvhWhz6G.js";import"./ruleCustomParameters-Dcw2hLI-.js";const R=g=>(Ee("data-v-b3f39c32"),g=g(),Ue(),g),qe={class:"flex justify-between physiologicalState"},Ae={class:"flex justify-between align-center"},He=R(()=>r("div",{class:"title"},"过敏",-1)),Je={class:"header-action-icon"},Qe={key:0},Ye={class:"flex justify-between align-center",style:{"flex-wrap":"wrap"}},Ge={class:"flex"},Ke=R(()=>r("span",null,"新增过敏规则",-1)),Xe=R(()=>r("div",{class:"top"},null,-1)),Ze={class:"center"},et=R(()=>r("div",{class:"bottom"},null,-1)),tt=xe({__name:"index",props:{ruleForm:{type:Object,default:()=>{}}},setup(g){const m=g,y=d(null),h=d("rule_allergy"),B=d(""),D=d(""),V=d(null),_=d(!1),s=Se(),{refreshCheckStatus:w}=s,v=Ve("$baseMessage"),q=d(null),u=d(!1),C=d([]),I=d([]),b=d(!0),ae=d([{width:"40",type:"checkbox"},{field:"updateName",title:"编辑人",width:"80",show:N("editor")},{field:"updateTime",title:"编辑时间",width:"165",show:N("editor")},{field:"allergyCode",title:"过敏代码",minWidth:"140"},{field:"allergyName",title:"过敏名称",minWidth:"140"},{field:"allergyType",title:"过敏类别",minWidth:"140",render:!0},{field:"warnSign",title:"过敏标识",minWidth:"140",render:!0},{field:"severity",title:"问题级别",width:"100",render:!0},{field:"active",title:"是否屏蔽",width:"75",render:!0},{field:"btns",title:"操作",align:"center",width:"190",fixed:"right",render:!0}]),c=Ie({keyword:"",pageNum:1,pageSize:10,total:0,generalId:""});Te(()=>{c.generalId=m.ruleForm.id,T()});function ne(){b.value=!b.value}function T(){return x(this,null,function*(){I.value=[];let t=yield Pe(c);if(t.resultCode!=1){C.value=[],c.total=t.data.total;return}C.value=t.data.records||[],c.total=t.data.total,C.value.length&&(C.value.forEach(n=>{n.isChk=!1}),V.value.tableMethods("setCurrentRow",C.value[0]))})}const oe=t=>{c.pageNum=1,c.pageSize=t,T()},L=ze(t=>{c.pageNum=t,T()},300);function A(t){I.value=V.value.tableMethods("getCheckboxRecords")}function M(t,n){q.value.showDiag(t,n,m.ruleForm.id)}function le(){if(!I.value.length){v("请先勾选表格","info");return}H({id:I.value.map(t=>t.id)})}function H(t){$e.confirm("是否确认删除","温馨提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>x(this,null,function*(){u.value=!0;const{msg:n}=yield Oe(t.id);u.value=!1,v(n,"success","hey"),T()})).catch(()=>{W({type:"info",message:"取消删除"})})}function se({property:t,values:n}){c[t]=n[0]||"",L(1)}function ie(){return x(this,null,function*(){u.value=!0,_.value=!0;let t=yield We({generalId:m.ruleForm.id});if(u.value=!1,_.value=!1,t.resultCode!="1"){W({type:"info",message:"刷新失败"});return}W({type:"success",message:"刷新成功"})})}function re(t){return x(this,null,function*(){u.value=!0;try{let n=yield te(t);if(u.value=!1,n.resultCode!=1){t.active=t.active==="1"?"0":"1",v("规则修改失败","info","hey");return}v("规则修改成功","success","hey")}catch(n){v("规则修改失败","info","hey"),t.active=t.active==="1"?"0":"1",u.value=!1}return!1})}function ce(){var f;const n={checkStatus:((f=s.ruleCheckStatus.get(h.value))==null?void 0:f.checkStatus)==="1"?"0":"1",dimensionCode:h.value,refId:m.ruleForm.id};Re(n).then(({msg:k})=>{w(m.ruleForm.id),v(k,"success","hey")}).catch(()=>{w(m.ruleForm.id)})}function ue(t,n){return x(this,null,function*(){u.value=!0;try{let f=Object.assign({},n,{});const k=yield te(f);u.value=!1,v(k.msg,"success","hey")}catch(f){u.value=!1}})}return(t,n)=>{const f=De,k=p("el-tooltip"),de=p("el-input"),he=p("el-checkbox"),F=p("el-button"),pe=p("el-option"),fe=p("el-select"),me=p("el-switch"),ge=Le,_e=Me,J=p("el-card"),ve=p("arrow-left-bold"),Q=p("el-icon"),ye=p("arrow-right-bold"),we=ke,Ce=be;return S(),E("div",null,[r("div",qe,[r("div",{class:$(["left-container",e(b)?"left-container-all":"left-container-half"])},[o(J,{class:"no-bottom-card"},{header:l(()=>{var a,i,Y,G,K;return[r("div",Ae,[He,r("div",Je,[e(N)("editor")&&((a=e(s).ruleCheckStatus.get(e(h)))==null?void 0:a.checkStatus)==="1"?(S(),E("span",Qe,z(((i=e(s).ruleCheckStatus.get(e(h)))==null?void 0:i.checkName)||((Y=e(s).ruleCheckStatus.get(e(h)))==null?void 0:Y.checkBy))+"/"+z((G=e(s).ruleCheckStatus.get(e(h)))==null?void 0:G.checkTime),1)):U("",!0),e(N)("editor")?(S(),j(k,{key:1,class:"box-item",effect:"dark",content:((K=e(s).ruleCheckStatus.get(e(h)))==null?void 0:K.checkStatus)==="1"?"取消检查":"检查",placement:"top"},{default:l(()=>{var X;return[o(f,{icon:"icon-jiancha",class:$(["refresh-icon",{active:((X=e(s).ruleCheckStatus.get(e(h)))==null?void 0:X.checkStatus)==="1"}]),onClick:ce,style:{padding:"4px 5px 3px"}},null,8,["class"])]}),_:1},8,["content"])):U("",!0),o(k,{class:"box-item",effect:"dark",content:"刷新缓存",placement:"top"},{default:l(()=>[o(f,{icon:"icon-gengxin",class:$({"refresh-icon":!0,"loading-animation":e(_)}),style:{padding:"4px"},onClick:ie},null,8,["class"])]),_:1})])])]}),default:l(()=>[r("div",Ye,[o(de,{modelValue:e(c).keyword,"onUpdate:modelValue":n[0]||(n[0]=a=>e(c).keyword=a),placeholder:"请输入关键字","suffix-icon":e(Be),style:{width:"300px"},clearable:"",onInput:n[1]||(n[1]=a=>e(L)(1))},null,8,["modelValue","suffix-icon"]),r("div",Ge,[e(I).length?(S(),j(he,{key:0,"model-value":!0,label:"批量删除",border:"",style:{"margin-right":"12px"},onClick:le})):U("",!0),o(F,{plain:"",type:"warning",onClick:n[2]||(n[2]=a=>M("","add"))},{default:l(()=>[o(f,{icon:"icon-xinzengdianpingjihua"}),Ke]),_:1})])]),o(ge,{ref_key:"tableRef",ref:V,"table-name":"rule-contraindication-table",loading:e(u),"table-data":e(C),columns:e(ae),isShowTableSet:!1,onCheckboxChange:A,onCheckboxAll:A,onFilterChange:se},{allergyType:l(a=>[r("span",null,z(a.row.allergyType=="1"?"药理作用":a.row.allergyType=="2"?"成份代码":""),1)]),warnSign:l(a=>[r("span",null,z(a.row.warnSign=="0"?"禁用":a.row.warnSign=="1"?"慎用":""),1)]),whetherOverstepSynopsis:l(a=>[r("div",null,z(a.row.whetherOverstepSynopsis=="1"?"是":"否"),1)]),severity:l(a=>[o(fe,{modelValue:a.row.severity,"onUpdate:modelValue":i=>a.row.severity=i,size:"large",placeholder:"请选择",onChange:i=>ue(i,a.row)},{default:l(()=>[(S(!0),E(Fe,null,Ne(e(s).wordbook.problem_level_rule,i=>(S(),j(pe,{key:i.dictLabel,label:i.dictLabel,value:i.dictValue},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),active:l(a=>[o(me,{modelValue:a.row.active,"onUpdate:modelValue":i=>a.row.active=i,loading:e(u),onChange:i=>re(a.row),"active-value":"1","inactive-value":"0"},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]),btns:l(a=>[o(F,{text:"",type:"primary",onClick:P(i=>M(a.row,"see"),["stop"])},{default:l(()=>[O("查看")]),_:2},1032,["onClick"]),o(F,{text:"",type:"primary",onClick:P(i=>M(a.row,"edit"),["stop"])},{default:l(()=>[O("编辑")]),_:2},1032,["onClick"]),o(F,{text:"",type:"primary",onClick:P(i=>H({id:[a.row.id]}),["stop"])},{default:l(()=>[O("删除")]),_:2},1032,["onClick"])]),_:1},8,["loading","table-data","columns"]),o(_e,{"current-page":e(c).pageNum,"page-size":e(c).pageSize,total:e(c).total,"prev-text":"上一页","next-text":"下一页",onCurrentChange:e(L),onSizeChange:oe},null,8,["current-page","page-size","total","onCurrentChange"])]),_:1})],2),r("div",{class:$(["right-container",e(b)?"right-container-half":"right-container-all"])},[r("div",{class:"toggle-btn",onClick:ne},[Xe,r("div",Ze,[Z(o(Q,null,{default:l(()=>[o(ve)]),_:1},512),[[ee,e(b)]]),Z(o(Q,null,{default:l(()=>[o(ye)]),_:1},512),[[ee,!e(b)]])]),et]),o(J,{class:"no-bottom-card"},{default:l(()=>[o(we,{dimensionCode:e(h),refId:e(B),id:e(D),ref_key:"ruleEditingBox",ref:y},null,8,["dimensionCode","refId","id"])]),_:1})],2)]),o(Ce,{ref_key:"editRowDiag",ref:q,onQuery:T},null,512)])}}}),gt=je(tt,[["__scopeId","data-v-b3f39c32"]]);export{gt as default};
