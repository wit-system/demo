var p=(g,v,c)=>new Promise((x,b)=>{var C=r=>{try{t(c.next(r))}catch(d){b(d)}},k=r=>{try{t(c.throw(r))}catch(d){b(d)}},t=r=>r.done?x(r.value):Promise.resolve(r.value).then(C,k);t((c=c.apply(g,v)).next())});import{_ as pe}from"./index-BOVWkMYg.js";import{d as fe,P as T,r as n,b as L,a3 as me,h as _e,l as ge,m as f,o as W,c as U,y as s,s as l,p as a,a6 as B,n as _,b3 as ve,x as m,bF as Ce,b4 as A,am as E,B as ye,C as be,z as xe,af as ke,ag as qe,I as Fe,J as we,_ as Se}from"./index-CmC8Jr0A.js";import{_ as Ne}from"./index.vue_vue_type_style_index_0_lang-D4meg1a3.js";import{g as Le,a as Be,m as Re,c as ze,d as De,b as Ve,e as $e}from"./frequency-DpBcjuVt.js";import{g as He,e as Ie}from"./downLoad-D2gYmVMy.js";import"./ifComponent.vue_vue_type_style_index_0_lang-ZpisXDR_.js";import"./index-COFi4TtR.js";import"./index.vue_vue_type_script_setup_true_lang-DtyLHHVv.js";import"./dict-BvhWhz6G.js";const Me=g=>(Fe("data-v-0d216c35"),g=g(),we(),g),Te={class:"dictionary-management-container no-background-container auto-height-container"},We={class:"padding-out flex"},Ue={class:"table-box padding-out"},Ae={class:"padding-around flex-column full-height"},Ee={class:"flex space-between padding-bottom"},Oe=Me(()=>_("div",{class:"title"},"内部频次",-1)),Pe={class:"tree-div flex-all"},je=["onClick"],Je=fe({name:"Frequency",__name:"index",setup(g){const v=T("$baseConfirm"),c=T("$baseMessage"),x=n(null),b=n(null),C=n(""),k=n(0),t=n({keyword:"",isMatch:-1,pageNum:1,pageSize:20}),r=L({children:"children",label:"freqName",value:"freqCode"}),d=L({hisFreqCodes:[],syFreqCode:""}),O=L({searchListButtons:[{label:"搜 索",isShowLoading:!0,attrs:{type:"primary"},events:{click:z}}],searchList:[{type:"select",field:"isMatch",label:"匹配状态",valueField:"value",labelField:"label",isOutBorder:!0,attrs:{width:100,placeholder:"请选择",clearable:!0},options:[{value:-1,label:"全部"},{value:1,label:"已匹配"},{value:0,label:"未匹配"}],events:{clear:z}},{type:"input",field:"keyword",label:"关键字",isOutBorder:!0,attrs:{placeholder:"请输入",clearable:!0}}],otherSearchList:[]}),R=n(null);function z(){R.value.search()}const D=n([]),V=n([]),q=n(!1),$=n(!1),y=n(!1),P=n("https://mock.apipark.cn/m1/4593503-4242983-default/system/pc-match/excel-in"),j={updateSupport:!0},J={Authorization:me()},w=n([]),G=n([{width:"40",type:"checkbox"},{width:"50",type:"seq",title:"序号"},{field:"hisFreqCode",title:"HIS频次编码",minWidth:"120"},{field:"hisFreqName",title:"HIS频次名称",minWidth:"120"},{field:"hisExecTime",title:"HIS执行时间",minWidth:"170"},{field:"syFreqCode",title:"内部频次编码",minWidth:"120"},{field:"syFreqName",title:"内部频次名称",minWidth:"140"},{field:"hosHospCode",title:"医院编码",minWidth:"140"},{field:"btns",title:"操作",align:"center",width:"120",fixed:"right",render:!0}]);_e(()=>{u(),Q()});const K=e=>{c(e.msg,"success","hey"),u()},S=e=>{d.hisFreqCodes=x.value.tableMethods("getCheckboxRecords")},Q=()=>p(this,null,function*(){$.value=!0;const e=yield Le();V.value=e.data,$.value=!1}),X=()=>{He(t.value,"/system/pc-match/template").then(e=>{const{data:o}=e;Ie(o,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","频次.xls")})},Y=()=>{t.value.pageNum=1,u()},u=()=>p(this,null,function*(){q.value=!0;const{data:e}=yield Be(t.value);D.value=e.records,k.value=e.total,q.value=!1}),Z=e=>{t.value.pageNum=1,t.value.pageSize=e,u()},F=e=>{t.value.pageNum=e,u()},ee=(e,o)=>e?o.freqName.includes(e)||o.freqCode.indexOf(e)==0:!0,te=e=>{d.syFreqCode=e.freqCode,d.hisFreqCodes.length<=0?c("请选择HIS频次","error","hey"):Re(d).then(o=>{o.success&&c("匹配成功","success","hey"),F(t.value.pageNum),u()})},H=e=>{e.hisFreqCode&&(t.value.hosHospCode=e.hosHospCode,t.value.hisFreqCode=e.hisFreqCode),v("是否确认清除匹配关系",null,()=>p(this,null,function*(){ze(t.value).then(o=>{o.success&&c("清除成功","success","hey"),F(t.value.pageNum),u()})}))},ae=e=>{e.hisFreqCode&&(t.value.hosHospCode=e.hosHospCode,t.value.hisFreqCode=e.hisFreqCode),v("是否确认删除数据",null,()=>p(this,null,function*(){De(t.value).then(o=>{o.success&&c("删除成功","success","hey"),F(t.value.pageNum),u()})}))},se=()=>{y.value=!0,v("是否确认刷新缓存",null,()=>p(this,null,function*(){Ve(t.value).then(e=>{e.success&&c("刷新缓存成功","success","hey"),y.value=!1})}))},oe=()=>{y.value=!0,v("是否确认刷新缓存",null,()=>p(this,null,function*(){$e().then(e=>{e.success&&c("刷新缓存成功","success","hey"),y.value=!1})}))};return ge(C,e=>{b.value.filter(e)}),(e,o)=>{const le=Ne,h=f("el-button"),ne=f("el-upload"),ce=ke,ie=qe,I=pe,M=f("el-col"),re=f("el-input"),de=f("el-tooltip"),ue=f("el-tree"),he=f("el-row");return W(),U("div",Te,[s(he,{gutter:8},{default:l(()=>[s(M,{lg:18},{default:l(()=>[s(I,{class:"auto-height-card flex-column"},{default:l(()=>[s(le,{ref_key:"witSearchRef",ref:R,modelValue:a(t),"onUpdate:modelValue":o[0]||(o[0]=i=>B(t)?t.value=i:null),"search-data":a(O),"search-name":"matching-tools-frequency-search",searching:a(q),onSearch:Y,isCache:!1},null,8,["modelValue","search-data","searching"]),_("div",We,[s(h,{icon:a(ve),type:"primary",onClick:X},{default:l(()=>[m("下载模板")]),_:1},8,["icon"]),s(ne,{class:"padding-horizontal","file-list":a(w),"onUpdate:fileList":o[1]||(o[1]=i=>B(w)?w.value=i:null),action:a(P),data:j,headers:J,limit:3,multiple:"","on-success":K},{default:l(()=>[s(h,{icon:a(Ce),type:"primary"},{default:l(()=>[m("导入")]),_:1},8,["icon"])]),_:1},8,["file-list","action"]),s(h,{icon:a(A),type:"danger",onClick:H},{default:l(()=>[m("清除匹配关系")]),_:1},8,["icon"]),s(h,{icon:a(A),type:"danger",onClick:ae},{default:l(()=>[m("清除医院数据")]),_:1},8,["icon"]),s(h,{icon:a(E),type:"danger",loading:a(y),onClick:se},{default:l(()=>[m("刷新医院缓存")]),_:1},8,["icon","loading"])]),_("div",Ue,[s(ce,{ref_key:"tableRef",ref:x,"table-name":"rule-frequency-table",loading:a(q),"table-data":a(D),columns:a(G),"checkbox-config":{trigger:"row"},onCheckboxChange:S,onCheckboxAll:S,onCellClick:S},{btns:l(i=>[s(h,{text:"",type:"primary",onClick:N=>H(i.row)},{default:l(()=>[m("清除")]),_:2},1032,["onClick"])]),_:1},8,["loading","table-data","columns"])]),s(ie,{"current-page":a(t).pageNum,"page-size":a(t).pageSize,total:a(k),"prev-text":"上一页","next-text":"下一页",onCurrentChange:F,onSizeChange:Z},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),s(M,{lg:6},{default:l(()=>[s(I,{class:"auto-height-card"},{default:l(()=>[_("div",Ae,[_("div",Ee,[Oe,s(h,{icon:a(E),loading:a(y),type:"danger",onClick:oe},{default:l(()=>[m("刷新内部缓存")]),_:1},8,["icon","loading"])]),s(re,{modelValue:a(C),"onUpdate:modelValue":o[2]||(o[2]=i=>B(C)?C.value=i:null),clearable:"",placeholder:"请输入频次名称或编码"},null,8,["modelValue"]),_("div",Pe,[s(ue,{ref_key:"treeRef",ref:b,data:a(V),"default-expanded-keys":["root"],"filter-node-method":ee,"highlight-current":!0,"node-key":"id",props:a(r)},{default:l(({node:i,data:N})=>[s(de,{class:"box-item",content:i.data.freqCode,effect:"light",placement:"left"},{default:l(()=>[_("span",null,ye(i.data.freqName),1)]),_:2},1032,["content"]),N.children?xe("",!0):(W(),U("a",{key:0,onClick:be(Ge=>te(N),["stop"])},"匹配",8,je))]),_:1},8,["data","props"])])])]),_:1})]),_:1})]),_:1})])}}}),lt=Se(Je,[["__scopeId","data-v-0d216c35"]]);export{lt as default};
