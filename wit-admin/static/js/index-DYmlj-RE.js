var g=(w,G,p)=>new Promise(($,d)=>{var D=c=>{try{N(p.next(c))}catch(C){d(C)}},z=c=>{try{N(p.throw(c))}catch(C){d(C)}},N=c=>c.done?$(c.value):Promise.resolve(c.value).then(D,z);N((p=p.apply(w,G)).next())});import{d as Ue,P as he,aj as qe,r as a,b as He,a4 as Je,a2 as ge,u as Ke,br as pe,h as Qe,bs as me,bt as Xe,ae as r,m as F,o as Ze,c as et,n,a7 as X,y as i,p as Z,t as ee,v as te,s as h,B as x,x as Y,bn as tt,ba as at,aa as R,bu as lt,bv as nt,bw as it,bx as st,by as ot,H as rt,af as dt,ag as ut,bz as ct,I as ft,J as vt,_ as ht}from"./index-1fQ0gozz.js";import{_ as gt}from"./index.vue_vue_type_style_index_0_lang-CmHiYd40.js";import{_ as pt}from"./index.vue_vue_type_style_index_0_lang-ps4krjgx.js";import mt from"./editDetailDiag-DHEY__n6.js";import{_ as _t}from"./editCfDetail.vue_vue_type_script_setup_true_lang-KfBkV5po.js";import bt from"./editDrugDetail-BpUx9gD6.js";import{_ as yt}from"./editYlflDetail.vue_vue_type_script_setup_true_lang-KmpKECKz.js";import"./ifComponent.vue_vue_type_style_index_0_lang-BOVwK668.js";import"./index-BueAkiiY.js";import"./index.vue_vue_type_script_setup_true_lang-BLW0x7SH.js";import"./dict-Cq6Rfk1f.js";import"./index-A-7_LJss.js";import"./style-nYtQkoWR.js";import"./fileUpload-ChTulxNu.js";import"./compositionSetting-DIJamQCi.js";import"./index-D0VWngaj.js";const W=w=>(ft("data-v-9b5e03f4"),w=w(),vt(),w),Ct={class:"drug-grade-maintenance-container"},wt={class:"top-title"},kt=W(()=>n("h4",{class:"flex-shrink"},"药理分类",-1)),xt={class:"btn-items flex-shrink"},Dt={class:"center-search"},Nt={class:"bottom-data"},It={class:"tree-data"},Tt={class:"box-container tree-container"},St={class:"top-title"},Bt=W(()=>n("h4",null,"药物",-1)),Ft={class:"btn-items"},Wt={class:"center-search"},$t={class:"bottom-data"},zt={class:"tree-data"},Et=W(()=>n("div",{class:"top"},null,-1)),Lt={class:"center"},Mt=W(()=>n("div",{class:"bottom"},null,-1)),Vt={class:"box-container flex-all flex-column"},At=W(()=>n("div",{class:"title padding-out"},"药品列表",-1)),Yt={class:"bottom-data padding-horizontal flex-all"},Rt=["onClick"],Gt=Ue({name:"DrugGradeMaintenance",__name:"index",setup(w){he("$baseConfirm");const G=qe(),p=he("$baseMessage"),$=a(0),d=a({keyword:"",isMatch:"",isGradeMatch:"",drugClassFlag:["1","2","3"]}),D=He({searchListButtons:[{label:"查询",isShowLoading:!0,attrs:{type:"primary"},events:{click:N}}],searchList:[{type:"checkbox-group",field:"drugClassFlag",label:"药品类型:",valueField:"value",labelField:"label",options:[{label:"西药",value:"1"},{label:"中成药",value:"2"},{label:"中药",value:"3"}],events:{}},{type:"select",field:"isMatch",label:"存在药品说明书",valueField:"value",labelField:"label",isOutBorder:!0,options:[{value:"",label:"全部"},{value:"1",label:"是"},{value:"0",label:"否"}],attrs:{width:70}},{type:"select",field:"isGradeMatch",label:"进行分级维护",valueField:"value",labelField:"label",isOutBorder:!0,options:[{value:"",label:"全部"},{value:"1",label:"是"},{value:"0",label:"否"}],attrs:{width:70}},{type:"input",field:"keyword",label:"关键字",isOutBorder:!0,attrs:{placeholder:"请输入",width:130,clearable:!0}}]}),z=a();function N(){z.value.search()}const c=a(null),C=a(null),P=a(null),j=a(null),O=a(null),ae=a(""),I=a(""),b=a(""),f=a(""),o=a(""),u=a(""),U=a([]),T=a(""),S=a([]),q=a([]),E=a([]),H=a([]);a(0);const L=a([]),le=a(!0),_e=a([{field:"id",title:"药品编码",minWidth:"120"},{field:"drugName",title:"药名",minWidth:"170",render:!0},{field:"productName",title:"商品名",minWidth:"120"},{field:"approvalNo",title:"批准文号",minWidth:"120"},{field:"minSpec",title:"规格",width:"120"},{field:"dosageForm",title:"剂型",width:"80",render:!0},{field:"manufacture",title:"生产厂家",minWidth:140},{field:"drugClassFlag",title:"药品类型",width:"80",render:!0},{field:"classifyName1",title:"专科大类",minWidth:"120"},{field:"classifyName2",title:"药理作用大类",minWidth:"120"},{field:"classifyName3",title:"药理作用小类",minWidth:"120"},{field:"drugsName",title:"药物",minWidth:"120"},{field:"generalName",title:"通用名",minWidth:"120"},{field:"dosage",title:"基本剂量",render:!0,minWidth:"120"},{field:"btns",title:"操作",align:"center",width:"250",fixed:"right",render:!0}]),M=a(!1);a(!1),a(!0),a(!1);const v=a(!1),B=a(!1);Je(),ge(()=>({animation:600,group:"description"}));const ne=[{label:"药品编码",prop:"id",checked:!0,minWidth:180},{label:"名称",prop:"drugName",checked:!0,minWidth:120},{label:"商品名",prop:"productName",checked:!0,minWidth:120},{label:"批准文号",prop:"approvalNo",checked:!0,minWidth:160},{label:"规格",prop:"minSpec",checked:!0,minWidth:250},{label:"剂型",prop:"dosageForm",checked:!0,minWidth:160,dict:"drug_dosage_flag"},{label:"生产厂家",prop:"manufacture",checked:!0,minWidth:100},{label:"药品类型",prop:"drugClassFlag",checked:!0,minWidth:160,dict:"drug_class_flag"},{label:"专科大类",prop:"classifyName1",checked:!0,minWidth:160},{label:"药理作用大类",prop:"classifyName2",checked:!0,minWidth:110},{label:"药理作用小类",prop:"classifyName3",checked:!0,minWidth:160},{label:"药物",prop:"drugsName",checked:!0},{label:"通用名",prop:"generalName",checked:!0,minWidth:160},{label:"基本剂量",prop:"dosage",checked:!0,minWidth:110}],ie=Ke(),be=pe(ie.path,ne),se=[];ne.forEach(e=>{se.push(e.label)});const ye=pe(`${ie.path}_check`,se);Qe(()=>{J()}),ge(()=>be.value.filter(e=>ye.value.includes(e.label)));const Ce={children:"children",label:"classifyName"},we={children:"children",label:"label"},oe=(e,t)=>{if(t=="edit"){if(!b.value){r.info("请选择药理分类");return}c.value.showEdit(b.value,t),q.value=[b.value]}else c.value.showEdit(b.value,t),q.value=[b.value]},ke=me(e=>{j.value.methods("filter",e)},100),xe=(e,t)=>e?t.classifyName.includes(e):!0,De=me(e=>{O.value.methods("filter",e)},100),Ne=(e,t,s)=>{if(e){if(e&&!t)return!1}else return!0;return Ie(e,t,s)},Ie=(e,t,s)=>{if(t.label.indexOf(e)!==-1)return!0;const y=s.level;if(y===1)return!1;let _=s.parent,k=0;for(;k<y-1;){if(_.data.label.indexOf(e)!==-1)return!0;_=_.parent,k++}return!1},J=e=>g(this,null,function*(){const t=yield Xe({});if(t.resultCode!=1){r.error("查询失败！！");return}S.value=t.data}),Te=()=>{re(),K(I.value,f.value)},K=(e,t)=>g(this,null,function*(){const s=yield tt({keyword:"",classifyCode:t});if(s.resultCode!=1){r.error("查询失败！！");return}E.value=s.data,B.value=!1}),Se=e=>{d.value.pageNum=e,m(o.value)},Be=e=>{d.value.pageSize=e,m(o.value)},Fe=()=>{v.value=!1,B.value=!0,f.value="",o.value="",u.value="",T.value="",j.value.clear(),m("")},re=()=>{B.value=!0,O.value.clear(),u.value="",o.value="",T.value="",m("")},We=()=>{v.value=!v.value,v.value},$e=e=>g(this,null,function*(){I.value="",B.value=!0,b.value=e.id,f.value=e.classifyCode,o.value="",u.value="",T.value="",L.value=[],le.value=!(e.children&&e.children.length>0),K("",f.value),v.value=!0,m("")}),ze=a(!0),Ee=e=>g(this,null,function*(){o.value=e.id,u.value=e.labelType,U.value=e.children||[],T.value=e.otherCode,m(e.id),e.labelType==3?D.searchListButtons[1]={label:"新增药品",icon:"icon-xinzengdianpingjihua",isShowLoading:!0,attrs:{type:"warning",plain:!0},events:{click:()=>Q("","add")}}:D.searchListButtons.splice(1,1),ze.value=e.labelType!=3}),m=e=>g(this,null,function*(){M.value=!0;let t={drugsId:"",dosageId:"",generalId:"",classifyCode:f.value=="0"?"":f.value,keyword:d.value.keyword,drugClassFlag:d.value.drugClassFlag,isMatch:d.value.isMatch,isGradeMatch:d.value.isGradeMatch,pageSize:d.value.pageSize,pageNum:d.value.pageNum};u.value==1?t.drugsId=e:u.value==2?t.generalId=e:u.value==3&&(t.dosageId=e);const s=yield at(t);if(s.resultCode!=1){r.error("查询失败！！");return}$.value=s.data.total,L.value=s.data.records,M.value=!1}),Le=()=>{if(!b.value){p("请选择药理分类","warning","hey");return}if(!le.value||E.value&&E.value.length>0)return p("该分类下存在子节点数据，请全部删除后再进行操作！","warning","hey");R.confirm("确认删除将解除该药理分类与上一层级的关联关系","是否确认删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>g(this,null,function*(){if((yield lt({id:b.value})).resultCode!=1){r.error("删除失败！！");return}r.info("删除成功！！"),J()})).catch(()=>{r({type:"info",message:"取消删除"})})},Me=()=>{if(!o.value){p("请选择药理分类","warning","hey");return}if(U.value.length>0&&U.value[0]||L.value.length>0)return p("该分类下存在子节点数据，请全部删除后再进行操作！","warning","hey");R.confirm("确认删除将解除该药品与上一层级的关联关系","是否确认删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>g(this,null,function*(){let e="";if(u.value==1&&(e=yield nt({id:o.value})),u.value==2&&(e=yield it({id:o.value})),u.value==3&&(e=yield st({id:o.value})),e.resultCode!=1){r.error("删除失败！！");return}r.success("删除成功！！"),K(I.value,f.value)})).catch(()=>{r({type:"info",message:"取消删除"})})},de=(e,t)=>{if(!f.value){r.info("请先选中药理分类");return}if(t=="edit"){if(!o.value){r.info("请选中药物");return}C.value.showEdit(o.value,t,f.value,u.value),H.value=[o.value]}else C.value.showEdit(o.value,t,f.value,u.value),H.value=[o.value]},Q=(e,t)=>{if(t=="edit"||t=="copy")P.value.showEdit(e,t);else{if(!f.value){R.confirm("左侧树目录未选择，请选择后再新增药品！","温馨提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>g(this,null,function*(){r({type:"info",message:"关闭"})})).catch(()=>{r({type:"info",message:"关闭"})});return}P.value.showEdit({classifyCode:T.value,ypflIds:o.value},t)}},Ve=e=>{R.confirm("确认删除将解除该药品与上一层级的关联关系","是否确认删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>g(this,null,function*(){if((yield ot({id:e.id})).resultCode!=1){r.error("删除失败！！");return}r.info("删除成功！！"),m(o.value)})).catch(()=>{r({type:"info",message:"取消删除"})})},ue=(e,t,s)=>{let y="",_=G.wordbook[s].filter(k=>k.dictValue==e[t]);return y=_[0]?_[0].dictLabel:"",y},ce=a(null),Ae=e=>{ce.value.showInst(e.id)},fe=a();function Ye(e){const t=e.drugClassFlag==1?"xy":e.drugClassFlag==2?"zcy":"zy";fe.value.showEdit(t,e,"edit")}return(e,t)=>{const s=rt,y=F("el-input"),_=pt,k=F("arrow-left-bold"),ve=F("el-icon"),Re=F("arrow-right-bold"),Ge=gt,V=F("el-button"),Pe=dt,je=ut,Oe=ct;return Ze(),et("div",Ct,[n("div",{class:X(["left-container",v.value?"left-container-all":"left-container-half"])},[n("div",{class:X(["box-container tree-container",v.value?"half-class":"all-class"])},[n("div",wt,[kt,n("div",xt,[i(s,{icon:"bianjibianping","is-custom-svg":"",style:{width:"22px",height:"22px"},onClick:t[0]||(t[0]=l=>oe("","edit"))}),i(s,{icon:"shanchubianping","is-custom-svg":"",style:{width:"22px",height:"22px"},onClick:Le}),i(s,{icon:"xinzengbianping","is-custom-svg":"",style:{width:"22px",height:"22px"},onClick:t[1]||(t[1]=l=>oe("","add"))})])]),n("div",Dt,[i(y,{modelValue:ae.value,"onUpdate:modelValue":t[2]||(t[2]=l=>ae.value=l),clearable:"",placeholder:"药理分类关键字查询","prefix-icon":"Search",onInput:Z(ke)},null,8,["modelValue","onInput"])]),n("div",Nt,[n("div",{class:"button-all",onClick:Fe},"全部"),n("div",It,[i(_,{ref_key:"ylflTreeRef",ref:j,data:S.value,"show-icon":!0,"filter-node-method":xe,"expand-on-click-node":!1,defaultProps:Ce,"node-key":"id","default-expanded-keys":q.value,onNodeClick:$e},null,8,["data","default-expanded-keys"])])])],2),ee(n("div",Tt,[n("div",St,[Bt,n("div",Ft,[i(s,{icon:"bianjibianping","is-custom-svg":"",style:{width:"22px",height:"22px"},onClick:t[3]||(t[3]=l=>de("","edit"))}),i(s,{icon:"shanchubianping","is-custom-svg":"",style:{width:"22px",height:"22px"},onClick:Me}),i(s,{icon:"xinzengbianping","is-custom-svg":"",style:{width:"22px",height:"22px"},onClick:t[4]||(t[4]=l=>de("","add"))})])]),n("div",Wt,[i(y,{modelValue:I.value,"onUpdate:modelValue":t[5]||(t[5]=l=>I.value=l),clearable:"",placeholder:"药物关键字查询","prefix-icon":"Search",onInput:Z(De)},null,8,["modelValue","onInput"])]),n("div",$t,[n("div",{class:"button-all",onClick:re},"全部"),n("div",zt,[i(_,{ref_key:"cfTreeRef",ref:O,loading:B.value,data:E.value,defaultProps:we,"node-key":"id","default-expanded-keys":H.value,onNodeClick:Ee,"filter-node-method":Ne,"expand-on-click-node":!1},null,8,["loading","data","default-expanded-keys"])])])],512),[[te,v.value]])],2),n("div",{class:X(["right-container auto-height-container",v.value?"right-container-half":"right-container-all"])},[n("div",{class:"toggle-left-btn",onClick:We},[Et,n("div",Lt,[ee(i(ve,null,{default:h(()=>[i(k)]),_:1},512),[[te,v.value]]),ee(i(ve,null,{default:h(()=>[i(Re)]),_:1},512),[[te,!v.value]])]),Mt]),n("div",Vt,[At,i(Ge,{ref_key:"refSearch",ref:z,modelValue:d.value,"onUpdate:modelValue":t[6]||(t[6]=l=>d.value=l),"is-cache":!1,"search-data":Z(D),"search-name":"matching-tools-drug-grade-search",searching:M.value,border:!1,onSearch:t[7]||(t[7]=l=>m(o.value))},null,8,["modelValue","search-data","searching"]),n("div",Yt,[i(Pe,{ref:"tableRef","table-name":"matching-tools-drug-grade-table",loading:M.value,"table-data":L.value,columns:_e.value},{drugName:h(l=>[n("span",{class:"drug-name",onClick:A=>Ae(l.row)},x(l.row.drugName),9,Rt)]),dosageForm:h(l=>[n("span",null,x(ue(l.row,"dosageForm","drug_dosage_flag")),1)]),drugClassFlag:h(l=>[n("span",null,x(ue(l.row,"drugClassFlag","drug_class_flag")),1)]),dosage:h(l=>[n("span",null,x(l.row.dosage)+" "+x(l.row.dosageUom),1)]),btns:h(l=>[i(V,{text:"",type:"primary",onClick:A=>Q(l.row,"copy")},{default:h(()=>[Y("复制")]),_:2},1032,["onClick"]),i(V,{text:"",type:"primary",onClick:A=>Ye(l.row)},{default:h(()=>[Y(x(l.row.instructionId?"编辑说明书":"新增说明书"),1)]),_:2},1032,["onClick"]),i(V,{text:"",type:"primary",onClick:A=>Q(l.row,"edit")},{default:h(()=>[Y("编辑")]),_:2},1032,["onClick"]),i(V,{text:"",type:"primary",disabled:l.row.status==0,onClick:A=>Ve(l.row)},{default:h(()=>[Y("删除")]),_:2},1032,["disabled","onClick"])]),_:1},8,["loading","table-data","columns"])]),i(je,{"current-page":d.value.pageNum,"page-size":d.value.pageSize,total:$.value,onCurrentChange:Se,onSizeChange:Be},null,8,["current-page","page-size","total"])])],2),i(yt,{ref_key:"editYlflDetailDiag",ref:c,"ylfl-tree-data":S.value,onCloseDiag:t[8]||(t[8]=l=>J())},null,8,["ylfl-tree-data"]),i(_t,{ref_key:"editCfDetailDiag",ref:C,"ylfl-tree-data":S.value,onCloseDiag:Te},null,8,["ylfl-tree-data"]),i(bt,{ref_key:"editDrugDetailDiag",ref:P,"ylfl-tree-data":S.value,onCloseDiag:t[9]||(t[9]=l=>m(o.value))},null,8,["ylfl-tree-data"]),i(Oe,{ref_key:"drugInst",ref:ce},null,512),i(mt,{ref_key:"instRef",ref:fe},null,512)])}}}),sa=ht(Gt,[["__scopeId","data-v-9b5e03f4"]]);export{sa as default};
