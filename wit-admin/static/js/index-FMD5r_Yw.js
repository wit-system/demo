var k=(f,C,m)=>new Promise((_,T)=>{var a=r=>{try{w(m.next(r))}catch(b){T(b)}},E=r=>{try{w(m.throw(r))}catch(b){T(b)}},w=r=>r.done?_(r.value):Promise.resolve(r.value).then(a,E);w((m=m.apply(f,C)).next())});import{d as te,r as d,P as z,b as F,a3 as ae,h as W,bt as le,m as g,o,c as y,n as v,y as u,p as l,a6 as oe,s as i,x as c,B as p,q as h,F as V,H as ie,af as ne,ag as se,I as re,J as de,_ as ue}from"./index-BNylXLUF.js";import{_ as me}from"./index.vue_vue_type_style_index_0_lang-CQ0LplO3.js";import{e as ce,f as pe,i as he}from"./drugQuotaManagement-BuPftiIs.js";import{C as fe}from"./constants-C9BIlYt-.js";import{g as _e}from"./dict-C-0c6999.js";import{g as ge,e as ye}from"./downLoad-tlct7w9F.js";import"./ifComponent.vue_vue_type_style_index_0_lang-CZbArpmd.js";import"./index-7iMDeE21.js";import"./index.vue_vue_type_script_setup_true_lang-DuUJu87k.js";const q=f=>(re("data-v-ef7ec75c"),f=f(),de(),f),ve={class:"setTotalAmount-container auto-height-container"},Te={class:"top-tools"},we={class:"import-or-export"},be=q(()=>v("span",{class:"port-text"},"模板导出",-1)),xe=q(()=>v("span",{class:"port-text"},"导 入",-1)),ke={class:"app-content padding-out"},Se={key:1},Ve={class:"app-pagination"},Ce=te({name:"RoleManagement",__name:"index",setup(f){const C=d([{label:"西药",value:"1"},{label:"中成药",value:"2"},{label:"中药饮片",value:"3"}]);z("baseConfirm");const m=z("$baseMessage"),_=d(!1),T=d(),a=d({keyword:"",drugProperties:[],fldm:[],hosZxFlag:[],total:0,pageNum:1,pageSize:20}),E=()=>{ge(a.value,"/sunya-patient/drugTotalAmount/exportTemplate").then(t=>{const{data:s}=t;ye(s,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","药品配额设置总量模板.xls")})},w=d("https://mock.apifox.com/m1/4593503-4242983-default/sunya-patient/drugTotalAmount/importTemplate"),r=F({}),b={Authorization:ae()},$=d(!1);function I(t,s,A){m(t.msg,"success","hey"),x()}const U=F({searchListButtons:[{label:"搜 索",isShowLoading:!0,attrs:{type:"primary"},events:{click:G}}],searchList:[{type:"input",field:"keyword",isOutBorder:!1,label:"",attrs:{placeholder:"请输入药品名称搜索...",width:220}},{type:"select",field:"drugProperties",valueField:"column",labelField:"columnName",isOutBorder:!1,options:[],attrs:{placeholder:"请选择药品属性",width:200,multiple:!0,collapseTags:!0,valueKey:"column"},events:{}},{type:"cascader",field:"fldm",isOutBorder:!1,attrs:{placeholder:"药理分类",clearable:!0,props:{value:"classifyCode",label:"classifyName",checkStrictly:!0},options:[]}},{type:"select",field:"hosZxFlag",valueField:"value",labelField:"label",isOutBorder:!1,options:C.value,attrs:{placeholder:"请选择药品类型",width:200,multiple:!0,collapseTags:!0},events:{}}],rightSearchListButtons:[]}),B=d([]),L=d(0),P=d([{field:"hosDrugCode",title:"药品编码",minWidth:"110"},{field:"hosDrugName",title:"药品名(商品名)",minWidth:"150"},{field:"hosGeneralName",title:"药品名(通用名)",minWidth:"200"},{field:"hosSpec",title:"规格",minWidth:"150"},{field:"hosForName",title:"剂型",minWidth:"100"},{field:"hosManuf",title:"厂家",minWidth:"200"},{field:"hosZxFlagName",title:"类型",minWidth:"100"},{field:"totalAmount",title:"总配额量",minWidth:"85",render:!0},{field:"opTotal",title:"门诊配额量",minWidth:"95",render:!0},{field:"ipTotal",title:"住院配额量",minWidth:"95",render:!0},{field:"quotaUnit",title:"单位",minWidth:"80",render:!0},{field:"validityTime",title:"有效期",minWidth:"240",render:!0},{field:"btns",title:"操作",align:"center",width:"80",fixed:"right",render:!0}]);W(()=>{M(),O()});function M(){return k(this,null,function*(){const{data:t}=yield le({});U.searchList[2].attrs.options=t||[]})}function O(){return k(this,null,function*(){const{data:t}=yield ce();U.searchList[1].options=t||[]})}function Y(t={}){t.hosDrugCode&&(t.validityTime=[],t.validityTime[0]=t.validityStartTime?t.validityStartTime:"",t.validityTime[1]=t.validityEndTime?t.validityEndTime:"",t.isEdit=!0)}const R=t=>k(this,null,function*(){let s={validityStartTime:t.validityTime[0]?t.validityTime[0]:"",validityEndTime:t.validityTime[1]?t.validityTime[1]:""};(yield pe(Object.assign(t,s))).resultCode=="1"&&(m("更新成功","success","hey"),t.isEdit=!1)}),j=t=>{a.value.pageNum=1,a.value.pageSize=t,x()},Z=t=>{a.value.pageNum=t,x()};function G(){T.value.search()}function x(){return k(this,null,function*(){_.value=!0;let t={fldm:a.value.fldm.length===0?"":a.value.fldm[a.value.fldm.length-1]};const{data:s}=yield he(Object.assign(a.value,t));B.value=s.records,L.value=s.total,_.value=!1})}return W(()=>{x()}),(t,s)=>{const A=me,N=ie,S=g("el-button"),H=g("el-upload"),J=g("el-tag"),D=g("el-input-number"),K=g("el-input"),Q=g("el-date-picker"),X=ne,ee=se;return o(),y("div",ve,[v("div",Te,[u(A,{ref_key:"refSearch",ref:T,modelValue:l(a),"onUpdate:modelValue":s[0]||(s[0]=e=>oe(a)?a.value=e:null),"search-data":l(U),"search-name":"setTotalAmount",searching:l(_),onSearch:x,isCache:!1},null,8,["modelValue","search-data","searching"]),v("div",we,[u(S,{class:"clcik-button1",type:"primary",onClick:E},{default:i(()=>[u(N,{icon:"icon-excel"}),be]),_:1}),u(H,{action:l(w),class:"upload-button",data:l(r),headers:b,multiple:!1,"show-file-list":!1,"on-success":I},{default:i(()=>[u(S,{type:"primary",loading:l($)},{default:i(()=>[u(N,{icon:"icon-daoru1"}),xe]),_:1},8,["loading"])]),_:1},8,["action","data"])])]),v("div",ke,[u(X,{"table-name":"setTotalAmount",loading:l(_),tableData:l(B),columns:l(P)},{status:i(e=>[u(J,{type:e.row.status===l(fe).ENABLE?"success":"danger"},{default:i(()=>[c(p(l(_e)("sys_normal_disable",e.row.status)),1)]),_:2},1032,["type"])]),totalAmount:i(e=>[e.row.isEdit?(o(),h(D,{key:0,modelValue:e.row.totalAmount,"onUpdate:modelValue":n=>e.row.totalAmount=n,style:{width:"70px"},size:"small",min:0,max:9999,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])):(o(),y(V,{key:1},[c(p(e.row.totalAmount),1)],64))]),opTotal:i(e=>[e.row.isEdit?(o(),h(D,{key:0,modelValue:e.row.opTotal,"onUpdate:modelValue":n=>e.row.opTotal=n,style:{width:"70px"},size:"small",min:0,max:9999,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])):(o(),y(V,{key:1},[c(p(e.row.opTotal),1)],64))]),ipTotal:i(e=>[e.row.isEdit?(o(),h(D,{key:0,modelValue:e.row.ipTotal,"onUpdate:modelValue":n=>e.row.ipTotal=n,style:{width:"70px"},size:"small",min:0,max:9999,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])):(o(),y(V,{key:1},[c(p(e.row.ipTotal),1)],64))]),quotaUnit:i(e=>[e.row.isEdit?(o(),h(K,{key:0,modelValue:e.row.quotaUnit,"onUpdate:modelValue":n=>e.row.quotaUnit=n,size:"small",clearable:""},null,8,["modelValue","onUpdate:modelValue"])):(o(),y(V,{key:1},[c(p(e.row.quotaUnit),1)],64))]),validityTime:i(e=>[e.row.isEdit?(o(),h(Q,{key:0,modelValue:e.row.validityTime,"onUpdate:modelValue":n=>e.row.validityTime=n,"end-placeholder":"结束日期","range-separator":"至","start-placeholder":"开始日期",type:"daterange","value-format":"YYYY-MM-DD",style:{width:"235px"}},null,8,["modelValue","onUpdate:modelValue"])):(o(),y("span",Se,p(e.row.validityStartTime)+" 至 "+p(e.row.validityEndTime),1))]),btns:i(e=>[e.row.isEdit?(o(),h(S,{key:0,text:"",type:"primary",onClick:n=>R(e.row)},{default:i(()=>[c("保存")]),_:2},1032,["onClick"])):(o(),h(S,{key:1,text:"",type:"primary",onClick:n=>Y(e.row)},{default:i(()=>[c("编辑")]),_:2},1032,["onClick"]))]),_:1},8,["loading","tableData","columns"])]),v("div",Ve,[u(ee,{"current-page":l(a).pageNum,"page-size":l(a).pageSize,total:l(L),onCurrentChange:Z,onSizeChange:j},null,8,["current-page","page-size","total"])])])}}}),qe=ue(Ce,[["__scopeId","data-v-ef7ec75c"]]);export{qe as default};
