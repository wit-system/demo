var C=(w,x,_)=>new Promise((g,f)=>{var b=d=>{try{h(_.next(d))}catch(N){f(N)}},V=d=>{try{h(_.throw(d))}catch(N){f(N)}},h=d=>d.done?g(d.value):Promise.resolve(d.value).then(b,V);h((_=_.apply(w,x)).next())});import Y from"./engineSettingClinicalRulesEdit-BImtshYO.js";import{d as Z,r as u,P as F,b as j,h as ee,m as y,o as R,c as $,y as o,s as p,n as c,a7 as ne,p as v,a6 as se,F as T,x as k,B as M,z as O,H as te,af as ae,I as ie,J as oe,_ as le}from"./index-CmC8Jr0A.js";import{_ as re}from"./index.vue_vue_type_style_index_0_lang-D4meg1a3.js";import{e as ce,a as de,r as ue,b as q}from"./engineSettingClinicalRules-CuJwFDrm.js";import"./index-CvK03aMb.js";import"./ifComponent.vue_vue_type_style_index_0_lang-ZpisXDR_.js";import"./index-COFi4TtR.js";import"./index.vue_vue_type_script_setup_true_lang-DtyLHHVv.js";import"./dict-BvhWhz6G.js";const L=w=>(ie("data-v-4f2d28ad"),w=w(),oe(),w),me={class:"auto-height-container engine-setting-clinical-rules"},pe={class:"flex space-between"},he=L(()=>c("span",{class:"title"},"临床规则",-1)),_e={class:"refresh"},ge={class:"app-content padding-out"},fe=L(()=>c("span",null,"添加",-1)),ve={class:"input-number-days"},we={class:"headerTips"},Ne=L(()=>c("div",null,"参数说明",-1)),Ce={style:{color:"#354160"}},ye=L(()=>c("span",{style:{"margin-right":"12px"}},"提示：可在以下表格中编辑参数说明",-1)),Se={class:"headerEdit"},xe=Z({name:"EngineSettingClinicalRules",__name:"engineSettingClinicalRules",setup(w){const x=u([]),_=u();F("$baseConfirm");const g=F("$baseMessage"),f=u(!1),b=u(),V=u(null),h=u({parentCode:[]}),d=j({searchListButtons:[{label:"搜 索",isShowLoading:!0,attrs:{type:"primary"},events:{click:H}}],searchList:[{type:"select",field:"parentCode",label:"一级规则筛选",valueField:"dimensionsCode",labelField:"dimensionsName",isOutBorder:!1,isRequired:!1,options:[],attrs:{width:200,clearable:!0,multiple:!0,collapseTags:!0,placeholder:"请选择（可多选）"},events:{}}]}),N=u([]),z=u([{field:"dimensionsName",title:"维度名称",width:"100"},{field:"dimensionsName1",title:"规则开关",minWidth:"160"},{field:"status1",title:"",width:"120",render:!0},{field:"dimensionsName2",title:"条件开关",minWidth:"160"},{field:"status2",title:"",width:"120",render:!0},{field:"parameterDescription",title:"参数说明",minWidth:"300",render:!0,isRenderHeader:!0,className:"parameter-description"}]);u(null);function H(){b.value.search()}function D(){return C(this,null,function*(){f.value=!0;let e={parentCode:h.value.parentCode};const{data:l}=yield ce(e);let a=[];l.forEach((n,r)=>{n.children&&n.children.length?(n.children||[]).forEach((i,U)=>{i.children&&i.children.length?(i.children||[]).forEach((S,B)=>{a.push(Object.assign({},n,i,S,{dimensionsName:n.dimensionsName,dimensionsName1:i.dimensionsName||"",status1:i.status||"",dimensionsName2:S.dimensionsName||"",status2:S.status||""}))}):a.push(Object.assign({},n,i,{dimensionsName:n.dimensionsName,dimensionsName1:i.dimensionsName||"",status1:i.status||"",dimensionsName2:"",status2:""}))}):a.push(Object.assign({},n,{dimensionsName1:"",status1:"",dimensionsName2:"",status2:""}))});let s={};a.forEach((n,r)=>{s[n.dimensionsName]?s[n.dimensionsName].num++:(s[n.dimensionsName]={},s[n.dimensionsName].num=1,s[n.dimensionsName].index=r),n.dimensionsName1&&s[n.dimensionsName1]?s[n.dimensionsName1].num1++:(s[n.dimensionsName1]={},s[n.dimensionsName1].num1=1,s[n.dimensionsName1].index1=r)}),Object.keys(s).forEach(n=>{a.forEach((r,i)=>{r.dimensionsName==n&&i==s[n].index&&(r.numLength=s[n].num),r.dimensionsName1==n&&i==s[n].index1&&(r.numLength1=s[n].num1)})}),N.value=a,f.value=!1})}function W(){return C(this,null,function*(){let e=yield de({});x.value=e.data||[],d.searchList[0].options=x.value})}const E=u(!1);function J(){return C(this,null,function*(){E.value=!0;const{msg:e}=yield ue();E.value=!1,g(e,"success","hey")})}function I(e,l){return C(this,null,function*(){let a={status:e["status"+l],dimensionsCode:l=="1"&&e.status2&&e.status2.length?e.parentCode:e.dimensionsCode,parameterDescription:e.parameterDescription,conditionSetting:e.conditionSetting},s=yield q(a);if(s.resultCode!=1){e["status"+l]=e["status"+l]==="0"?"1":"0",g(s.msg,"success","hey");return}g(s.msg,"success","hey")})}function P({row:e,column:l,rowIndex:a,columnIndex:s}){if(s==0)return e.numLength?{rowspan:e.numLength,colspan:1}:{rowspan:0,colspan:0};if(s==1||s==2)return e.numLength1?{rowspan:e.numLength1,colspan:1}:{rowspan:0,colspan:0}}function Q({columnIndex:e}){return e===0?"col-grey":null}function A(e){_.value.showEdit(e)}function G(e){clearTimeout(V.value),V.value=setTimeout(()=>C(this,null,function*(){let l={status:e.status1,dimensionsCode:e.dimensionsCode,parameterDescription:e.parameterDescription,conditionSetting:e.conditionSetting},a=yield q(l);if(a.resultCode!=1){D(),g(a.msg,"success","hey");return}g(a.msg,"success","hey")}),600)}return ee(()=>{W(),D()}),(e,l)=>{const a=te,s=y("el-tooltip"),n=re,r=y("el-switch"),i=y("el-button"),U=y("el-input-number"),S=y("el-input"),B=ae,K=y("el-card"),X=Y;return R(),$("div",me,[o(K,{shadow:"never"},{header:p(()=>[c("div",pe,[he,c("div",_e,[o(s,{class:"box-item",effect:"dark",content:"刷新缓存",placement:"top"},{default:p(()=>[o(a,{icon:"icon-gengxin",class:ne({"refresh-icon":!0,"loading-animation":v(E)}),onClick:J,style:{padding:"4px"}},null,8,["class"])]),_:1})])])]),default:p(()=>[o(n,{ref_key:"refSearch",ref:b,modelValue:v(h),"onUpdate:modelValue":l[0]||(l[0]=t=>se(h)?h.value=t:null),"search-data":v(d),"search-name":"system-roleManagement",searching:v(f),onSearch:D,isCache:!1},null,8,["modelValue","search-data","searching"]),c("div",ge,[o(B,{"table-name":"system-engineSettingClinicalRules",loading:v(f),tableData:v(N),columns:v(z),class:"drug-table","span-method":P,"cell-class-name":Q,border:""},{status1:p(t=>[t.row.dimensionsName1?(R(),$(T,{key:0},[o(r,{modelValue:t.row.status1,"onUpdate:modelValue":m=>t.row.status1=m,class:"ml-2","active-value":"1","inactive-value":"0",onClick:m=>I(t.row,"1")},null,8,["modelValue","onUpdate:modelValue","onClick"]),k(" "+M(t.row.status1=="0"?"关闭":t.row.status1=="1"?"开启":""),1)],64)):O("",!0)]),status2:p(t=>[t.row.dimensionsName2?(R(),$(T,{key:0},[o(r,{modelValue:t.row.status2,"onUpdate:modelValue":m=>t.row.status2=m,class:"ml-2","active-value":"1","inactive-value":"0",onClick:m=>I(t.row,"2")},null,8,["modelValue","onUpdate:modelValue","onClick"]),k(" "+M(t.row.status2=="0"?"关闭":t.row.status2=="1"?"开启":""),1)],64)):O("",!0)]),conditionSetting:p(t=>[o(i,{text:"",type:"primary",onClick:m=>A(t.row)},{default:p(()=>[o(a,{icon:"icon-xinzengdianpingjihua"}),fe]),_:2},1032,["onClick"]),c("div",ve,[o(U,{style:{width:"60px"},min:0,"controls-position":"right"}),k(" 天以内 ")])]),parameterDescription:p(t=>[o(S,{class:"tipsInput",modelValue:t.row.parameterDescription,"onUpdate:modelValue":m=>t.row.parameterDescription=m,onInput:m=>G(t.row),debounce:500},null,8,["modelValue","onUpdate:modelValue","onInput"])]),parameterDescriptionHeader:p(()=>[c("div",we,[Ne,c("div",Ce,[o(a,{icon:"icon-xintishi",style:{"margin-right":"8px",color:"#fc9f15"}}),ye,c("span",Se,[o(a,{icon:"icon-xiugai"})])])])]),_:1},8,["loading","tableData","columns"])])]),_:1}),o(X,{ref_key:"engineSettingClinicalRulesEditDiag",ref:_,onQuery:D},null,512)])}}}),Be=le(xe,[["__scopeId","data-v-4f2d28ad"]]);export{Be as default};
