var W=Object.defineProperty,G=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var N=(l,n,s)=>n in l?W(l,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[n]=s,b=(l,n)=>{for(var s in n||(n={}))K.call(n,s)&&N(l,s,n[s]);if(k)for(var s of k(n))Q.call(n,s)&&N(l,s,n[s]);return l},V=(l,n)=>G(l,J(n));import{d as X,P as D,r as h,b as Y,m as y,o as ee,c as te,y as a,p as u,a6 as oe,n as v,s as d,B as S,x as w,H as ne,af as se,ag as ae,bz as le,_ as ie}from"./index-9sA7DK8G.js";import{_ as re}from"./index.vue_vue_type_style_index_0_lang-BRnHlKRC.js";import{u as ue,a as de,b as ce}from"./unitConvert-CZ5Q2b9e.js";import"./ifComponent.vue_vue_type_style_index_0_lang-Bop7xqfB.js";import"./index-B9NkytPw.js";import"./index.vue_vue_type_script_setup_true_lang-_NT1uA2K.js";import"./dict-urOAkSAA.js";const he={class:"matching-tools-unit-convert auto-height-container"},me={class:"flex-all padding-horizontal"},fe=["onClick"],pe={class:"flex up-center"},ge=X({name:"Matching-Tools-Unit-Convert",__name:"index",setup(l){const n=D("$baseMessage"),s=D("$baseConfirm"),i=h({isNotConversion:"",isNotUnitMatching:"",hosZxFlags:["1","2","3"],drugCode:""}),$=Y({searchListButtons:[{label:"查询",isShowLoading:!0,attrs:{type:"primary"},events:{click:m}}],searchList:[{type:"checkbox",field:"isNotConversion",placeholder:"无转换系数",trueValue:1},{type:"checkbox",field:"isNotUnitMatching",placeholder:"单位不一致",trueValue:1},{type:"checkbox-group",field:"hosZxFlags",label:"",valueField:"value",labelField:"label",options:[{label:"西药",value:"1"},{label:"中成药",value:"2"},{label:"中药",value:"3"}],events:{}},{type:"input",field:"drugCode",label:"关键字",isOutBorder:!0,attrs:{placeholder:"药品名称/药品编码",width:150,clearable:!0}}]}),x=h();function m(){x.value.search()}const C=h(0),f=h(!1),p=h([]),F=h([{field:"drugCode",title:"药品编码",width:"120"},{field:"drugName",title:"药品名称",minWidth:"120",render:!0},{field:"spec",title:"规格",width:"140"},{field:"hisHosUomValue",title:"医院单位",width:"180",align:"center",render:!0},{field:"hosCoefficient",title:"转换系数",width:"140",align:"center",render:!0},{field:"hosUom",title:"三雅单位",width:"80",align:"center",render:!0},{field:"update",title:"修改系数",align:"center",width:"150",render:!0},{field:"btns",title:"操作",align:"center",width:"80",fixed:"right",render:!0}]),z=()=>{f.value=!0,ue(i.value).then(({data:e})=>{f.value=!1,H(e.records),C.value=e.total}).catch(()=>{f.value=!1,H([]),C.value=0})},H=e=>{p.value=[],e.forEach((t,c)=>{t.drugUomVoList&&t.drugUomVoList.length>0?t.drugUomVoList.forEach((g,_)=>{p.value.push(V(b(b({},t),g),{isFirst:_===0,_subIndex:_,len:t.drugUomVoList.length}))}):p.value.push(V(b({},t),{hisHosUomValue:0,hisHosUom:"",hosCoefficient:0,hosUom:t.hosUom||"",isFirst:!0,len:1,_subIndex:c}))})},L=({row:e,column:t,rowIndex:c,columnIndex:g})=>{if(e.len>0){if(e.isFirst){if(e.len>1&&["drugCode","drugName","spec","btns"].indexOf(t.property)>-1)return{rowspan:e.len,colspan:1}}else if(["drugCode","drugName","spec","btns"].indexOf(t.property)>-1)return{rowspan:0,colspan:0}}};function M(e,t){const c=e.scope.rowIndex+t.len;p.value.splice(c,0,{drugCode:t.drugCode,drugName:t.drugName,spec:t.spec,syDrugId:t.syDrugId,id:"",hisHosUomValue:"",hisHosUom:"",hosCoefficient:"",hosUom:t.hosUom,isFirst:!1,_subIndex:t.len,len:t.len+1}),t.len++}function B(e,t){s("您确定要删除当前项吗","是否确定删除？",()=>{t.id?de({id:t.id,syDrugId:t.syDrugId}).then(({msg:c})=>{n(c,"success","hey"),m()}):m()})}function O(e){if(e.hosUom==e.hisHosUom)return n("同医院单位不能添加两条一样的数据！","error","hey");ce({id:e.id,syDrugId:e.syDrugId,hosUom:e.hosUom,hisHosUom:e.hisHosUom,hosCoefficient:e.hosCoefficient,hisHosUomValue:e.hisHosUomValue}).then(({msg:t})=>{n(t,"success","hey"),m()})}function T(e){if(!e.hisHosUomValue||!e.hisHosUom||!e.hosCoefficient)return!0}const I=h(null),E=e=>{I.value.showInst(e.syDrugId)},P=e=>{i.value.pageNum=1,i.value.pageSize=e,m()},R=e=>{i.value.pageNum=e,m()};return(e,t)=>{const c=re,g=y("el-input-number"),_=y("el-input"),U=y("el-button"),j=ne,A=se,Z=ae,q=le;return ee(),te("div",he,[a(c,{ref_key:"refSearch",ref:x,modelValue:u(i),"onUpdate:modelValue":t[0]||(t[0]=o=>oe(i)?i.value=o:null),isCache:!1,"search-data":u($),"search-name":"matching-tools-unit-convert-search",searching:u(f),border:!1,onSearch:z},null,8,["modelValue","search-data","searching"]),v("div",me,[a(A,{ref:"tableRef","table-name":"matching-tools-unit-convert-table",border:!0,isShowTableSet:!1,loading:u(f),"table-data":u(p),columns:u(F),"span-method":L,isVirtuallyScroll:!1},{drugName:d(o=>[v("span",{class:"drug-name",onClick:r=>E(o.row)},S(o.row.drugName),9,fe)]),hisHosUomValue:d(o=>[v("div",pe,[a(g,{class:"number-input",modelValue:o.row.hisHosUomValue,"onUpdate:modelValue":r=>o.row.hisHosUomValue=r,min:0,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"]),a(_,{class:"unit",modelValue:o.row.hisHosUom,"onUpdate:modelValue":r=>o.row.hisHosUom=r,placeholder:"单位"},null,8,["modelValue","onUpdate:modelValue"])])]),hosCoefficient:d(o=>[a(g,{class:"number-input",modelValue:o.row.hosCoefficient,"onUpdate:modelValue":r=>o.row.hosCoefficient=r,min:0,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),hosUom:d(o=>[v("span",null,S(o.row.hosUom),1)]),update:d(o=>[a(U,{text:"",type:"primary",disabled:T(o.row),onClick:r=>O(o.row)},{default:d(()=>[w("修改系数")]),_:2},1032,["disabled","onClick"]),a(U,{text:"",type:"primary",onClick:r=>B(o,o.row)},{default:d(()=>[w("删除")]),_:2},1032,["onClick"])]),btns:d(o=>[a(U,{text:"",type:"primary",onClick:r=>M(o,o.row)},{default:d(()=>[a(j,{icon:"icon-tianjia"})]),_:2},1032,["onClick"])]),_:1},8,["loading","table-data","columns"])]),a(Z,{"current-page":u(i).pageNum,"page-size":u(i).pageSize,total:u(C),"prev-text":"上一页","next-text":"下一页",onCurrentChange:R,onSizeChange:P},null,8,["current-page","page-size","total"]),a(q,{ref_key:"drugInst",ref:I},null,512)])}}}),He=ie(ge,[["__scopeId","data-v-e59b8700"]]);export{He as default};
