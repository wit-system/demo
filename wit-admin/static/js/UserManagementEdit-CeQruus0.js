var j=(b,B,_)=>new Promise((R,x)=>{var U=f=>{try{y(_.next(f))}catch(g){x(g)}},C=f=>{try{y(_.throw(f))}catch(g){x(g)}},y=f=>f.done?R(f.value):Promise.resolve(f.value).then(U,C);y((_=_.apply(b,B)).next())});import{d as ie,aj as ue,r as v,b as M,m,o as p,q as V,s as d,y as o,x as E,p as t,c as w,F as S,A as H,B as pe,z as F,a6 as A,V as me,aC as ce,aD as fe,a5 as he,aE as Ve,aF as ge,aG as ve,aH as G,aI as ye,ae as K,aJ as be,H as _e,ah as we,I as Ie,J as Ue,n as I,ac as Ce,aK as ke,_ as Ne}from"./index-BNylXLUF.js";const Q=b=>(Ie("data-v-2f4364f5"),b=b(),Ue(),b),Le=Q(()=>I("div",{class:"card-header"},[I("span",{class:"left-pry"}),I("span",null,"基础配置")],-1)),Ee=Q(()=>I("div",{class:"card-header"},[I("span",{class:"left-pry"}),I("span",null,"账号配置")],-1)),Se=ie({name:"UserManagementEdit",__name:"UserManagementEdit",emits:["fetch-data"],setup(b,{expose:B,emit:_}){const R=ue(),x=_,U=v(null),C=v([]),y=v([]),f=v([]),g=v([]),h=v([]);let a=M({userId:void 0,nickName:"",deptId:"",deptIdList:[],phonenumber:"",email:"",userName:"",password:"",sex:"",status:"",postIds:[],roleIds:[],remark:"",hospitalList:[],type:"",sysUserConfigVo:{isMultiSystemLogin:"1",periods:[]}});const W=n=>{a.deptIdList=[n.id]},i=M([{seq:0,value:""}]),q={usernameVerification:!1,passwordVerification:!1},X=()=>{const n={value:"",seq:0};i.length>5||i.push(n)},Z=()=>{i.pop()},ee=()=>{a.sysUserConfigVo.enableStartDate=h.value?h.value[0]:"",a.sysUserConfigVo.enableEndDate=h.value?h.value[1]:""},ae=M({userName:[{required:!0,validator:(n,e,r)=>{q.usernameVerification&&!ke(e)?r(new Error("账户必须由字母或字母加数字、且长度至少为6位组成")):e.length<2||e.length>20?r(new Error("账户长度必须在2到20个字符之间")):r()},trigger:"blur"}],deptId:[{required:!0,trigger:["blur","change"],message:"请选择归属部门"}],nickName:[{required:!0,trigger:"blur",message:"请输入用户昵称"}],password:[{required:!0,validator:(n,e,r)=>{q.usernameVerification&&!Ce(e)?r(new Error("密码需包含10位大小写字母，数字，特殊字符至少其中3种")):e.length<5||e.length>20?r(new Error("密码长度必须在5到20个字符之间")):r()},trigger:"blur"}],roleIds:[{required:!0,trigger:["blur","change"],message:"请选择角色"}],hospitalList:[{required:!0,trigger:["blur","change"],message:"请选择医院"}],phonenumber:[{validator:(n,e,r)=>{e?me(e)?r():r(new Error("请填写正确的手机号")):r()},trigger:"blur"}],email:[{validator:(n,e,r)=>{e?ce(e)?r():r(new Error("请填写正确的邮箱")):r()},trigger:"blur"}]}),Y=v(""),k=v(!1);B({showEdit:(n,e,r)=>j(this,null,function*(){if(q.usernameVerification=n.usernameVerification,q.passwordVerification=n.passwordVerification,k.value=!0,r&&(a.deptId=r),yield fe().then(({data:u})=>{g.value=(u||[]).map(s=>(s.hosHospCode=s.deptCode,s.hosHospName=s.deptName,s))}),he().then(({data:u})=>{f.value=u}),Ve().then(u=>{C.value=u.data.records}),ge().then(u=>{y.value=u.data.records}),!e)Y.value="添加用户",a.userId=void 0,a.hospitalList=g.value.length?[g.value[0]]:[];else{Y.value="编辑";const u={userId:e.userId};a.userId=e.userId,ve(u).then(s=>{if(C.value=s.data.posts,y.value=s.data.roles,a.postIds=s.data.postIds,a.roleIds=s.data.roleIds,a.hospitalList=s.data.data.hospitalList,a.type=s.data.data.type,a.userName=s.data.data.userName,a.nickName=s.data.data.nickName,a.phonenumber=s.data.data.phonenumber,a.email=s.data.data.email,a.sex=s.data.data.sex,a.remark=s.data.data.remark,a.status=s.data.data.status,a.deptId=""+s.data.data.deptId,a.deptIdList=[a.deptId],a.ybPharmacistCode=s.data.data.ybPharmacistCode,a.sysUserConfigVo=s.data.data.sysUserConfigVo,h.value=[s.data.data.sysUserConfigVo.enableStartDate||"",s.data.data.sysUserConfigVo.enableEndDate||""],s.data.data.sysUserConfigVo.periods&&s.data.data.sysUserConfigVo.periods.length>0){const $=s.data.data.sysUserConfigVo.periods.map(c=>{const T=c.startTime.split(":"),N=c.endTime.split(":");return{seq:c.seq,value:[new Date(2016,9,10,T[0],T[1]),new Date(2016,9,10,N[0],N[1])]}});i.splice(0,i.length,...$)}else i.splice(0,i.length,{seq:0,value:""})})}})});const D=()=>{U.value.resetFields(),a=M({userId:void 0,nickName:"",deptId:"",phonenumber:"",email:"",userName:"",password:"",sex:"",status:"",postIds:[],roleIds:[],hospitalList:[],remark:"",type:"",sysUserConfigVo:{isMultiSystemLogin:"1",periods:[]}}),h.value=[],i.splice(0,i.length,{seq:0,value:""}),k.value=!1,x("fetch-data")},le=()=>{a.sysUserConfigVo.periods=[],i.forEach((n,e)=>{n.value&&n.value[0]&&n.value[1]&&a.sysUserConfigVo.periods.push({startTime:G(n.value[0],"HH:mm"),endTime:G(n.value[1],"HH:mm"),seq:e})}),U.value.validate(n=>{n&&(a.userId===void 0?ye(a).then(()=>{K.success("用户新增成功"),D()}):be(a).then(()=>{K.success("用户更改成功"),D()}))})},te=()=>{const n=[];for(let e=0;e<60;e++)new Date().getSeconds()<=e||n.push(e);return n};return(n,e)=>{const r=m("el-option"),u=m("el-select"),s=m("el-form-item"),$=m("el-tree-select"),c=m("el-input"),T=m("el-switch"),N=m("el-card"),se=m("el-date-picker"),O=m("el-radio"),oe=m("el-radio-group"),de=m("el-time-picker"),J=_e,P=m("el-button"),re=m("el-form"),ne=we;return p(),V(ne,{modelValue:t(k),"onUpdate:modelValue":e[18]||(e[18]=l=>A(k)?k.value=l:null),"append-to-body":"",top:"8vh",title:t(Y),width:"800px",onClose:D,class:"userEdit"},{footer:d(()=>[o(P,{onClick:D},{default:d(()=>[E("取 消")]),_:1}),o(P,{type:"primary",onClick:le},{default:d(()=>[E("确 定")]),_:1})]),default:d(()=>[o(re,{ref_key:"formRef",ref:U,inline:"","label-width":"120px",model:t(a),rules:t(ae)},{default:d(()=>[o(N,{shadow:"never"},{header:d(()=>[Le]),default:d(()=>[o(s,{label:"归属医院",prop:"hospitalList",style:{width:"100%"}},{default:d(()=>[o(u,{modelValue:t(a).hospitalList,"onUpdate:modelValue":e[0]||(e[0]=l=>t(a).hospitalList=l),multiple:"",filterable:"",placeholder:"请选择","value-key":"hosHospCode"},{default:d(()=>[(p(!0),w(S,null,H(t(g),l=>(p(),V(r,{key:l.hosHospCode,label:l.hosHospName,value:l},{default:d(()=>[E(pe(l.hosHospName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(s,{label:"归属部门",prop:"deptId",style:{width:"100%"}},{default:d(()=>[o($,{modelValue:t(a).deptId,"onUpdate:modelValue":e[1]||(e[1]=l=>t(a).deptId=l),"check-strictly":"",data:t(f),placeholder:"请选择归属部门",props:{value:"id",label:"label",children:"children"},"value-key":"id",onNodeClick:W},null,8,["modelValue","data"])]),_:1}),o(s,{label:"用户角色",prop:"roleIds",style:{width:"100%"}},{default:d(()=>[o(u,{modelValue:t(a).roleIds,"onUpdate:modelValue":e[2]||(e[2]=l=>t(a).roleIds=l),multiple:"",filterable:"",placeholder:"请选择"},{default:d(()=>[(p(!0),w(S,null,H(t(y),l=>(p(),V(r,{key:l.roleId,disabled:l.status==1,label:l.roleName,value:l.roleId},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(a).userId==null?(p(),V(s,{key:0,label:"用户名称",prop:"userName",style:{width:"100%"}},{default:d(()=>[o(c,{modelValue:t(a).userName,"onUpdate:modelValue":e[3]||(e[3]=l=>t(a).userName=l),clearable:"",autocomplete:"new-password",placeholder:"请输入",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):F("",!0),t(a).userId==null?(p(),V(s,{key:1,label:"用户密码",prop:"password",style:{width:"100%"}},{default:d(()=>[o(c,{modelValue:t(a).password,"onUpdate:modelValue":e[4]||(e[4]=l=>t(a).password=l),clearable:"",autocomplete:"new-password","show-password":"",type:"password",placeholder:"请输入",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):F("",!0),o(s,{label:"用户昵称",prop:"nickName",style:{width:"45%"}},{default:d(()=>[o(c,{modelValue:t(a).nickName,"onUpdate:modelValue":e[5]||(e[5]=l=>t(a).nickName=l),clearable:"",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(s,{label:"用户性别",style:{width:"45%"}},{default:d(()=>[o(u,{modelValue:t(a).sex,"onUpdate:modelValue":e[6]||(e[6]=l=>t(a).sex=l),placeholder:"请选择"},{default:d(()=>[o(r,{key:"0",label:"男",value:"0"}),o(r,{key:"1",label:"女",value:"1"}),o(r,{key:"2",label:"未知",value:"2"})]),_:1},8,["modelValue"])]),_:1}),o(s,{label:"手机号码",prop:"phonenumber",style:{width:"45%"}},{default:d(()=>[o(c,{modelValue:t(a).phonenumber,"onUpdate:modelValue":e[7]||(e[7]=l=>t(a).phonenumber=l),clearable:"",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(s,{label:"邮箱",prop:"email",style:{width:"45%"}},{default:d(()=>[o(c,{modelValue:t(a).email,"onUpdate:modelValue":e[8]||(e[8]=l=>t(a).email=l),clearable:"",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(s,{label:"状态",style:{width:"45%"},class:"isShadow"},{default:d(()=>[o(T,{modelValue:t(a).status,"onUpdate:modelValue":e[9]||(e[9]=l=>t(a).status=l),"active-value":"0","inactive-value":"1"},null,8,["modelValue"])]),_:1}),o(s,{label:"职位",style:{width:"45%"}},{default:d(()=>[o(u,{modelValue:t(a).postIds,"onUpdate:modelValue":e[10]||(e[10]=l=>t(a).postIds=l),multiple:"",placeholder:"请选择"},{default:d(()=>[(p(!0),w(S,null,H(t(C),l=>(p(),V(r,{key:l.postId,disabled:l.status==1,label:l.postName,value:l.postId},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(s,{label:"医保药师编号",prop:"ybPharmacistCode",style:{width:"45%"}},{default:d(()=>[o(c,{modelValue:t(a).ybPharmacistCode,"onUpdate:modelValue":e[11]||(e[11]=l=>t(a).ybPharmacistCode=l),clearable:"",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(s,{label:"备注",style:{width:"45%"}},{default:d(()=>[o(c,{modelValue:t(a).remark,"onUpdate:modelValue":e[12]||(e[12]=l=>t(a).remark=l),clearable:"",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(s,{label:"用户类型",style:{width:"45%"}},{default:d(()=>[o(u,{modelValue:t(a).type,"onUpdate:modelValue":e[13]||(e[13]=l=>t(a).type=l),placeholder:"请选择"},{default:d(()=>[(p(!0),w(S,null,H(t(R).wordbook.user_type,l=>(p(),V(r,{key:l.dictValue,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(N,{shadow:"never"},{header:d(()=>[Ee]),default:d(()=>[o(s,{label:"账号有效期",style:{width:"500px"}},{default:d(()=>[o(se,{modelValue:t(h),"onUpdate:modelValue":e[14]||(e[14]=l=>A(h)?h.value=l:null),"end-placeholder":"结束日期","value-format":"YYYY-MM-DD HH:mm:ss","range-separator":"至","start-placeholder":"开始日期",type:"datetimerange",onChange:ee},null,8,["modelValue"])]),_:1}),o(s,{label:"允许多系统登录",style:{width:"500px"},class:"isShadow"},{default:d(()=>[o(oe,{modelValue:t(a).sysUserConfigVo.isMultiSystemLogin,"onUpdate:modelValue":e[15]||(e[15]=l=>t(a).sysUserConfigVo.isMultiSystemLogin=l)},{default:d(()=>[o(O,{value:"1",label:"是",size:"large"},{default:d(()=>[E("是")]),_:1}),o(O,{value:"0",label:"否",size:"large"},{default:d(()=>[E("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(s,{label:"允许登录时间段",style:{width:"700px"}},{default:d(()=>[(p(!0),w(S,null,H(t(i),(l,L)=>(p(),w("span",{key:L},[o(de,{modelValue:l.value,"onUpdate:modelValue":z=>l.value=z,"disabled-seconds":te,"end-placeholder":"结束时间",format:"HH:mm","is-range":"","range-separator":"至","start-placeholder":"开始时间",style:{width:"380px","margin-bottom":"8px"}},null,8,["modelValue","onUpdate:modelValue"]),L==t(i).length-1&&L>=0&&t(i).length<5?(p(),V(P,{key:0,class:"addTime",onClick:e[16]||(e[16]=z=>X())},{default:d(()=>[o(J,{icon:"ri-add-circle-line"})]),_:1})):F("",!0),L<=t(i).length-1&&L>=0&&t(i).length>1?(p(),V(P,{key:1,class:"addTime",onClick:e[17]||(e[17]=z=>Z())},{default:d(()=>[o(J,{icon:"ri-indeterminate-circle-line"})]),_:1})):F("",!0)]))),128))]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Fe=Ne(Se,[["__scopeId","data-v-2f4364f5"]]);export{Fe as default};
