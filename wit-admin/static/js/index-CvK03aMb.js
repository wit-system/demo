var P=(e,$,_)=>new Promise((V,C)=>{var v=c=>{try{r(_.next(c))}catch(b){C(b)}},y=c=>{try{r(_.throw(c))}catch(b){C(b)}},r=c=>c.done?V(c.value):Promise.resolve(c.value).then(v,y);r((_=_.apply(e,$)).next())});import{an as h,d as ae,r as u,b as te,m as g,o as oe,q as le,s as d,y as n,x as R,p as t,n as m,B as z,a6 as se,av as A,af as ne,ag as ce,H as ie,ah as re,I as ue,J as de,_ as pe}from"./index-CmC8Jr0A.js";function me(e){return h({url:`/system/his-homh-drug/page?pageNum=${e.pageNum}&pageSize=${e.pageSize}`,method:"post",data:e})}function fe(e){return h({url:`/system/sys/doc-list?pageNum=${e.pageNum}&pageSize=${e.pageSize}`,method:"post",data:{nickName:e.keyword}})}function ge(e){return h({url:`/system/sys/deptList?pageNum=${e.pageNum}&pageSize=${e.pageSize}`,method:"post",data:{deptName:e.keyword,deptType:4}})}function _e(e){return h({url:`/system/dept-group/page?pageNum=${e.pageNum}&pageSize=${e.pageSize}`,method:"post",data:{groupName:e.keyword}})}function he(e){return h({url:`/system/general-base/page?pageNum=${e.pageNum}&pageSize=${e.pageSize}`,method:"post",data:e})}function ve(e){return h({url:`/patient/follow-spec/page?pageNum=${e.pageNum}&pageSize=${e.pageSize}`,method:"post",data:{deptName:e.keyword}})}const ye=e=>(ue("data-v-1fc2d1a4"),e=e(),de(),e),be={class:"headerTitle title"},Ne={class:"headerFontBase headerName"},we={class:"headerFontBase headerNumber"},Se={class:"app-content"},Ce={class:"headerTitle title"},ke={class:"headerFontBase headerName"},xe={class:"headerFontBase headerNumber"},ze={class:"app-content"},$e=ye(()=>m("span",null,"删除",-1)),Ve=ae({name:"DataSelector",__name:"index",props:{modelValue:[Array]},emits:["update:modelValue"],setup(e,{expose:$,emit:_}){const V=e,C=_,v=u(1),y={1:{name:"药品",query:a=>me(a),field:["drugCode","drugName"]},2:{name:"科室",query:a=>ge(a),field:["deptCode","deptName"]},3:{name:"科室组",query:a=>_e(a),field:["id","groupName"]},4:{name:"医生",query:a=>fe(a),field:["userName","nickName"]},5:{name:"通用名",query:a=>he(a),field:["id","generalName"]},6:{name:"科室",query:a=>ve(a),field:["specCode","specName"]}},r=u(""),c=u(!1),b=u(null),p=te({keyword:"",pageNum:1,pageSize:50}),k=u(!1),M=u(!1),N=u([]),T=u([]),x=u(0),s=u([]),E=u([]),j=u(0),D=u(null),q=new Map,J=()=>"boldFont";$({showEdit:a=>{c.value=!0,r.value=y[a.selectorType].name,v.value=a.selectorType,T.value=[{width:"40",type:"checkbox"},{field:"code",title:r.value+"编码",width:"150"},{field:"name",title:r.value+"名称",width:"364"}],E.value=[{field:"code",title:r.value+"编码",width:"150"},{field:"name",title:r.value+"名称",width:"314"},{field:"btns",title:"操作",width:"90",fixed:"right",render:!0}],A(()=>{s.value=JSON.parse(JSON.stringify(V.modelValue)),w(!0)})}});function H(a){p.pageNum=a,w()}function U(a){p.pageNum=1,p.pageSize=a,w()}function w(a=!1){return P(this,null,function*(){k.value=!0;const{data:o}=yield y[v.value].query(p);k.value=!1;const i=y[v.value].field;N.value=(o.records||o).map(l=>{let f=!1;return s.value.forEach((L,I)=>{l[i[0]]==L.code&&(f=!0)}),Object.assign({},l,{isSelected:f,code:l[i[0]],name:l[i[1]]})}),x.value=o.total||0,A(()=>{const l=N.value.filter(f=>{if(f.isSelected)return f});D.value.tableMethods("setCheckboxRow",l,!0)})})}const G=({checked:a})=>{a?N.value.forEach(o=>{let i=!1;s.value.forEach((l,f)=>{o.code==l.code&&(i=!0)}),i||s.value.push(o)}):N.value.forEach(o=>{s.value.forEach((i,l)=>{o.code==i.code&&s.value.splice(l,1)})})},K=({checked:a,row:o})=>{a?s.value.push(o):s.value.forEach((i,l)=>{o.code==i.code&&s.value.splice(l,1)})};function Q(a){s.value.forEach((o,i)=>{a.code==o.code&&(s.value.splice(i,1),D.value.tableMethods("toggleCheckboxRow",a))})}const B=()=>{c.value=!1,s.value=[],q.clear()},W=()=>{C("update:modelValue",s.value),c.value=!1,s.value=[],q.clear()};return(a,o)=>{const i=g("el-input"),l=g("el-button"),f=g("el-form-item"),L=g("el-divider"),I=g("el-form"),F=ne,X=ce,O=g("el-col"),Y=ie,Z=g("el-row"),ee=re;return oe(),le(ee,{class:"dataSelectorDialog",modelValue:t(c),"onUpdate:modelValue":o[1]||(o[1]=S=>se(c)?c.value=S:null),"append-to-body":"",title:t(r)+"选择",width:"1160px",onClose:B},{footer:d(()=>[n(l,{onClick:B},{default:d(()=>[R("取 消")]),_:1}),n(l,{type:"primary",onClick:W},{default:d(()=>[R("保 存")]),_:1})]),default:d(()=>[n(I,{ref_key:"formRef",ref:b,"label-width":"80px",model:t(p),"label-position":"left"},{default:d(()=>[n(f,{label:t(r)+"名称"},{default:d(()=>[n(i,{modelValue:t(p).keyword,"onUpdate:modelValue":o[0]||(o[0]=S=>t(p).keyword=S),modelModifiers:{trim:!0},clearable:"",onClear:w,style:{width:"300px","margin-right":"8px"}},null,8,["modelValue"]),n(l,{type:"primary",loading:t(k),onClick:w},{default:d(()=>[R("搜 索")]),_:1},8,["loading"])]),_:1},8,["label"]),n(L)]),_:1},8,["model"]),n(Z,{gutter:8},{default:d(()=>[n(O,{span:12},{default:d(()=>[m("div",be,[m("span",Ne,"待选"+z(t(r))+"总数：",1),m("span",we,z(t(x)),1)]),m("div",Se,[n(F,{ref_key:"tableRef",ref:D,height:"495","table-name":"system-dataSelectorLeft",loading:t(k),tableData:t(N),columns:t(T),total:t(x),isShowTableSet:!1,"checkbox-config":{trigger:"row"},onCheckboxAll:G,onCheckboxChange:K,"header-cell-class-name":J},null,8,["loading","tableData","columns","total"]),n(X,{"current-page":t(p).pageNum,"page-size":t(p).pageSize,total:t(x),"pager-count":5,layout:"sizes, prev, pager, next, jumper",onCurrentChange:H,onSizeChange:U},null,8,["current-page","page-size","total"])])]),_:1}),n(O,{span:12},{default:d(()=>[m("div",Ce,[m("span",ke,"已选"+z(t(r))+"：",1),m("span",xe,z(t(s).length),1)]),m("div",ze,[n(F,{height:"495","table-name":"system-dataSelectorRight",loading:t(M),tableData:t(s),columns:t(E),total:t(j),isShowTableSet:!1},{btns:d(S=>[n(l,{text:"",type:"primary",onClick:Le=>Q(S.row)},{default:d(()=>[n(Y,{icon:"icon-a-zujian2131",style:{"font-size":"16px"}}),$e]),_:2},1032,["onClick"])]),_:1},8,["loading","tableData","columns","total"])])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}}),Ee=pe(Ve,[["__scopeId","data-v-1fc2d1a4"]]);export{Ee as default};
