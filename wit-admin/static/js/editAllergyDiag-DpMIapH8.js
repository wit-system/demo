var C=(U,N,V)=>new Promise((S,f)=>{var m=c=>{try{b(V.next(c))}catch(k){f(k)}},i=c=>{try{b(V.throw(c))}catch(k){f(k)}},b=c=>c.done?S(c.value):Promise.resolve(c.value).then(m,i);b((V=V.apply(U,N)).next())});import{d as ee,P as le,r as _,aj as ae,b as te,m as y,T as se,o as d,c as h,y as u,s as n,x as D,p as a,t as oe,q as p,n as A,F as w,A as T,B as J,z as ne,a6 as re,ah as de,bt as ie,_ as ue}from"./index-1fQ0gozz.js";import{s as ce,c as ge,i as ye}from"./ruleAllergy-DYdvidcu.js";const pe={class:"edit-cf-edit-container"},fe={class:"radio-bg"},me={key:0},_e={class:"radio-bg"},be=ee({__name:"editAllergyDiag",emits:["query"],setup(U,{expose:N,emit:V}){const S=le("$baseMessage"),f=_(!1),m=_(!1),i=_("新增过敏规则"),b=_([]),c=_([]),k=V,x=_(),B=ae(),e=te({generalId:"",allergyType:"1",allergyCode:"",id:"",allergyName:"",warnSign:"0",active:"0",severity:"0",allergyDtos:[],allergyTypeDtos:[],classifyCode:[]}),P=JSON.parse(JSON.stringify(e)),L=s=>C(this,null,function*(){let t=yield ce({ingredient:s||"",type:1,pageNum:1,pageSize:50});if(t.resultCode!=1){b.value=[];return}b.value=t.data.records||[]});function R(){return C(this,null,function*(){let s=yield ye({generalId:e.generalId,syDrugId:"",drugsId:""});if(s.resultCode!=1){c.value=[];return}c.value=M(s.data||[],"ingredientId")})}const E=_([]),$=()=>C(this,null,function*(){const s=yield ie({});E.value=s.data||[]});function M(s,t=""){const r=[],g=[];return t?s.forEach(o=>{g.includes(o[t])||(g.push(o[t]),r.push(o))}):s.forEach(o=>r.includes(o)?"":r.push(o)),r}function Y(s,t,r){return C(this,null,function*(){e.generalId=r,f.value=!0,t=="edit"||t=="see"?(i.value=t=="see"?"查看过敏规则":"编辑过敏规则",Object.assign(e,s,{allergyDtos:[{id:s.allergyCode,ingredient:s.allergyName}]}),L(s.allergyName)):(i.value="新增过敏规则",L("")),R(),$()})}const I=()=>{m.value=!1,f.value=!1,Object.assign(e,JSON.parse(JSON.stringify(P)))},j=_(null),G=()=>C(this,null,function*(){if(i.value=="查看过敏规则"){x.value.resetFields(),I(),k("query");return}m.value=!0;try{let s={};if(i.value=="新增过敏规则"){let r=[],g=[];e.allergyType=="1"?g=(j.value.getCheckedNodes()||[]).map(o=>({allergyCode:o.value,allergyName:o.label,generalId:e.generalId})):g=e.allergyDtos.map(o=>({allergyCode:o.id,allergyName:o.ingredient,generalId:e.generalId})),e.allergyType=="2"&&c.value.forEach(o=>{let O=o.ingredientId||"";(e.allergyTypeDtos||[]).forEach(v=>{v==O&&r.push({allergyCode:o.ingredientId,allergyName:o.ingredient})})}),s=Object.assign({},s,{id:"",severity:e.severity,allergyType:e.allergyType,generalId:e.generalId,allergyDtos:g,allergyTypeDtos:r,warnSign:e.warnSign})}else{let r="",g="";(e.allergyDtos||[]).forEach(o=>{r=o.id,g=o.ingredient}),s=Object.assign({},s,{id:e.id,severity:e.severity,allergyType:e.allergyType,generalId:e.generalId,warnSign:e.warnSign,allergyCode:r,allergyName:g})}const{msg:t}=yield ge(s);m.value=!1,x.value.resetFields(),S(t,"success","hey"),I(),k("query")}catch(s){m.value=!1}});function H(s){e.classifyCode=[],e.allergyDtos=[],e.allergyTypeDtos=[]}return N({showDiag:Y}),(s,t)=>{const r=y("el-radio"),g=y("el-radio-group"),o=y("el-checkbox-button"),O=y("el-checkbox-group"),v=y("el-form-item"),F=y("el-option"),q=y("el-select"),K=y("el-input"),Q=y("el-cascader"),W=y("el-form"),z=y("el-button"),X=de,Z=se("loading");return d(),h("div",pe,[u(X,{modelValue:a(f),"onUpdate:modelValue":t[7]||(t[7]=l=>re(f)?f.value=l:null),title:a(i),width:"826px",modal:!1,"append-to-body":"",onClose:I,class:"no-form-line-margin pointerEvents",style:{"min-height":"500px"}},{footer:n(()=>[u(z,{onClick:I},{default:n(()=>[D("取 消")]),_:1}),u(z,{disabled:a(m),type:"primary",onClick:G},{default:n(()=>[D("确 定")]),_:1},8,["disabled"])]),default:n(()=>[oe((d(),p(W,{ref_key:"formRef",ref:x,model:a(e),"label-width":"80px"},{default:n(()=>[u(v,{label:"代码类型"},{default:n(()=>[A("div",fe,[u(g,{modelValue:a(e).allergyType,"onUpdate:modelValue":t[0]||(t[0]=l=>a(e).allergyType=l),onChange:H},{default:n(()=>[u(r,{value:"1",disabled:a(i)!="新增过敏规则"},{default:n(()=>[D("药理作用")]),_:1},8,["disabled"]),u(r,{value:"2",disabled:a(i)!="新增过敏规则"},{default:n(()=>[D("成份代码")]),_:1},8,["disabled"])]),_:1},8,["modelValue"]),a(e).allergyType=="2"?(d(),h("div",me,[u(O,{modelValue:a(e).allergyTypeDtos,"onUpdate:modelValue":t[1]||(t[1]=l=>a(e).allergyTypeDtos=l),class:"checkbox-group"},{default:n(()=>[(d(!0),h(w,null,T(a(c),l=>(d(),p(o,{label:l.ingredientId,key:l.ingredientId},{default:n(()=>[D(J(l.ingredient+"("+l.ingredientId+")"),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):ne("",!0)])]),_:1}),a(e).allergyType=="2"?(d(),p(v,{key:0,label:"过敏",class:"wit-select"},{default:n(()=>[u(q,{placeholder:"请选择,可多选",size:"large",style:{height:"100%"},modelValue:a(e).allergyDtos,"onUpdate:modelValue":t[2]||(t[2]=l=>a(e).allergyDtos=l),multiple:"",filterable:"","value-key":"id",remote:"","remote-method":L,disabled:a(i)!="新增过敏规则"},{default:n(()=>[(d(!0),h(w,null,T(a(b),l=>(d(),p(F,{key:l.id,value:l,label:l.ingredient},null,8,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})):(d(),p(v,{key:1,label:"过敏",class:"wit-select"},{default:n(()=>[a(i)!="新增过敏规则"?(d(),p(K,{key:0,modelValue:a(e).allergyName,"onUpdate:modelValue":t[3]||(t[3]=l=>a(e).allergyName=l),disabled:"",style:{width:"100%"}},null,8,["modelValue"])):(d(),p(Q,{key:1,placeholder:"请选择或者输入关键字搜索",options:a(E),filterable:"",modelValue:a(e).classifyCode,"onUpdate:modelValue":t[4]||(t[4]=l=>a(e).classifyCode=l),style:{width:"100%"},clearable:"",props:{value:"classifyCode",label:"classifyName",checkStrictly:!0,multiple:!0},ref_key:"cascaderSelect",ref:j},null,8,["options","modelValue"]))]),_:1})),u(v,{label:"问题等级"},{default:n(()=>[u(q,{modelValue:a(e).severity,"onUpdate:modelValue":t[5]||(t[5]=l=>a(e).severity=l),size:"large",placeholder:"请选择",disabled:a(i)=="查看过敏规则"},{default:n(()=>[(d(!0),h(w,null,T(a(B).wordbook.problem_level_rule,l=>(d(),p(F,{key:l.dictLabel,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),u(v,{label:"禁慎用标识"},{default:n(()=>[A("div",_e,[u(g,{modelValue:a(e).warnSign,"onUpdate:modelValue":t[6]||(t[6]=l=>a(e).warnSign=l)},{default:n(()=>[(d(!0),h(w,null,T(a(B).wordbook.caution_signs,(l,ve)=>(d(),p(r,{key:l.dictValue,label:l.dictValue,value:l.dictValue,disabled:a(i)=="查看过敏规则"},{default:n(()=>[D(J(l.dictLabel),1)]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1},8,["model"])),[[Z,a(m)]])]),_:1},8,["modelValue","title"])])}}}),he=ue(be,[["__scopeId","data-v-3bb6fd6a"]]);export{he as default};
