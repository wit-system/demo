var y=(k,h,f)=>new Promise((R,D)=>{var C=i=>{try{_(f.next(i))}catch(g){D(g)}},$=i=>{try{_(f.throw(i))}catch(g){D(g)}},_=i=>i.done?R(i.value):Promise.resolve(i.value).then(C,$);_((f=f.apply(k,h)).next())});import{g as he,c as fe,d as ve,e as ye,f as we,h as be,_ as ke}from"./drugSelection-CSf4dCBA.js";import Ce from"./editDetailDiag-XhkGRUx8.js";import{d as xe,P,r as l,b as K,a0 as Se,m as A,o as w,c as b,y as a,s,n as c,p as o,a6 as X,ap as De,B as I,C as T,x as S,F as Ee,A as Le,af as Ae,ag as Re,H as $e,I as ze,J as Ie,_ as Ne}from"./index-CmC8Jr0A.js";import{_ as Ve}from"./index-BOVWkMYg.js";import{_ as Me}from"./index.vue_vue_type_style_index_0_lang-D4meg1a3.js";import{_ as Be,a as Oe}from"./witQueryFormTopPanel-BJ4VFzMU.js";import"./ifComponent.vue_vue_type_style_index_0_lang-ZpisXDR_.js";import"./index-COFi4TtR.js";import"./index.vue_vue_type_script_setup_true_lang-DtyLHHVv.js";import"./dict-BvhWhz6G.js";const j=k=>(ze("data-v-3e3316e2"),k=k(),Ie(),k),Te={class:"no-background-container auto-height-container"},je=j(()=>c("div",{class:"title"},"药品列表",-1)),Fe=j(()=>c("div",{class:"link"},null,-1)),We={class:"auto-height-container"},qe={style:{color:"#333333"}},Qe={class:"flex justify-between padding-out"},Ue={class:"title bg-w"},Ge=j(()=>c("span",null,"新增可替代药品",-1)),He={key:0},Je={key:1},Pe={key:0},Ke={key:1},Xe=xe({name:"Matching-Tools-Alternative-Drug-Management",__name:"index",setup(k){const h=P("$baseMessage"),f=P("$baseConfirm"),R=l(null),D=l(null),C=l(!1),$=l(null),_=l(!1),i=l(!1),g=l([]),u=l([]),Y=l([{field:"name",minWidth:"100",title:"药品组名"},{field:"status",title:"状态",minWidth:"100",filters:[{label:"启用",value:"1"},{label:"停用",value:"0"}],filterMultiple:!1,render:!0},{field:"btns",title:"操作",align:"center",width:"170",fixed:"right",render:!0}]),Z=l([{field:"sort",minWidth:"100",title:"推荐排序",render:!0,isRenderHeader:!0},{field:"drugAdminExtension",minWidth:"100",title:"药品属性",render:!0},{field:"drugName",minWidth:"100",title:"药品名称"},{field:"spec",minWidth:"100",title:"规格"},{field:"btns",title:"操作",align:"center",width:"70",fixed:"right",render:!0}]),N=l(0),V=l(0),F=l(),r=l({searchQuick:{keyword:""},status:"",pageNum:1,pageSize:10}),ee=K({searchListButtons:[{label:"搜 索",isShowLoading:!0,attrs:{type:"primary"},events:{click:W}},{label:"新 增",icon:"icon-xinzengdianpingjihua",attrs:{type:"primary"},events:{click:te}}],searchList:[{type:"searchQuick",field:"searchQuick",label:"药品组名",isOutBorder:!0,attrs:{width:180,placeholder:"请输入关键字搜索",clearable:!0},events:{clear:W}}]});function W(){F.value.search()}function te(){M("","add")}Se(()=>{x()});const x=()=>y(this,null,function*(){_.value=!0;let t={pageNum:r.value.pageNum,pageSize:r.value.pageSize,keyword:r.value.searchQuick.keyword,status:r.value.status};try{const{data:e}=yield he(t);_.value=!1,N.value=e.total||0,g.value=e.records||[],g.value.length>0?($.value.tableMethods("setCurrentRow",g.value[0]),Q(e.records[0])):(u.value=[],Object.keys(m).forEach(p=>{delete m[p]}))}catch(e){_.value=!1,N.value=0,g.value=[],Object.keys(m).forEach(p=>{delete m[p]})}}),ae=t=>{r.value.pageNum=1,r.value.pageSize=t,x()},q=t=>{r.value.pageNum=t,x()},ne=({property:t,values:e})=>{r.value[t]=e[0]||"",q(1)},m=K({});function Q(t){return y(this,null,function*(){m.groupId=t.id,z()})}const z=()=>y(this,null,function*(){i.value=!0;try{const{data:t}=yield fe(m);i.value=!1,V.value=t.length||0,u.value=t.map(e=>(e.hasOwnProperty("drugAdminExtension")&&(e.drugAdminExtension=e.drugAdminExtension==""?[]:e.drugAdminExtension.split(";")),e))}catch(t){i.value=!1,V.value=0,u.value=[]}}),M=(t={},e)=>{R.value.showEdit(t,e)},se=t=>{f("您确定要删除选中项吗",null,()=>y(this,null,function*(){const{msg:e}=yield ve([t]);h(e,"success","hey"),r.value.pageNum=1,yield x()}))},oe=t=>{f("您确定要删除选中项吗",null,()=>y(this,null,function*(){const{msg:e}=yield ye([t]);h(e,"success","hey"),yield z()}))},U=t=>y(this,null,function*(){if(u.value.length==0&&t){h("请选择药品列表有数据的编辑!!!","success","hey");return}if(t){C.value=!0;return}if(le(u.value,"sort")){h("序号不能重复","warning","hey");return}const{msg:e}=yield we(u.value);C.value=!1,h(e,"success","hey"),yield z()}),le=(t,e)=>{const E=JSON.parse(JSON.stringify(t)).filter(d=>d[e]),L=[];for(let d=0;d<E.length;d++)L.push(E[d][e]);return new Set(L).size!==L.length},re=l([]),ie=()=>{re.value=u.value,D.value.showEdit({selectorType:2})},ce=t=>{let e=l([]);t.forEach((p,E)=>{e.value.push({groupId:m.groupId,drugCode:p.drugCode})}),be({data:e.value,groupId:m.groupId}).then(({msg:p})=>{h(p,"success","hey"),z()})};return(t,e)=>{const p=Be,E=Oe,L=Me,d=A("el-button"),G=Ae,ue=Re,B=Ve,H=A("el-col"),O=$e,de=A("el-input-number"),J=A("el-tooltip"),pe=A("el-row"),_e=Ce,ge=ke;return w(),b("div",Te,[a(B,{class:"auto-height-card"},{default:s(()=>[a(E,{class:"padding-out"},{default:s(()=>[a(p,{span:24},{default:s(()=>[je,Fe]),_:1})]),_:1}),c("div",We,[a(pe,null,{default:s(()=>[a(H,{span:9},{default:s(()=>[a(B,{class:"auto-height-card has-header2"},{default:s(()=>[a(L,{ref_key:"refSearch",ref:F,modelValue:o(r),"onUpdate:modelValue":e[0]||(e[0]=n=>X(r)?r.value=n:null),"search-data":o(ee),"search-name":"matchingTools-alternativeDrugManagement",searching:o(_),onSearch:x,isCache:!1,border:!1},null,8,["modelValue","search-data","searching"]),a(G,{class:"ML8",ref_key:"tableGroupRef",ref:$,"table-name":"matching-tools-alternative-drug-managementL",loading:o(_),"table-data":o(g),columns:o(Y),isShowTableSet:!1,onFilterChange:ne,onCellClick:e[1]||(e[1]=n=>{Q(n.row)})},{status:s(n=>[c("div",null,[c("span",{class:"circleStyle",style:De({backgroundColor:n.row.status==1?"#22C580":"#ED6356"})},null,4),c("span",qe,I(n.row.status==1?"启用":"停用"),1)])]),btns:s(n=>[a(d,{text:"",type:"primary",onClick:T(v=>M(n.row,"view"),["stop"])},{default:s(()=>[S("查看")]),_:2},1032,["onClick"]),a(d,{text:"",type:"primary",onClick:T(v=>M(n.row,"edit"),["stop"])},{default:s(()=>[S("编辑")]),_:2},1032,["onClick"]),a(d,{text:"",type:"primary",onClick:T(v=>se(n.row.id),["stop"])},{default:s(()=>[S("删除")]),_:2},1032,["onClick"])]),_:1},8,["loading","table-data","columns"]),a(ue,{"current-page":o(r).pageNum,"page-size":o(r).pageSize,total:o(N),onCurrentChange:q,onSizeChange:ae,"prev-text":"上一页","next-text":"下一页"},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),a(H,{span:15},{default:s(()=>[a(B,{class:"auto-height-card has-header3"},{default:s(()=>[c("div",null,[c("div",Qe,[c("div",Ue,"药品列表 "+I(o(V))+" 条",1),a(d,{type:"primary",onClick:ie,disabled:!o(m).groupId},{default:s(()=>[a(O,{icon:"icon-xinzengdianpingjihua"}),Ge]),_:1},8,["disabled"])])]),a(G,{class:"MAll8",ref:"tableDrugRef","table-name":"matching-tools-alternative-drug-managementR",loading:o(i),"table-data":o(u),columns:o(Z),isShowTableSet:!1},{sort:s(n=>[o(C)?(w(),b("div",He,[a(de,{min:0,modelValue:n.row.sort,"onUpdate:modelValue":v=>n.row.sort=v,class:"tipsInput"},null,8,["modelValue","onUpdate:modelValue"])])):(w(),b("div",Je,I(n.row.sort),1))]),sortHeader:s(()=>[o(C)?(w(),b("span",Pe,[S(" 推荐排序 "),a(J,{effect:"dark",content:"保存",placement:"top"},{default:s(()=>[c("span",{class:"headerEdit",onClick:e[2]||(e[2]=n=>U(!1))},[a(O,{icon:"icon-baocun"})])]),_:1})])):(w(),b("span",Ke,[S(" 推荐排序 "),a(J,{effect:"dark",content:"修改",placement:"top"},{default:s(()=>[c("span",{class:"headerEdit",onClick:e[3]||(e[3]=n=>U(!0))},[a(O,{icon:"icon-xiugai"})])]),_:1})]))]),drugAdminExtension:s(n=>[(w(!0),b(Ee,null,Le(n.row.drugAdminExtension,(v,me)=>(w(),b("span",{class:"boxStyle",key:me},I(v),1))),128))]),btns:s(n=>[a(d,{text:"",type:"primary",onClick:v=>oe(n.row.id)},{default:s(()=>[S("删除")]),_:2},1032,["onClick"])]),_:1},8,["loading","table-data","columns"])]),_:1})]),_:1})]),_:1})])]),_:1}),a(_e,{ref_key:"drugEditDiag",ref:R,onFetchData:x},null,512),a(ge,{modelValue:o(u),"onUpdate:modelValue":[e[4]||(e[4]=n=>X(u)?u.value=n:null),ce],ref_key:"alternativeDrugsEditRef",ref:D},null,8,["modelValue"])])}}}),ct=Ne(Xe,[["__scopeId","data-v-3e3316e2"]]);export{ct as default};
