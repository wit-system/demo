var p=(r,_,e)=>new Promise((u,g)=>{var C=i=>{try{c(e.next(i))}catch(f){g(f)}},w=i=>{try{c(e.throw(i))}catch(f){g(f)}},c=i=>i.done?u(i.value):Promise.resolve(i.value).then(C,w);c((e=e.apply(r,_)).next())});import{an as b,d as ae,r as y,b as U,P as F,h as te,m as d,T as ne,o as I,c as le,y as a,s as t,t as H,q as O,p as s,x as v,B as D,n as N,b4 as oe,H as se,ag as ce}from"./index-BNylXLUF.js";import{_ as ie}from"./index-G5csSH1Q.js";import{_ as ue,a as re}from"./witQueryFormTopPanel-CyZBmoww.js";function me(r){return b({url:"/system/cache-manager/name-list",method:"post",data:{}})}function de(r){return b({url:"/system/cache-manager/key-list",method:"post",data:r})}function pe(r){return b({url:"/system/cache-manager/content",method:"post",data:r})}function _e(r){return b({url:"/system/cache-manager/del-key",method:"post",data:r})}function ge(r){return b({url:"/system/cache-manager/del-name",method:"post",data:r})}function fe(){return b({url:"/system/cache-manager/flush-db",method:"post"})}const he={class:"dictionary-management-container no-background-container auto-height-container"},ye=N("div",null,"缓存列表",-1),be=["onClick"],Ce=N("div",null,"键名列表",-1),ke=["onClick"],ve=N("div",null,"缓存内容",-1),xe=ae({__name:"index",setup(r){const _=y(0),e=U({pageNum:1,pageSize:20,keyword:""}),u=U({cacheName:"",cacheKey:"",cacheContent:""}),g=F("$baseConfirm"),C=F("$baseMessage"),w=y(null),c=U({nameListData:[],keyListData:[]}),i=y([]),f=y(null),x=y(!0),z=y(!0);te(()=>{S()});const A=n=>{e.pageNum=n,c.keyListData=i.value.slice((e.pageNum-1)*e.pageSize,e.pageNum*e.pageSize)},G=n=>{e.pageNum=1,e.pageSize=n,c.keyListData=i.value.slice((e.pageNum-1)*e.pageSize,e.pageNum*e.pageSize)},S=()=>p(this,null,function*(){x.value=!0;const n=yield me();c.nameListData=n.data,x.value=!1,c.nameListData.length>0&&(yield k(n.data[0]))}),J=n=>{if(n){const l=i.value.filter(m=>!n||m.cacheKey.toLowerCase().indexOf(n.toLowerCase())!=-1);c.keyListData=l.slice((e.pageNum-1)*e.pageSize,e.pageNum*e.pageSize),e.pageNum=1,_.value=l.length}else{const l=i.value;c.keyListData=l.slice((e.pageNum-1)*e.pageSize,e.pageNum*e.pageSize),e.pageNum=1,_.value=l.length}},k=(...l)=>p(this,[...l],function*(n={}){if(n.cacheName){f.value=n,z.value=!0,n.keyword=e.keyword;const m=yield de(n);i.value=m.data,_.value=m.data.length,e.pageNum=1,c.keyListData=i.value.slice((e.pageNum-1)*e.pageSize,e.pageNum*e.pageSize),z.value=!1,c.keyListData.length>0&&(yield P(c.keyListData[0]))}}),P=(...l)=>p(this,[...l],function*(n={}){if(n.cacheKey){const m=yield pe(n);u.cacheName=n.cacheName,u.cacheKey=m.data.cacheKey,u.cacheContent=m.data.cacheContent}}),Q=(n={})=>{n.cacheName&&g("您确定要删除该名称下的所有缓存吗",null,()=>p(this,null,function*(){const{msg:l}=yield ge(n);C(l,"success","hey"),yield S()}))},W=(n={})=>{n.cacheKey&&g("您确定要删除该缓存吗",null,()=>p(this,null,function*(){const{msg:l}=yield _e(n);C(l,"success","hey"),yield k(c.nameListData[0])}))},X=()=>{g("您确定要删除所有缓存吗？，此操作会影响和缓存相关业务（例如：强制所有用户下线、影响引擎分析结果等）",null,()=>p(this,null,function*(){const{msg:n}=yield fe();C(n,"success","hey"),yield k(c.nameListData[0])}))};return(n,l)=>{const m=se,V=ue,K=re,h=d("el-table-column"),$=d("el-button"),T=d("el-empty"),j=d("el-table"),B=ie,R=d("el-col"),L=d("el-input"),Y=ce,q=d("el-form-item"),Z=d("el-form"),ee=d("el-row"),E=ne("loading");return I(),le("div",he,[a(ee,{gutter:20},{default:t(()=>[a(R,{lg:8},{default:t(()=>[a(B,{class:"auto-height-card"},{default:t(()=>[a(K,null,{default:t(()=>[a(V,{span:12},{default:t(()=>[ye,a(m,{"aria-placeholder":"刷新",icon:"ri-refresh-line",style:{position:"absolute",right:"0"},onClick:l[0]||(l[0]=o=>S())})]),_:1})]),_:1}),H((I(),O(j,{ref_key:"tableRef",ref:w,data:s(c).nameListData,border:""},{empty:t(()=>[a(T,{class:"wit-data-empty",description:"暂无数据"})]),default:t(()=>[a(h,{align:"center",label:"序号",width:"55"},{default:t(({$index:o})=>[v(D(o+1),1)]),_:1}),a(h,{align:"center",label:"缓存键名",prop:"cacheName"},{default:t(({row:o})=>[N("div",{style:{color:"#0d84ff","text-align":"left",cursor:"pointer"},onClick:M=>k(o)},D(o.cacheName),9,be)]),_:1}),a(h,{align:"center",label:"操作",width:"100"},{default:t(({row:o})=>[a($,{text:"",type:"danger",onClick:M=>Q(o)},{default:t(()=>[v("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[E,s(x)]])]),_:1})]),_:1}),a(R,{lg:8},{default:t(()=>[a(B,{class:"auto-height-card"},{default:t(()=>[a(K,null,{default:t(()=>[a(V,{span:12},{default:t(()=>[Ce,a(L,{modelValue:s(e).keyword,"onUpdate:modelValue":l[1]||(l[1]=o=>s(e).keyword=o),modelModifiers:{trim:!0},onInput:l[2]||(l[2]=o=>J(s(e).keyword)),clearable:"",placeholder:"关键字",style:{position:"absolute",right:"30px",bottom:"2px",height:"24px"}},null,8,["modelValue"]),a(m,{"aria-placeholder":"刷新",icon:"ri-refresh-line",style:{position:"absolute",right:"0"},onClick:l[3]||(l[3]=o=>k(s(f)||s(c).nameListData[0]))})]),_:1})]),_:1}),H((I(),O(j,{ref_key:"tableRef",ref:w,data:s(c).keyListData,border:""},{empty:t(()=>[a(T,{class:"wit-data-empty",description:"暂无数据"})]),default:t(()=>[a(h,{align:"center",label:"序号",width:"55"},{default:t(({$index:o})=>[v(D(o+1),1)]),_:1}),a(h,{align:"center",label:"缓存键名",prop:"cacheKey"},{default:t(({row:o})=>[N("div",{style:{color:"#0d84ff","text-align":"left",cursor:"pointer"},onClick:M=>P(o)},D(o.cacheKey),9,ke)]),_:1}),a(h,{align:"center",label:"操作",width:"100"},{default:t(({row:o})=>[a($,{text:"",type:"danger",onClick:M=>W(o)},{default:t(()=>[v("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[E,s(z)]]),a(Y,{"current-page":s(e).pageNum,"page-size":s(e).pageSize,small:!0,total:s(_),layout:"total, prev, pager, next",onCurrentChange:A,onSizeChange:G},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),a(R,{lg:8},{default:t(()=>[a(B,{class:"auto-height-card"},{default:t(()=>[a(K,null,{default:t(()=>[a(V,{span:12},{default:t(()=>[ve,a($,{type:"warning",icon:s(oe),style:{position:"absolute",right:"0",bottom:"-2px",height:"25px"},onClick:X},{default:t(()=>[v(" 清除全部缓存 ")]),_:1},8,["icon"])]),_:1})]),_:1}),a(Z,{ref:"formRef",model:s(u),"label-width":"80px"},{default:t(()=>[a(q,{label:"缓存名称",prop:"cacheName"},{default:t(()=>[a(L,{modelValue:s(u).cacheName,"onUpdate:modelValue":l[4]||(l[4]=o=>s(u).cacheName=o),clearable:""},null,8,["modelValue"])]),_:1}),a(q,{label:"缓存键名",prop:"cacheKey"},{default:t(()=>[a(L,{modelValue:s(u).cacheKey,"onUpdate:modelValue":l[5]||(l[5]=o=>s(u).cacheKey=o),clearable:""},null,8,["modelValue"])]),_:1}),a(q,{label:"缓存内容",prop:"cacheContent"},{default:t(()=>[a(L,{modelValue:s(u).cacheContent,"onUpdate:modelValue":l[6]||(l[6]=o=>s(u).cacheContent=o),autosize:{minRows:10,maxRows:24},clearable:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}});export{xe as default};
