import{$ as V,_ as j,o as a,c as u,n as Y,t as B,v as p,a7 as b,ap as y,az as d,z as g}from"./index-CmC8Jr0A.js";const q={name:"WitMagnifier",props:{url:{type:String,default:""},highUrl:{type:String,default:""},width:{type:Number,default:168},height:{type:Number,default:-1},type:{type:String,default:"square",validator:function(e){return["circle","square"].indexOf(e)!==-1}},zoomerStyle:{type:Object,default(){return{}}},outZoomerStyle:{type:Object,default(){return{}}},scale:{type:Number,default:2},enterEvent:{type:[Object,UIEvent],default:null},moveEvent:{type:[Object,UIEvent],default:null},leaveEvent:{type:[Object,UIEvent],default:null},selector:{type:Boolean,default:!0},outZoomer:{type:Boolean,default:!1},pointer:{type:Boolean,default:!1},baseline:{type:Boolean,default:!1},disabledReactive:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},mask:{type:Boolean,default:!0},maskColor:{type:String,default:""}},emits:["mousemove","mouseleave","mouseenter","created"],data(){return{zoomerRect:{top:0,left:0,absoluteLeft:0,absoluteTop:0},zoomerBgRect:{top:0,left:0},zoomerPoint:{leftBound:0,topBound:0,rightBound:0,bottomBound:0},vZoomerPoint:{leftBound:0,topBound:0,rightBound:0,bottomBound:0},hideZoomer:!0,hideOutZoomer:!0,imgLoadedFlag:!1,outZoomerInitTop:0,outZoomerTop:0,imgInfo:{},$img:null}},computed:{zoomerHeight(){return this.height>0?this.height:this.width},zoomerHalfWidth(){return this.width/2},zoomerHalfHeight(){return this.zoomerHeight/2},vZoomerHalfWidth(){const e=this.zoomerHalfWidth;return this.outZoomer?e*this.scale:e},vZoomerHalfHeight(){const e=this.zoomerHalfHeight;return this.outZoomer?e*this.scale:e},zoomerPosition(){const{top:e,left:t}=this.zoomerRect;return{top:`${e}px`,left:`${t}px`}},zoomerSize(){const{width:e,zoomerHeight:t}=this;return{width:`${e}px`,height:`${t}px`}},outZoomerSize(){const{scale:e,width:t,zoomerHeight:o}=this;return{width:`${t*e}px`,height:`${o*e}px`}},outZoomerPosition(){return{top:`${this.outZoomerTop}px`}},zoomerBgUrl(){return{backgroundImage:`url(${this.highUrl||this.url})`}},zoomerBgSize(){const{scale:e,imgInfo:{height:t,width:o}}=this;return{backgroundSize:`${o*e}px ${t*e}px`}},zoomerBgPosition(){const{left:e,top:t}=this.zoomerBgRect;return{backgroundPosition:`${e}px ${t}px`}}},watch:{scale(){this.initVZoomerPoint(),!this.outZoomer&&this.mouseMove(event)},enterEvent:"mouseEnter",moveEvent:"mouseMove",leaveEvent:"mouseLeave",url:"handlerUrlChange",width:"initZoomerPoint",height:"initZoomerPoint",vZoomerHalfWidth:"initVZoomerPoint",vZoomerHalfHeight:"initVZoomerPoint"},mounted(){this.url&&this.handlerUrlChange(),this.beforeReactivateMoveFns=[],this.$img=this.$refs.imgRef,this.addResizeListener(this.$refs.imgRef,e=>{this.imgInfo=e,this.handlerImgResize()})},methods:{getBoundingClientRect(e){const t=e.getBoundingClientRect(),n=navigator.userAgent.indexOf("MSIE")!==-1&&e.tagName==="HTML"?-e.scrollTop:t.top;return{left:t.left,top:n,right:t.right,bottom:t.bottom,width:t.right-t.left,height:t.bottom-n}},addResizeListener(e,t){this.disabledReactive||this.beforeReactivateMoveFns.push(()=>{const o=this.getBoundingClientRect(e);this.validImgResize(o)&&t&&t(o)})},handlerUrlChange(){this.imgLoadedFlag=!1,this.loadImg(this.url).then(this.imgLoaded)},loadImg(e){return new Promise((t,o)=>{const n=document.createElement("img");n.addEventListener("load",t),n.addEventListener("error",o),n.src=e})},imgLoaded(){this.$nextTick(()=>{const e=this.$refs.imgRef;this.imgLoadedFlag||(this.imgLoadedFlag=!0,e.src=this.url,V(()=>{this.imgInfo=this.getBoundingClientRect(e),this.handlerImgResize(),this.$emit("created",e,this.imgInfo)},500))})},validImgResize(e){return JSON.stringify(this.imgInfo)!==JSON.stringify(e)},handlerImgResize(){this.initZoomerProperty(),this.resetOutZoomPosition()},mouseEnter(e){this.imgLoadedFlag&&(this.hideZoomer=!1),this.$emit("mouseenter",e)},mouseMove(e){if(!this.hideZoomer){if(this.imgLoadedFlag&&e){this.beforeReactivateMoveFns.forEach(N=>N.call(this));const{pageX:t,pageY:o,clientY:n}=e,r=o-n,{scale:i,zoomerRect:s,zoomerBgRect:f,zoomerPoint:H,vZoomerPoint:P,outZoomer:I,zoomerHalfWidth:R,zoomerHalfHeight:L,vZoomerHalfWidth:E,vZoomerHalfHeight:S}=this,{absoluteLeft:T,absoluteTop:M}=s,{leftBound:c,topBound:v,rightBound:w,bottomBound:x}=H,{leftBound:Z,topBound:z,rightBound:O,bottomBound:W}=P;let m=this.outZoomerInitTop;const l=t-T,h=o-M,k=l>c?Math.min(l,w):c,F=h>v?Math.min(h,x):v,U=l*i>Z?Math.min(l*i,O):Z,C=h*i>z?Math.min(h*i,W):z;s.left=k-R,s.top=F-L,f.left=-U+E,f.top=-C+S,I&&(m||(m=this.outZoomerInitTop=r+this.imgInfo.top),this.hideOutZoomer&&(this.hideOutZoomer=!1),this.outZoomerTop=r>m?r-m:0)}this.$emit("mousemove",e)}},mouseLeave(e){this.hideZoomer=!0,this.outZoomer&&(this.hideOutZoomer=!0),this.$emit("mouseleave",e)},initZoomerProperty(){const e=this.zoomerRect,{left:t,top:o}=this.imgInfo,{documentElement:n,body:r}=document,i=n.scrollTop||r.scrollTop,s=n.scrollLeft||r.scrollLeft;e.absoluteLeft=t+s,e.absoluteTop=o+i,this.initZoomerPoint(),this.initVZoomerPoint()},initZoomerPoint(){const e=this.zoomerHalfWidth,t=this.zoomerHalfHeight,{width:o,height:n}=this.imgInfo,r=this.zoomerPoint;r.leftBound=e,r.topBound=t,r.rightBound=o-e,r.bottomBound=n-t,this.mouseMove(event)},initVZoomerPoint(){const e=this.vZoomerPoint,t=this.vZoomerHalfWidth,o=this.vZoomerHalfHeight,{width:n,height:r}=this.imgInfo,i=this.scale;e.leftBound=t,e.topBound=o,e.rightBound=n*i-t,e.bottomBound=r*i-o,this.mouseMove(event)},reset(){this.initZoomerProperty()},resetOutZoomPosition(){this.outZoomerInitTop=0}}},J={key:0,class:"img-zoomer-point"};function X(e,t,o,n,r,i){return a(),u("div",{class:"witMagnifier",onMouseenter:t[1]||(t[1]=s=>!o.disabled&&!o.enterEvent&&i.mouseEnter(s)),onMouseleave:t[2]||(t[2]=s=>!o.disabled&&!o.leaveEvent&&i.mouseLeave(s)),onMousemove:t[3]||(t[3]=s=>!o.disabled&&!o.moveEvent&&i.mouseMove(s))},[Y("img",{ref:"imgRef",class:"origin-img",onLoad:t[0]||(t[0]=s=>i.imgLoaded())},null,544),o.selector?B((a(),u("div",{key:0,class:b(["img-zoomer",{circle:o.type==="circle"}]),style:y([o.zoomerStyle,i.zoomerSize,i.zoomerPosition,!o.outZoomer&&i.zoomerBgUrl,!o.outZoomer&&i.zoomerBgSize,!o.outZoomer&&i.zoomerBgPosition])},[d(e.$slots,"zoomer",{},void 0,!0)],6)),[[p,!r.hideZoomer&&r.imgLoadedFlag]]):g("",!0),o.outZoomer?B((a(),u("div",{key:1,class:b(["img-out-show",{"base-line":o.baseline}]),style:y([o.outZoomerStyle,i.outZoomerSize,i.outZoomerPosition,i.zoomerBgUrl,i.zoomerBgSize,i.zoomerBgPosition])},[o.pointer?(a(),u("div",J)):g("",!0),d(e.$slots,"outZoomer",{},void 0,!0)],6)),[[p,!r.hideOutZoomer]]):g("",!0),d(e.$slots,"default",{},void 0,!0)],32)}const A=j(q,[["render",X],["__scopeId","data-v-64a4ab7d"]]);export{A as default};
