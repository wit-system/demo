var f=(g,v,c)=>new Promise((x,b)=>{var C=d=>{try{t(c.next(d))}catch(r){b(r)}},R=d=>{try{t(c.throw(d))}catch(r){b(r)}},t=d=>d.done?x(d.value):Promise.resolve(d.value).then(C,R);t((c=c.apply(g,v)).next())});import{_ as ue}from"./index-G5csSH1Q.js";import{d as he,P as W,r as n,b as L,a3 as pe,h as fe,l as me,m,o as _e,c as ge,y as o,s as l,p as a,a6 as N,n as h,b3 as ve,x as _,bF as Ce,b4 as U,am as j,B as ye,C as be,af as xe,ag as Re,I as ke,J as we,_ as Se}from"./index-BNylXLUF.js";import{_ as Le}from"./index.vue_vue_type_style_index_0_lang-CQ0LplO3.js";import{g as Ne,a as Be,m as De,c as Me,d as $e,b as ze,e as Ve}from"./route-CHCbemDI.js";import{g as He,e as Ie}from"./downLoad-tlct7w9F.js";import"./ifComponent.vue_vue_type_style_index_0_lang-CZbArpmd.js";import"./index-7iMDeE21.js";import"./index.vue_vue_type_script_setup_true_lang-DuUJu87k.js";import"./dict-C-0c6999.js";const Fe=g=>(ke("data-v-5a78d906"),g=g(),we(),g),Te={class:"dictionary-management-container no-background-container auto-height-container"},We={class:"padding-out flex"},Ue={class:"table-box padding-out"},je={class:"padding-around flex-column full-height"},Ae={class:"flex space-between padding-bottom"},Oe=Fe(()=>h("div",{class:"title"},"内部给药途径",-1)),Pe={class:"tree-div flex-all"},qe=["onClick"],Ee=he({name:"RouteMatch",__name:"index",setup(g){const v=W("$baseConfirm"),c=W("$baseMessage"),x=n(null),b=n(null),C=n(""),R=n(0),t=n({pageNum:1,pageSize:20,keyword:"",isMatch:-1}),d=L({children:"children",label:"routeName",value:"routeCode"}),r=L({hisRouteCodes:[],syRouteCode:""}),A=L({searchListButtons:[{label:"搜 索",isShowLoading:!0,attrs:{type:"primary"},events:{click:D}}],searchList:[{type:"select",field:"isMatch",label:"匹配状态",valueField:"value",labelField:"label",isOutBorder:!0,attrs:{width:100,placeholder:"请选择",clearable:!0},options:[{value:-1,label:"全部"},{value:1,label:"已匹配"},{value:0,label:"未匹配"}],events:{clear:D}},{type:"input",field:"keyword",label:"关键字",isOutBorder:!0,attrs:{placeholder:"请输入",clearable:!0}}],otherSearchList:[]}),B=n(null);function D(){B.value.search()}const M=n([]),$=n([]),k=n(!1),z=n(!1),y=n(!1),O=n("https://mock.apifox.com/m1/4593503-4242983-default/system/gytj-match/excel-in"),P={updateSupport:!0},q={Authorization:pe()},w=n([]),E=n([{width:"40",type:"checkbox"},{width:"50",type:"seq",title:"序号"},{field:"hisRouteCode",title:"HIS给药途径编码",minWidth:"130"},{field:"hisRouteName",title:"HIS给药途径名称",minWidth:"130"},{field:"syRouteCode",title:"内部给药途径编码",minWidth:"140"},{field:"syRouteName",title:"内部给药途径名称",minWidth:"140"},{field:"hosHospCode",title:"医院编码",minWidth:"140"},{field:"btns",title:"操作",align:"center",width:"120",fixed:"right",render:!0}]);fe(()=>{u(),G()});const J=e=>{c(e.msg,"success","hey"),u()},S=e=>{r.hisRouteCodes=x.value.tableMethods("getCheckboxRecords")},G=()=>f(this,null,function*(){z.value=!0;const e=yield Ne();$.value=e.data,z.value=!1}),K=()=>{He(t.value,"/system/gytj-match/template").then(e=>{const{data:s}=e;Ie(s,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","给药途径.xls")})},Q=()=>{t.value.pageNum=1,u()},u=()=>f(this,null,function*(){k.value=!0;const{data:e}=yield Be(t.value);M.value=e.records,R.value=e.total,k.value=!1}),X=e=>{t.value.pageNum=1,t.value.pageSize=e,u()},V=e=>{t.value.pageNum=e,u()},Y=(e,s)=>e?s.routeName.includes(e)||s.routeCode.indexOf(e)==0:!0,Z=e=>{r.syRouteCode=e.routeCode,r.hisRouteCodes.length<=0?c("请选择HIS给药途径","error","hey"):De(r).then(s=>{s.success&&c("匹配成功","success","hey"),u()})},H=e=>{e.hisRouteCode&&(t.value.hisRouteCode=e.hisRouteCode,t.value.hosHospCode=e.hosHospCode),v("是否确认清除匹配关系",null,()=>f(this,null,function*(){Me(t.value).then(s=>{s.success&&c("清除成功","success","hey"),u()})}))},ee=e=>{e.hisRouteCode&&(t.value.hisRouteCode=e.hisRouteCode,t.value.hosHospCode=e.hosHospCode),v("是否确认删除数据",null,()=>f(this,null,function*(){$e(t.value).then(s=>{s.success&&c("删除成功","success","hey"),V(t.value.pageNum),u()})}))},te=()=>{y.value=!0,v("是否确认刷新缓存",null,()=>f(this,null,function*(){ze(t.value).then(e=>{e.success&&c("刷新缓存成功","success","hey"),y.value=!1})}))},ae=()=>{y.value=!0,v("是否确认刷新缓存",null,()=>f(this,null,function*(){Ve().then(e=>{e.success&&c("刷新缓存成功","success","hey"),y.value=!1})}))};return me(C,e=>{b.value.filter(e)}),(e,s)=>{const oe=Le,p=m("el-button"),se=m("el-upload"),le=xe,ne=Re,I=ue,F=m("el-col"),ce=m("el-input"),ie=m("el-tooltip"),de=m("el-tree"),re=m("el-row");return _e(),ge("div",Te,[o(re,{gutter:8},{default:l(()=>[o(F,{lg:18},{default:l(()=>[o(I,{class:"auto-height-card flex-column"},{default:l(()=>[o(oe,{ref_key:"witSearchRef",ref:B,modelValue:a(t),"onUpdate:modelValue":s[0]||(s[0]=i=>N(t)?t.value=i:null),"search-data":a(A),"search-name":"matching-tools-route-search",searching:a(k),onSearch:Q,isCache:!1},null,8,["modelValue","search-data","searching"]),h("div",We,[o(p,{icon:a(ve),type:"primary",onClick:K},{default:l(()=>[_("下载模板")]),_:1},8,["icon"]),o(se,{class:"padding-horizontal","file-list":a(w),"onUpdate:fileList":s[1]||(s[1]=i=>N(w)?w.value=i:null),action:a(O),data:P,headers:q,limit:3,multiple:"","on-success":J},{default:l(()=>[o(p,{icon:a(Ce),type:"primary"},{default:l(()=>[_("导入")]),_:1},8,["icon"])]),_:1},8,["file-list","action"]),o(p,{icon:a(U),type:"danger",onClick:H},{default:l(()=>[_("清除匹配关系")]),_:1},8,["icon"]),o(p,{icon:a(U),type:"danger",onClick:ee},{default:l(()=>[_("清除医院数据")]),_:1},8,["icon"]),o(p,{icon:a(j),loading:a(y),type:"danger",onClick:te},{default:l(()=>[_("刷新医院缓存")]),_:1},8,["icon","loading"])]),h("div",Ue,[o(le,{ref_key:"tableRef",ref:x,"table-name":"rule-route-table",loading:a(k),"table-data":a(M),columns:a(E),"checkbox-config":{trigger:"row"},onCheckboxChange:S,onCheckboxAll:S,onCellClick:S},{btns:l(i=>[o(p,{text:"",type:"primary",onClick:T=>H(i.row)},{default:l(()=>[_("清除")]),_:2},1032,["onClick"])]),_:1},8,["loading","table-data","columns"])]),o(ne,{"current-page":a(t).pageNum,"page-size":a(t).pageSize,total:a(R),"prev-text":"上一页","next-text":"下一页",onCurrentChange:V,onSizeChange:X},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),o(F,{lg:6},{default:l(()=>[o(I,{class:"auto-height-card"},{default:l(()=>[h("div",je,[h("div",Ae,[Oe,o(p,{icon:a(j),loading:a(y),type:"danger",onClick:ae},{default:l(()=>[_("刷新内部缓存")]),_:1},8,["icon","loading"])]),o(ce,{modelValue:a(C),"onUpdate:modelValue":s[2]||(s[2]=i=>N(C)?C.value=i:null),clearable:"",placeholder:"请输入给药途径名称或编码"},null,8,["modelValue"]),h("div",Pe,[o(de,{ref_key:"treeRef",ref:b,data:a($),"default-expanded-keys":["root"],"highlight-current":!0,"filter-node-method":Y,"node-key":"id",props:a(d)},{default:l(({node:i,data:T})=>[o(ie,{class:"box-item",content:i.data.routeCode,effect:"light",placement:"left"},{default:l(()=>[h("span",null,ye(i.data.routeName),1)]),_:2},1032,["content"]),h("a",{onClick:be(Je=>Z(T),["stop"])},"匹配",8,qe)]),_:1},8,["data","props"])])])]),_:1})]),_:1})]),_:1})])}}}),st=Se(Ee,[["__scopeId","data-v-5a78d906"]]);export{st as default};
