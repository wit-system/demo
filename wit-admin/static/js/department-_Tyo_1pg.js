var ge=Object.defineProperty;var O=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var Q=(h,c,s)=>c in h?ge(h,c,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[c]=s,W=(h,c)=>{for(var s in c||(c={}))_e.call(c,s)&&Q(h,s,c[s]);if(O)for(var s of O(c))Ce.call(c,s)&&Q(h,s,c[s]);return h};var z=(h,c,s)=>new Promise((L,T)=>{var N=p=>{try{g(s.next(p))}catch(U){T(U)}},S=p=>{try{g(s.throw(p))}catch(U){T(U)}},g=p=>p.done?L(p.value):Promise.resolve(p.value).then(N,S);g((s=s.apply(h,c)).next())});import{d as be,l as j,m as Y,w as F,c as P,_ as we}from"./drugSetDiag-ChzWPSAe.js";import{d as Te,P as Se,r as f,b as qe,h as ke,bC as Ve,bD as H,av as Ue,m as b,o,c as r,y as v,p as d,a6 as De,s as m,F as E,A as x,q as w,z as G,B as V,t as J,C as K,x as X,v as Z,a7 as Ee,af as xe,ag as Le,_ as Ne}from"./index-1fQ0gozz.js";import{_ as Ae}from"./index.vue_vue_type_style_index_0_lang-CmHiYd40.js";import{g as Be,a as Me}from"./drugQuotaManagement-C61ej7_a.js";import"./ifComponent.vue_vue_type_style_index_0_lang-BOVwK668.js";import"./index-BueAkiiY.js";import"./index.vue_vue_type_script_setup_true_lang-BLW0x7SH.js";import"./dict-Cq6Rfk1f.js";const Re={key:0},We={key:1},ze={key:0},Ye={key:1},Fe={key:0},$e={key:1},Ie={key:0},Oe={key:1},Qe={key:0},je={key:1},Pe={key:0},He={key:1},Ge=Te({__name:"department",setup(h){const c=Se("$baseMessage"),s=f({}),L=f(null),T=f(null),N=f(null),S=f(!1),g=f(!1),p=f([]),U=f("0"),y=new Map,C=f([]),n=f({type:"0",drugCode:"",specName:"",specSetType:"2",total:0,pageNum:1,pageSize:10}),A=qe({searchListButtons:[{label:"查 询",isShowLoading:!0,attrs:{type:"primary"},events:{click:ee}},{label:"重 置",isShowLoading:!1,attrs:{type:"primary"},events:{click:ie}}],searchList:[{type:"input",field:"specName",isOutBorder:!1,attrs:{placeholder:"请输入科室名称...",width:220}},{type:"select",field:"specSetType",valueField:"value",labelField:"label",isOutBorder:!1,options:be,attrs:{placeholder:"请选择",width:200,collapseTags:!0},events:{}}],rightSearchListButtons:[{label:"批量设置科室",attrs:{type:"primary",disabled:!0},events:{click:oe}}]});function ee(){L.value.search(!0)}const B=f([]),te=f([{width:"40",type:"checkbox"},{title:"科室类别",field:"parentName",minWidth:85,align:"left"},{title:"科室名称",field:"specName",minWidth:85,align:"left"},{title:"限额",field:"quotaCount",minWidth:140,align:"left",render:!0},{title:"单位",field:"quotaUnit",minWidth:85,align:"left",render:!0},{title:"周期",field:"quotaCycle",minWidth:85,align:"left",render:!0},{title:"有效期",field:"validityType",minWidth:235,align:"left",render:!0},{title:"生效时间",field:"effectiveTime",minWidth:130,align:"left",render:!0},{title:"警示比例(%)",field:"quotaScale",minWidth:100,align:"left",render:!0},{title:"上周用量",field:"lastDosageValue",minWidth:85,align:"left"},{title:"上周使用率",field:"lastUtilizationRate",minWidth:85,align:"left"},{title:"本周用量",field:"thisDosageValue",minWidth:85,align:"left"},{title:"本周余额",field:"thisWeekRemaining",minWidth:85,align:"left"},{field:"btns",title:"操作",align:"center",width:"85",fixed:"right",render:!0}]);ke(()=>{s.value=Ve("DrugQuotaRow"),n.value.drugCode=s.value.drugCode,q()});function q(t=!0){return z(this,null,function*(){t&&ue();let i={type:n.value.type,specName:n.value.specName,drugCode:n.value.drugCode,specSetType:n.value.specSetType=="2"?"":n.value.specSetType,pageNum:n.value.pageNum,pageSize:n.value.pageSize};S.value=!0;const{data:u}=yield Be(i);S.value=!1,B.value=(u.list||[]).map(a=>(a.isEdit=!1,a.quotaCount=!a.quotaCount&&a.quotaCount!=0?null:a.quotaCount,a.quotaScale=!a.quotaScale&&a.quotaScale!=0?null:a.quotaScale,a.validityStartTime=a.validityStartTime?H(a.validityStartTime).format("YYYY-MM-DD"):a.validityStartTime,a.validityEndTime=a.validityEndTime?H(a.validityEndTime).format("YYYY-MM-DD"):a.validityEndTime,a.validityTime=[a.validityStartTime,a.validityEndTime],a)),g.value&&$({checked:g.value}),Ue(()=>{const a=B.value.filter(k=>{if(y.has(k.code))return k});T.value.tableMethods("setCheckboxRow",a,!0)}),n.value.total=u.total||0,p.value=u.listUnit||[]})}const ae=t=>{n.value.pageNum=1,n.value.pageSize=t,q(!1)},le=t=>{n.value.pageNum=t,q(!1)};function ie(){let t={specName:"",specSetType:"2",type:"0",drugCode:s.value.drugCode};n.value=W(W({},n.value),t)}function oe(){N.value.showDiag(n.value.type,s.value.drugCode,g.value)}function ne(t,i){let u={id:"",quotaType:"",quotaCount:"",quotaUnit:"",quotaCycle:"",validityType:"",validityStartTime:"",validityEndTime:"",effectiveTime:"",quotaScale:"",drugCode:"",code:"",type:""};for(let a in u)t[a]&&(u[a]=t[a]);return u.type=i,u.drugCode=n.value.drugCode,u.validityStartTime=t.validityTime[0],u.validityEndTime=t.validityTime[1],new Promise((a,k)=>Me(u).then(D=>{c(D.msg,"success","hey"),q(),a(D.resultCode)}))}function ue(){y.clear(),C.value=Array.from(y.values()),A.rightSearchListButtons[0].attrs.disabled=C.value.length===0,g.value=!1}const $=({checked:t})=>{g.value=t;const i=T.value.tableMethods("getCheckboxRecords");t?i.forEach(u=>{y.has(u.code)||y.set(u.code,u)}):y.clear(),C.value=Array.from(y.values()),A.rightSearchListButtons[0].attrs.disabled=C.value.length===0},se=({checked:t,row:i})=>{t?y.has(i.code)||y.set(i.code,i):y.delete(i.code),C.value=Array.from(y.values()),A.rightSearchListButtons[0].attrs.disabled=C.value.length===0};function de(t){let i=t.quotaCount||"";return t.quotaType=="0"?i="不限":t.quotaType||(i="未设置"),i}function re(t){let i=t.quotaUnit||"";return t.quotaUnit||(i="未设置"),i}function ce(t){let i="";return P.map(u=>{t.quotaCycle==u.value&&(i=u.label)}),i}function me(t){let i="未设置";return t.validityType=="0"?i="不限制":t.validityType=="1"?i=t.validityStartTime+" 至 "+t.validityEndTime:t.validityType||(i="未设置"),i}function fe(t){let i="未设置";return F.concat(Y).map(a=>{t.effectiveTime==a.value&&(i=a.label)}),i}return(t,i)=>{const u=Ae,a=b("el-radio"),k=b("el-radio-group"),D=b("el-input-number"),M=b("el-option"),R=b("el-select"),ve=b("el-date-picker"),I=b("el-button"),pe=xe,ye=Le,he=we;return o(),r("div",null,[v(u,{ref_key:"witSearchRef",ref:L,modelValue:d(n),"onUpdate:modelValue":i[0]||(i[0]=e=>De(n)?n.value=e:null),"is-cache":!1,showResult:!1,"search-data":d(A),"search-name":"matching-department-search",searching:d(S),border:!1,padding:!1,onSearch:q},null,8,["modelValue","search-data","searching"]),v(pe,{ref_key:"tableRef",ref:T,"table-name":"rule-department-table",loading:d(S),"table-data":d(B),columns:d(te),isShowTableSet:!1,onCheckboxAll:$,onCheckboxChange:se},{quotaCount:m(e=>[e.row.isEdit?(o(),r("div",Re,[v(k,{modelValue:e.row.quotaType,"onUpdate:modelValue":l=>e.row.quotaType=l},{default:m(()=>[(o(!0),r(E,null,x(d(j),(l,_)=>(o(),w(a,{key:_,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.row.quotaType=="1"?(o(),w(D,{key:0,modelValue:e.row.quotaCount,"onUpdate:modelValue":l=>e.row.quotaCount=l,style:{width:"120px"},min:0,class:"tipsInput"},null,8,["modelValue","onUpdate:modelValue"])):G("",!0)])):(o(),r("div",We,V(de(e.row)),1))]),quotaUnit:m(e=>[e.row.isEdit?(o(),r("div",ze,[v(R,{modelValue:e.row.quotaUnit,"onUpdate:modelValue":l=>e.row.quotaUnit=l},{default:m(()=>[(o(!0),r(E,null,x(d(p),(l,_)=>(o(),w(M,{key:_,value:l,label:l},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(o(),r("div",Ye,V(re(e.row)),1))]),quotaCycle:m(e=>[e.row.isEdit?(o(),r("div",Fe,[v(R,{modelValue:e.row.quotaCycle,"onUpdate:modelValue":l=>e.row.quotaCycle=l,onChange:l=>e.row.effectiveTime=l==1?d(Y)[0].value:d(F)[0].value},{default:m(()=>[(o(!0),r(E,null,x(d(P),(l,_)=>(o(),w(M,{key:_,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])):(o(),r("div",$e,V(ce(e.row)),1))]),validityType:m(e=>[e.row.isEdit?(o(),r("div",Ie,[v(k,{modelValue:e.row.validityType,"onUpdate:modelValue":l=>e.row.validityType=l},{default:m(()=>[(o(!0),r(E,null,x(d(j),(l,_)=>(o(),w(a,{key:_,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e.row.validityType=="1"?(o(),w(ve,{key:0,modelValue:e.row.validityTime,"onUpdate:modelValue":l=>e.row.validityTime=l,type:"daterange",placeholder:"请选择日期","start-placeholder":"开始时间","end-placeholder":"结束时间",style:{width:"220px"},"value-format":"YYYY-MM-DD",class:"tipsInput"},null,8,["modelValue","onUpdate:modelValue"])):G("",!0)])):(o(),r("div",Oe,V(me(e.row)),1))]),effectiveTime:m(e=>[e.row.isEdit?(o(),r("div",Qe,[v(R,{modelValue:e.row.effectiveTime,"onUpdate:modelValue":l=>e.row.effectiveTime=l},{default:m(()=>[(o(!0),r(E,null,x(e.row.quotaCycle=="0"?d(F):d(Y),(l,_)=>(o(),w(M,{key:_,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(o(),r("div",je,V(fe(e.row)),1))]),quotaScale:m(e=>[e.row.isEdit?(o(),r("div",Pe,[v(D,{modelValue:e.row.quotaScale,"onUpdate:modelValue":l=>e.row.quotaScale=l,style:{width:"85px"},min:0,max:100},null,8,["modelValue","onUpdate:modelValue"])])):(o(),r("div",He,V(e.row.quotaScale?e.row.quotaScale+"%":0),1))]),btns:m(e=>[J(v(I,{text:"",type:"primary",onClick:K(()=>{e.row.isEdit=!0},["stop"])},{default:m(()=>[X(" 修改 ")]),_:2},1032,["onClick"]),[[Z,!e.row.isEdit]]),J(v(I,{text:"",type:"primary",class:Ee(e.row.isEdit?"cellHeight":""),onClick:K(()=>z(this,null,function*(){(yield ne(e.row,0))==1&&(e.row.isEdit=!1)}),["stop"])},{default:m(()=>[X(" 保存 ")]),_:2},1032,["class","onClick"]),[[Z,e.row.isEdit]])]),_:1},8,["loading","table-data","columns"]),v(ye,{"current-page":d(n).pageNum,"page-size":d(n).pageSize,total:d(n).total,"prev-text":"上一页","next-text":"下一页",onCurrentChange:le,onSizeChange:ae},null,8,["current-page","page-size","total"]),v(he,{ref_key:"DrugSetDiagRef",ref:N,name:"科室",listUnit:d(p),quotaCycle:d(U),listDataVo:d(C),onFetchData:q},null,8,["listUnit","quotaCycle","listDataVo"])])}}}),ot=Ne(Ge,[["__scopeId","data-v-494fdbe0"]]);export{ot as default};
